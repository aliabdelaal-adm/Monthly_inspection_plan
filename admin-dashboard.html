<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø§Ù…Ù„Ø© - Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- ABSOLUTE CACHE PREVENTION - All Browsers -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0, max-stale=0, post-check=0, pre-check=0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  
  <!-- SEO Prevention -->
  <meta name="robots" content="noindex, nofollow">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
  
  <!-- Font Awesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Chart.js for Data Visualization -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Cairo', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      direction: rtl;
    }
    
    /* Sidebar Navigation */
    .sidebar {
      position: fixed;
      right: 0;
      top: 0;
      width: 280px;
      height: 100vh;
      background: linear-gradient(180deg, #1a1f36 0%, #2d3561 100%);
      padding: 20px;
      overflow-y: auto;
      box-shadow: -5px 0 20px rgba(0,0,0,0.3);
      z-index: 1000;
      transition: all 0.3s ease;
    }
    
    .sidebar-header {
      text-align: center;
      padding: 20px 0;
      border-bottom: 2px solid rgba(255,255,255,0.1);
      margin-bottom: 30px;
    }
    
    .sidebar-header h2 {
      color: #fff;
      font-size: 1.5em;
      margin-bottom: 10px;
      font-weight: 700;
    }
    
    .sidebar-header p {
      color: rgba(255,255,255,0.7);
      font-size: 0.9em;
    }
    
    .nav-menu {
      list-style: none;
    }
    
    .nav-item {
      margin-bottom: 8px;
    }
    
    .nav-link {
      display: flex;
      align-items: center;
      padding: 14px 18px;
      color: rgba(255,255,255,0.8);
      text-decoration: none;
      border-radius: 10px;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .nav-link:hover {
      background: rgba(255,255,255,0.1);
      color: #fff;
      transform: translateX(-5px);
    }
    
    .nav-link.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      box-shadow: 0 5px 15px rgba(102,126,234,0.3);
    }
    
    .nav-link i {
      margin-left: 15px;
      font-size: 1.2em;
      width: 25px;
      text-align: center;
    }
    
    /* Main Content */
    .main-content {
      margin-right: 280px;
      padding: 30px;
      min-height: 100vh;
    }
    
    .top-bar {
      background: rgba(255,255,255,0.95);
      padding: 20px 30px;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      margin-bottom: 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .top-bar h1 {
      color: #1a1f36;
      font-size: 1.8em;
      font-weight: 700;
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .user-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 700;
      font-size: 1.2em;
    }
    
    .user-name {
      font-weight: 600;
      color: #1a1f36;
    }
    
    /* Dashboard Section */
    .section {
      display: none;
    }
    
    .section.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: #fff;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }
    
    .stat-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .stat-card-title {
      color: #666;
      font-size: 0.95em;
      font-weight: 600;
    }
    
    .stat-card-icon {
      width: 50px;
      height: 50px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5em;
      color: #fff;
    }
    
    .stat-card-icon.blue {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .stat-card-icon.green {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    }
    
    .stat-card-icon.orange {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    
    .stat-card-icon.purple {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    
    .stat-card-value {
      font-size: 2.5em;
      font-weight: 700;
      color: #1a1f36;
      margin-bottom: 5px;
    }
    
    .stat-card-label {
      color: #999;
      font-size: 0.9em;
    }
    
    /* Content Cards */
    .content-card {
      background: #fff;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    .content-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid #f0f0f0;
    }
    
    .content-card-title {
      font-size: 1.5em;
      font-weight: 700;
      color: #1a1f36;
    }
    
    /* Buttons */
    .btn {
      padding: 12px 25px;
      border: none;
      border-radius: 10px;
      font-family: 'Cairo', sans-serif;
      font-weight: 600;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      box-shadow: 0 5px 15px rgba(102,126,234,0.3);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102,126,234,0.4);
    }
    
    .btn-success {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: #fff;
      box-shadow: 0 5px 15px rgba(17,153,142,0.3);
    }
    
    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(17,153,142,0.4);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: #fff;
      box-shadow: 0 5px 15px rgba(245,87,108,0.3);
    }
    
    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(245,87,108,0.4);
    }
    
    .btn-warning {
      background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      color: #fff;
      box-shadow: 0 5px 15px rgba(250,112,154,0.3);
    }
    
    .btn-warning:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(250,112,154,0.4);
    }
    
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }
    
    /* Form Elements */
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      color: #1a1f36;
      font-weight: 600;
      font-size: 0.95em;
    }
    
    .form-control {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-family: 'Cairo', sans-serif;
      font-size: 1em;
      transition: all 0.3s ease;
    }
    
    .form-control:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
    }
    
    textarea.form-control {
      resize: vertical;
      min-height: 150px;
      font-family: monospace;
    }
    
    select.form-control {
      cursor: pointer;
    }
    
    /* Quick Actions */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }
    
    .quick-action-btn {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      border: 2px solid #e0e0e0;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }
    
    .quick-action-btn:hover {
      border-color: #667eea;
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(102,126,234,0.2);
    }
    
    .quick-action-btn i {
      font-size: 2.5em;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .quick-action-btn .label {
      color: #1a1f36;
      font-weight: 600;
      font-size: 0.95em;
    }
    
    /* Status Messages */
    .status-message {
      padding: 15px 20px;
      border-radius: 10px;
      margin-top: 15px;
      font-weight: 600;
      display: none;
    }
    
    .status-message.show {
      display: block;
      animation: slideDown 0.3s ease;
    }
    
    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .status-message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .status-message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .status-message.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    
    .status-message.warning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeeba;
    }
    
    /* Table Styles */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    
    .data-table th,
    .data-table td {
      padding: 12px 15px;
      text-align: right;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .data-table th {
      background: #f8f9fa;
      color: #1a1f36;
      font-weight: 700;
      position: sticky;
      top: 0;
    }
    
    .data-table tbody tr:nth-child(even) {
      background: #fffacd;
    }
    
    .data-table tbody tr:nth-child(odd) {
      background: #ffffff;
    }
    
    .data-table tr:hover {
      background: #f8f9fa;
    }
    
    /* Charts */
    .chart-container {
      position: relative;
      height: 300px;
      margin-bottom: 30px;
    }
    
    /* File List */
    .file-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      border: 1px solid #e0e0e0;
      border-radius: 10px;
      margin-bottom: 10px;
      transition: all 0.3s ease;
    }
    
    .file-item:hover {
      border-color: #667eea;
      background: #f8f9fa;
    }
    
    .file-info {
      flex: 1;
    }
    
    .file-name {
      font-weight: 600;
      color: #1a1f36;
      margin-bottom: 5px;
    }
    
    .file-meta {
      font-size: 0.85em;
      color: #999;
    }
    
    .file-actions {
      display: flex;
      gap: 8px;
    }
    
    .file-actions button {
      padding: 8px 15px;
      font-size: 0.9em;
    }
    
    /* Loading Spinner */
    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      align-items: center;
      justify-content: center;
    }
    
    .modal.show {
      display: flex;
      animation: fadeIn 0.3s ease;
    }
    
    .modal-content {
      background: #fff;
      padding: 30px;
      border-radius: 15px;
      max-width: 600px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #f0f0f0;
    }
    
    .modal-title {
      font-size: 1.5em;
      font-weight: 700;
      color: #1a1f36;
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 1.5em;
      color: #999;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.3s ease;
    }
    
    .modal-close:hover {
      background: #f0f0f0;
      color: #1a1f36;
    }
    
    .modal-body {
      margin-bottom: 20px;
    }
    
    .modal-footer {
      display: flex;
      justify-content: flex-start;
      gap: 10px;
      padding-top: 15px;
      border-top: 2px solid #f0f0f0;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .sidebar {
        width: 100%;
        height: auto;
        position: relative;
      }
      
      .main-content {
        margin-right: 0;
        padding: 15px;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .top-bar {
        flex-direction: column;
        gap: 15px;
      }
      
      .quick-actions {
        grid-template-columns: 1fr;
      }
    }
    
    /* Toggle Sidebar Button (Mobile) */
    .sidebar-toggle {
      display: none;
      position: fixed;
      left: 20px;
      top: 20px;
      z-index: 2000;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      font-size: 1.5em;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(102,126,234,0.3);
    }
    
    @media (max-width: 768px) {
      .sidebar-toggle {
        display: block;
      }
      
      .sidebar {
        transform: translateX(100%);
      }
      
      .sidebar.active {
        transform: translateX(0);
      }
    }
  </style>
</head>
<body>
  
  <!-- Sidebar Toggle Button (Mobile) -->
  <button class="sidebar-toggle" onclick="toggleSidebar()">
    <i class="fas fa-bars"></i>
  </button>
  
  <!-- Sidebar Navigation -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø§Ù…Ù„Ø©</h2>
      <p>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…ØªÙ‚Ø¯Ù… ÙˆØ°ÙƒÙŠ</p>
    </div>
    
    <ul class="nav-menu">
      <li class="nav-item">
        <a class="nav-link active" onclick="showSection('dashboard')">
          <i class="fas fa-chart-line"></i>
          <span>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" onclick="showSection('quick-actions')">
          <i class="fas fa-bolt"></i>
          <span>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" onclick="showSection('plan-editor')">
          <i class="fas fa-edit"></i>
          <span>Ù…Ø­Ø±Ø± Ø§Ù„Ø®Ø·Ø©</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" onclick="showSection('file-management')">
          <i class="fas fa-folder-open"></i>
          <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„ÙØ§Øª</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" onclick="showSection('inspectors')">
          <i class="fas fa-users"></i>
          <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙØªØ´ÙŠÙ†</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" onclick="showSection('areas')">
          <i class="fas fa-map-marked-alt"></i>
          <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" onclick="showSection('shops')">
          <i class="fas fa-store"></i>
          <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ù„Ø§Øª</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" onclick="showSection('maintenance')">
          <i class="fas fa-tools"></i>
          <span>ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" onclick="showSection('reports')">
          <i class="fas fa-chart-bar"></i>
          <span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" onclick="showSection('settings')">
          <i class="fas fa-cog"></i>
          <span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" onclick="showSection('activity-log')">
          <i class="fas fa-history"></i>
          <span>Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª</span>
        </a>
      </li>
      <li class="nav-item" style="margin-top: 20px; border-top: 2px solid rgba(255,255,255,0.1); padding-top: 20px;">
        <h4 style="color: rgba(255,255,255,0.7); font-size: 0.85em; padding: 0 18px; margin-bottom: 10px;">ğŸš€ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ±ÙŠÙ† Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h4>
      </li>
      <li class="nav-item">
        <a class="nav-link" onclick="openAdvancedSearch()">
          <i class="fas fa-search-plus"></i>
          <span>Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" onclick="openCodeInspector()">
          <i class="fas fa-code"></i>
          <span>Ù…ÙØªØ´ Ø§Ù„ÙƒÙˆØ¯</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" onclick="openBulkOperations()">
          <i class="fas fa-tasks"></i>
          <span>Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø¬Ù…Ø¹Ø©</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" onclick="openDataTransformer()">
          <i class="fas fa-exchange-alt"></i>
          <span>Ù…Ø­ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
        </a>
      </li>
      <li class="nav-item" style="margin-top: 20px; border-top: 2px solid rgba(255,255,255,0.1); padding-top: 20px;">
        <a class="nav-link" onclick="window.location.href='index.html'">
          <i class="fas fa-home"></i>
          <span>Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹</span>
        </a>
      </li>
    </ul>
  </aside>
  
  <!-- Main Content -->
  <main class="main-content">
    
    <!-- Top Bar -->
    <div class="top-bar">
      <h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
      <div class="user-info">
        <div class="user-avatar">Ø¯.Ø¹</div>
        <div>
          <div class="user-name">Ø¯. Ø¹Ù„ÙŠ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø§Ù„</div>
          <div style="font-size: 0.85em; color: #999;">Ù…Ø·ÙˆØ± Ø§Ù„Ù†Ø¸Ø§Ù…</div>
        </div>
      </div>
    </div>
    
    <!-- Dashboard Section -->
    <section id="dashboard" class="section active">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-card-header">
            <div class="stat-card-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙØªÙŠØ´Ø§Øª</div>
            <div class="stat-card-icon blue">
              <i class="fas fa-clipboard-check"></i>
            </div>
          </div>
          <div class="stat-card-value" id="totalInspections">-</div>
          <div class="stat-card-label">ØªÙØªÙŠØ´ Ù…Ø³Ø¬Ù„</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-card-header">
            <div class="stat-card-title">Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙØªØ´ÙŠÙ†</div>
            <div class="stat-card-icon green">
              <i class="fas fa-user-check"></i>
            </div>
          </div>
          <div class="stat-card-value" id="totalInspectors">-</div>
          <div class="stat-card-label">Ù…ÙØªØ´ Ù†Ø´Ø·</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-card-header">
            <div class="stat-card-title">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</div>
            <div class="stat-card-icon orange">
              <i class="fas fa-map-marker-alt"></i>
            </div>
          </div>
          <div class="stat-card-value" id="totalAreas">-</div>
          <div class="stat-card-label">Ù…Ù†Ø·Ù‚Ø© Ù…Ø³Ø¬Ù„Ø©</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-card-header">
            <div class="stat-card-title">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ù„Ø§Øª</div>
            <div class="stat-card-icon purple">
              <i class="fas fa-store"></i>
            </div>
          </div>
          <div class="stat-card-value" id="totalShops">-</div>
          <div class="stat-card-label">Ù…Ø­Ù„ Ù…Ø³Ø¬Ù„</div>
        </div>
      </div>
      
      <!-- Charts -->
      <div class="content-card">
        <div class="content-card-header">
          <h3 class="content-card-title">Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù…ÙØªØ´ÙŠÙ†</h3>
        </div>
        <div class="chart-container">
          <canvas id="inspectorsChart"></canvas>
        </div>
      </div>
      
      <div class="content-card">
        <div class="content-card-header">
          <h3 class="content-card-title">Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</h3>
        </div>
        <div class="chart-container">
          <canvas id="areasChart"></canvas>
        </div>
      </div>
      
      <!-- Recent Activity -->
      <div class="content-card">
        <div class="content-card-header">
          <h3 class="content-card-title">Ø¢Ø®Ø± Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª</h3>
          <button class="btn btn-primary" onclick="refreshDashboard()">
            <i class="fas fa-sync-alt"></i>
            ØªØ­Ø¯ÙŠØ«
          </button>
        </div>
        <div id="recentActivity">
          <p style="text-align: center; color: #999; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø´Ø§Ø·Ø§Øª Ø­Ø¯ÙŠØ«Ø©</p>
        </div>
      </div>
    </section>
    
    <!-- Quick Actions Section -->
    <section id="quick-actions" class="section">
      <div class="content-card">
        <div class="content-card-header">
          <h3 class="content-card-title">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</h3>
        </div>
        <div class="quick-actions">
          <div class="quick-action-btn" onclick="showSection('plan-editor')">
            <i class="fas fa-edit"></i>
            <div class="label">ØªØ­Ø±ÙŠØ± Ø§Ù„Ø®Ø·Ø©</div>
          </div>
          <div class="quick-action-btn" onclick="addNewInspection()">
            <i class="fas fa-plus-circle"></i>
            <div class="label">Ø¥Ø¶Ø§ÙØ© ØªÙØªÙŠØ´ Ø¬Ø¯ÙŠØ¯</div>
          </div>
          <div class="quick-action-btn" onclick="showSection('file-management')">
            <i class="fas fa-upload"></i>
            <div class="label">Ø±ÙØ¹ Ù…Ù„Ù</div>
          </div>
          <div class="quick-action-btn" onclick="exportData()">
            <i class="fas fa-download"></i>
            <div class="label">ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
          </div>
          <div class="quick-action-btn" onclick="backupData()">
            <i class="fas fa-database"></i>
            <div class="label">Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</div>
          </div>
          <div class="quick-action-btn" onclick="showSection('maintenance')">
            <i class="fas fa-tools"></i>
            <div class="label">ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©</div>
          </div>
          <div class="quick-action-btn" onclick="validateData()">
            <i class="fas fa-check-circle"></i>
            <div class="label">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
          </div>
          <div class="quick-action-btn" onclick="showSection('reports')">
            <i class="fas fa-chart-pie"></i>
            <div class="label">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
          </div>
          <div class="quick-action-btn" onclick="openAdvancedSearch()">
            <i class="fas fa-search-plus"></i>
            <div class="label">Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</div>
          </div>
          <div class="quick-action-btn" onclick="openCodeInspector()">
            <i class="fas fa-code"></i>
            <div class="label">Ù…ÙØªØ´ Ø§Ù„ÙƒÙˆØ¯</div>
          </div>
          <div class="quick-action-btn" onclick="openVisualEditor()">
            <i class="fas fa-table"></i>
            <div class="label">Ø§Ù„Ù…Ø­Ø±Ø± Ø§Ù„Ù…Ø±Ø¦ÙŠ</div>
          </div>
          <div class="quick-action-btn" onclick="addNewInspection()">
            <i class="fas fa-plus-square"></i>
            <div class="label">Ø¥Ø¶Ø§ÙØ© ØªÙØªÙŠØ´ Ø³Ø±ÙŠØ¹</div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Plan Editor Section -->
    <section id="plan-editor" class="section">
      <div class="content-card">
        <div class="content-card-header">
          <h3 class="content-card-title">Ù…Ø­Ø±Ø± Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´</h3>
          <div style="display: flex; gap: 10px;">
            <button class="btn btn-success" onclick="savePlan()" id="savePlanBtn">
              <i class="fas fa-save"></i>
              Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
            </button>
            <button class="btn btn-warning" onclick="loadPlan()">
              <i class="fas fa-sync-alt"></i>
              Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„
            </button>
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø·Ø© (JSON)</label>
          <textarea id="planEditor" class="form-control" rows="20" placeholder='{"inspectionData": []}'></textarea>
        </div>
        
        <div class="status-message" id="planEditorStatus"></div>
        
        <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
          <h4 style="margin-bottom: 10px; color: #1a1f36;">Ù†ØµØ§Ø¦Ø­ Ù„Ù„ØªØ­Ø±ÙŠØ±:</h4>
          <ul style="color: #666; line-height: 1.8;">
            <li>ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© ØªÙ†Ø³ÙŠÙ‚ JSON Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸</li>
            <li>Ø§Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø±Ø± JSON Ø®Ø§Ø±Ø¬ÙŠ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø©</li>
            <li>Ø§Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ù‡Ø§Ù…Ø©</li>
            <li>ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ÙÙˆØ§ØµÙ„ Ø²Ø§Ø¦Ø¯Ø© Ø£Ùˆ Ù†Ø§Ù‚ØµØ©</li>
          </ul>
        </div>
      </div>
      
      <!-- Visual Plan Editor -->
      <div class="content-card">
        <div class="content-card-header">
          <h3 class="content-card-title">Ø§Ù„Ù…Ø­Ø±Ø± Ø§Ù„Ù…Ø±Ø¦ÙŠ</h3>
          <button class="btn btn-primary" onclick="openVisualEditor()">
            <i class="fas fa-table"></i>
            ÙØªØ­ Ø§Ù„Ù…Ø­Ø±Ø± Ø§Ù„Ù…Ø±Ø¦ÙŠ
          </button>
        </div>
        <p style="color: #666;">Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø­Ø±Ø± Ø§Ù„Ù…Ø±Ø¦ÙŠ Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø£Ø³Ù‡Ù„ ÙˆØ£ÙƒØ«Ø± Ø³Ù‡ÙˆÙ„Ø©</p>
      </div>
    </section>
    
    <!-- File Management Section -->
    <section id="file-management" class="section">
      <div class="content-card">
        <div class="content-card-header">
          <h3 class="content-card-title">Ø±ÙØ¹ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯</h3>
        </div>
        
        <div class="form-group">
          <label class="form-label">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„Ù</label>
          <input type="file" id="fileUpload" class="form-control" 
                 accept=".pdf,.xlsx,.xls,.docx,.doc,.pptx,.ppt,.csv,.txt,.jpg,.jpeg,.png,.gif">
        </div>
        
        <div class="form-group">
          <label class="form-label">Ø§Ù„ØªØµÙ†ÙŠÙ</label>
          <select id="fileCategory" class="form-control">
            <option value="documents">Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ - Documents</option>
            <option value="reports">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± - Reports</option>
            <option value="schedules">Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ - Schedules</option>
            <option value="resources">Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ - Resources</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">ÙˆØµÙ Ø§Ù„Ù…Ù„Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input type="text" id="fileDescription" class="form-control" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„Ù…Ù„Ù">
        </div>
        
        <button class="btn btn-primary" onclick="uploadFile()" id="uploadBtn">
          <i class="fas fa-upload"></i>
          Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù
        </button>
        
        <div class="status-message" id="fileUploadStatus"></div>
      </div>
      
      <div class="content-card">
        <div class="content-card-header">
          <h3 class="content-card-title">Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©</h3>
          <button class="btn btn-primary" onclick="loadFilesList()">
            <i class="fas fa-sync-alt"></i>
            ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
          </button>
        </div>
        <div id="filesList">
          <p style="text-align: center; color: #999; padding: 20px;">Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©" Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª</p>
        </div>
      </div>
    </section>
    
    <!-- Inspectors Section -->
    <section id="inspectors" class="section">
      <div class="content-card">
        <div class="content-card-header">
          <h3 class="content-card-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙØªØ´ÙŠÙ†</h3>
          <div style="display: flex; gap: 10px;">
            <button class="btn btn-primary" onclick="addInspector()">
              <i class="fas fa-user-plus"></i>
              Ø¥Ø¶Ø§ÙØ© Ù…ÙØªØ´ Ø¬Ø¯ÙŠØ¯
            </button>
            <button class="btn btn-success" onclick="saveInspectorsToGitHub()" id="saveInspectorsBtn">
              <i class="fas fa-save"></i>
              <i class="fab fa-github"></i>
              Ø­ÙØ¸ ÙÙŠ GitHub
            </button>
          </div>
        </div>
        <div id="inspectorsList">
          <div class="loader"></div>
        </div>
        <div class="status-message" id="inspectorsStatus"></div>
      </div>
      
      <div class="content-card">
        <div class="content-card-header">
          <h3 class="content-card-title">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙØªØ´ÙŠÙ†</h3>
        </div>
        <div class="chart-container">
          <canvas id="inspectorsStatsChart"></canvas>
        </div>
      </div>
    </section>
    
    <!-- Areas Section -->
    <section id="areas" class="section">
      <div class="content-card">
        <div class="content-card-header">
          <h3 class="content-card-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</h3>
          <div style="display: flex; gap: 10px;">
            <button class="btn btn-primary" onclick="addArea()">
              <i class="fas fa-map-marker-alt"></i>
              Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©
            </button>
            <button class="btn btn-success" onclick="saveAreasToGitHub()" id="saveAreasBtn">
              <i class="fas fa-save"></i>
              <i class="fab fa-github"></i>
              Ø­ÙØ¸ ÙÙŠ GitHub
            </button>
          </div>
        </div>
        <div id="areasList">
          <div class="loader"></div>
        </div>
        <div class="status-message" id="areasStatus"></div>
      </div>
      
      <div class="content-card">
        <div class="content-card-header">
          <h3 class="content-card-title">Ø±Ø¨Ø· Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø¨Ø§Ù„Ù…Ø­Ù„Ø§Øª</h3>
        </div>
        <div class="form-group">
          <label class="form-label">Ø§Ø®ØªØ± Ù…Ù†Ø·Ù‚Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ù„Ø§Øª Ø§Ù„ØªØ§Ø¨Ø¹Ø© Ù„Ù‡Ø§</label>
          <select id="areaFilterSelect" class="form-control" onchange="filterShopsByArea()">
            <option value="">-- Ø§Ø®ØªØ± Ù…Ù†Ø·Ù‚Ø© --</option>
          </select>
        </div>
        <div id="areaShopsList" style="margin-top: 20px;">
          <p style="text-align: center; color: #999;">Ø§Ø®ØªØ± Ù…Ù†Ø·Ù‚Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ù„Ø§Øª Ø§Ù„ØªØ§Ø¨Ø¹Ø© Ù„Ù‡Ø§</p>
        </div>
      </div>
    </section>
    
    <!-- Shops Section -->
    <section id="shops" class="section">
      <div class="content-card">
        <div class="content-card-header">
          <h3 class="content-card-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ù„Ø§Øª</h3>
          <div style="display: flex; gap: 10px;">
            <button class="btn btn-primary" onclick="addShop()">
              <i class="fas fa-store"></i>
              Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ù„ Ø¬Ø¯ÙŠØ¯
            </button>
            <button class="btn btn-success" onclick="saveShopsToGitHub()" id="saveShopsBtn">
              <i class="fas fa-save"></i>
              <i class="fab fa-github"></i>
              Ø­ÙØ¸ ÙÙŠ GitHub
            </button>
            <button class="btn btn-warning" onclick="loadShops()">
              <i class="fas fa-sync-alt"></i>
              ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            </button>
          </div>
        </div>
        <div class="form-group" style="margin-top: 20px;">
          <label class="form-label">Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„ØªØ±Ø©</label>
          <input type="text" id="shopsSearchInput" class="form-control" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø­Ù„..." onkeyup="filterShops()">
        </div>
        <div id="shopsList">
          <div class="loader"></div>
        </div>
        <div class="status-message" id="shopsStatus"></div>
      </div>
    </section>
    
    <!-- Maintenance Section -->
    <section id="maintenance" class="section">
      <div class="content-card">
        <div class="content-card-header">
          <h3 class="content-card-title">ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©</h3>
        </div>
        
        <div style="background: #fff3cd; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 2px solid #ffc107;">
          <h4 style="margin-bottom: 10px; color: #856404;"><i class="fas fa-exclamation-triangle"></i> ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ø§Ù…</h4>
          <p style="color: #856404; margin: 0;">Ø¹Ù†Ø¯ ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©ØŒ Ø³ÙŠØªÙ… Ù…Ù†Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ø¯Ø§ Ø§Ù„Ù…Ø·ÙˆØ±.</p>
        </div>
        
        <div style="display: flex; gap: 15px; margin-bottom: 20px;">
          <button class="btn btn-danger" onclick="enableMaintenanceMode()">
            <i class="fas fa-lock"></i>
            ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©
          </button>
          <button class="btn btn-success" onclick="disableMaintenanceMode()">
            <i class="fas fa-unlock"></i>
            Ø¥Ù„ØºØ§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©
          </button>
          <button class="btn btn-primary" onclick="checkMaintenanceStatus()">
            <i class="fas fa-info-circle"></i>
            ÙØ­Øµ Ø§Ù„Ø­Ø§Ù„Ø©
          </button>
        </div>
        
        <div class="status-message" id="maintenanceStatus"></div>
        
        <div class="content-card" style="margin-top: 20px;">
          <h4 style="margin-bottom: 15px;">Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ù…Ø®ØµØµØ©</h4>
          <div class="form-group">
            <label class="form-label">Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØµÙŠØ§Ù†Ø© (Ø¹Ø±Ø¨ÙŠ)</label>
            <textarea id="maintenanceMessageAr" class="form-control" rows="3">Ø§Ù„Ù†Ø¸Ø§Ù… Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«ØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹</textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØµÙŠØ§Ù†Ø© (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
            <textarea id="maintenanceMessageEn" class="form-control" rows="3">System under maintenance, please try again later</textarea>
          </div>
          <button class="btn btn-warning" onclick="updateMaintenanceMessages()">
            <i class="fas fa-edit"></i>
            ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
          </button>
        </div>

        <!-- Advanced Maintenance Configuration -->
        <div class="content-card" style="margin-top: 20px; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);">
          <h4 style="margin-bottom: 20px; color: #2d3561;"><i class="fas fa-cog"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ù„ØµÙŠØ§Ù†Ø© ÙˆØ§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰</h4>
          
          <!-- Current Status Display -->
          <div style="background: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 5px solid #667eea;">
            <h5 style="margin-bottom: 10px; color: #2d3561;">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h5>
            <div id="configCurrentStatus" style="color: #666;">
              <p><strong>ÙØªØ±Ø© Ø§Ù„ÙØ­Øµ:</strong> <span id="currentCheckInterval">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></p>
              <p><strong>ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹:</strong> <span id="currentMusicEnabled">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></p>
              <p><strong>Ù…Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰:</strong> <span id="currentMusicDuration">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></p>
              <p><strong>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª:</strong> <span id="currentMusicVolume">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></p>
            </div>
          </div>

          <!-- Check Interval Control -->
          <div class="form-group">
            <label class="form-label"><i class="fas fa-clock"></i> ÙØªØ±Ø© ÙØ­Øµ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©</label>
            <select id="checkIntervalSelect" class="form-control">
              <option value="0">Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙØ­Øµ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</option>
              <option value="5000">5 Ø«ÙˆØ§Ù†Ù (Ø³Ø±ÙŠØ¹ Ø¬Ø¯Ø§Ù‹)</option>
              <option value="10000" selected>10 Ø«ÙˆØ§Ù†Ù (Ø§ÙØªØ±Ø§Ø¶ÙŠ)</option>
              <option value="30000">30 Ø«Ø§Ù†ÙŠØ© (Ù…ØªÙˆØ³Ø·)</option>
              <option value="60000">60 Ø«Ø§Ù†ÙŠØ© (Ø¨Ø·ÙŠØ¡)</option>
              <option value="300000">5 Ø¯Ù‚Ø§Ø¦Ù‚ (Ø¨Ø·ÙŠØ¡ Ø¬Ø¯Ø§Ù‹)</option>
            </select>
            <small style="color: #666; display: block; margin-top: 5px;">
              ØªØ­Ø¯ÙŠØ¯ Ø¹Ø¯Ø¯ Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ Ø¨ÙŠÙ† ÙƒÙ„ ÙØ­Øµ Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©. Ø§Ø®ØªØ± "Ø¥ÙŠÙ‚Ø§Ù" Ù„Ù…Ù†Ø¹ Ø§Ù„ÙØ­Øµ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ØªÙ…Ø§Ù…Ø§Ù‹.
            </small>
          </div>

          <!-- Music Autoplay Control -->
          <div class="form-group">
            <label class="form-label"><i class="fas fa-music"></i> ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©</label>
            <div style="display: flex; gap: 10px; align-items: center;">
              <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="radio" name="musicEnabled" value="true" style="margin-left: 5px;">
                <span>ØªÙØ¹ÙŠÙ„</span>
              </label>
              <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="radio" name="musicEnabled" value="false" checked style="margin-left: 5px;">
                <span>Ø¥ÙŠÙ‚Ø§Ù</span>
              </label>
            </div>
            <small style="color: #666; display: block; margin-top: 5px;">
              Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ØŒ Ø³ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø¸Ù‡ÙˆØ± Ø´Ø§Ø´Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©.
            </small>
          </div>

          <!-- Music Duration Control -->
          <div class="form-group">
            <label class="form-label"><i class="fas fa-hourglass-half"></i> Ù…Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰</label>
            <select id="musicDurationSelect" class="form-control">
              <option value="0" selected>ØªØ´ØºÙŠÙ„ Ù…Ø³ØªÙ…Ø± (Ø¨Ø¯ÙˆÙ† Ø¥ÙŠÙ‚Ø§Ù)</option>
              <option value="30000">30 Ø«Ø§Ù†ÙŠØ©</option>
              <option value="60000">Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©</option>
              <option value="300000">5 Ø¯Ù‚Ø§Ø¦Ù‚</option>
              <option value="600000">10 Ø¯Ù‚Ø§Ø¦Ù‚</option>
              <option value="1800000">30 Ø¯Ù‚ÙŠÙ‚Ø©</option>
            </select>
            <small style="color: #666; display: block; margin-top: 5px;">
              ØªØ­Ø¯ÙŠØ¯ Ù…Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ù‚Ø¨Ù„ Ø¥ÙŠÙ‚Ø§ÙÙ‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹. "ØªØ´ØºÙŠÙ„ Ù…Ø³ØªÙ…Ø±" ØªØ¹Ù†ÙŠ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø³ØªØ³ØªÙ…Ø± Ø¨Ø¯ÙˆÙ† ØªÙˆÙ‚Ù.
            </small>
          </div>

          <!-- Music Volume Control -->
          <div class="form-group">
            <label class="form-label"><i class="fas fa-volume-up"></i> Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª: <span id="volumeValue">15%</span></label>
            <input type="range" id="musicVolumeSlider" class="form-control" min="0" max="100" value="15" step="1" 
                   style="height: 40px; cursor: pointer;"
                   oninput="document.getElementById('volumeValue').textContent = this.value + '%'">
            <small style="color: #666; display: block; margin-top: 5px;">
              ØªØ­Ø¯ÙŠØ¯ Ù…Ø³ØªÙˆÙ‰ ØµÙˆØª Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ (0% = ÙƒØªÙ… Ø§Ù„ØµÙˆØªØŒ 100% = Ø£Ø¹Ù„Ù‰ ØµÙˆØª). Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§: 10-20% Ù„Ù„ØµÙˆØª Ø§Ù„Ø®Ø§ÙØª.
            </small>
          </div>

          <!-- Action Buttons -->
          <div style="display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
            <button class="btn btn-primary" onclick="saveMaintenanceConfig()">
              <i class="fas fa-save"></i>
              Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </button>
            <button class="btn btn-info" onclick="loadMaintenanceConfig()">
              <i class="fas fa-sync"></i>
              ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
            </button>
            <button class="btn btn-danger" onclick="emergencyStopAll()">
              <i class="fas fa-stop-circle"></i>
              Ø¥ÙŠÙ‚Ø§Ù Ø·Ø§Ø±Ø¦ (ÙƒÙ„ Ø´ÙŠØ¡)
            </button>
          </div>
          
          <div class="status-message" id="configStatus" style="margin-top: 15px;"></div>
        </div>
      </div>
    </section>
    
    <!-- Reports Section -->
    <section id="reports" class="section">
      <div class="content-card">
        <div class="content-card-header">
          <h3 class="content-card-title">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h3>
        </div>
        
        <div class="quick-actions">
          <div class="quick-action-btn" onclick="generateMonthlyReport()">
            <i class="fas fa-calendar-alt"></i>
            <div class="label">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ</div>
          </div>
          <div class="quick-action-btn" onclick="generateInspectorReport()">
            <i class="fas fa-user-tie"></i>
            <div class="label">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙØªØ´ÙŠÙ†</div>
          </div>
          <div class="quick-action-btn" onclick="generateAreaReport()">
            <i class="fas fa-map"></i>
            <div class="label">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</div>
          </div>
          <div class="quick-action-btn" onclick="generateShopReport()">
            <i class="fas fa-shopping-bag"></i>
            <div class="label">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø­Ù„Ø§Øª</div>
          </div>
        </div>
      </div>
      
      <div class="content-card">
        <div class="content-card-header">
          <h3 class="content-card-title">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</h3>
        </div>
        <div id="advancedStats">
          <div class="loader"></div>
        </div>
      </div>
    </section>
    
    <!-- Settings Section -->
    <section id="settings" class="section">
      <div class="content-card">
        <div class="content-card-header">
          <h3 class="content-card-title">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
        </div>
        
        <div class="form-group">
          <label class="form-label">GitHub Token</label>
          <input type="password" id="githubToken" class="form-control" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
          <small style="color: #999; display: block; margin-top: 5px;">
            Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ GitHub API
          </small>
        </div>
        
        <div class="form-group">
          <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹</label>
          <input type="text" id="repoName" class="form-control" value="aliabdelaal-adm/Monthly_inspection_plan" readonly>
        </div>
        
        <div class="form-group">
          <label class="form-label">ÙˆØ¶Ø¹ Ø§Ù„ØªØ·ÙˆÙŠØ±</label>
          <select id="devMode" class="form-control">
            <option value="production">Ø§Ù„Ø¥Ù†ØªØ§Ø¬ (Production)</option>
            <option value="development">Ø§Ù„ØªØ·ÙˆÙŠØ± (Development)</option>
          </select>
        </div>
        
        <button class="btn btn-primary" onclick="saveSettings()">
          <i class="fas fa-save"></i>
          Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        </button>
        
        <div class="status-message" id="settingsStatus"></div>
      </div>
      
      <div class="content-card">
        <div class="content-card-header">
          <h3 class="content-card-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</h3>
        </div>
        
        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
          <button class="btn btn-success" onclick="createBackup()">
            <i class="fas fa-save"></i>
            Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
          </button>
          <button class="btn btn-warning" onclick="listBackups()">
            <i class="fas fa-list"></i>
            Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
          </button>
          <button class="btn btn-danger" onclick="restoreBackup()">
            <i class="fas fa-undo"></i>
            Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
          </button>
        </div>
        
        <div id="backupsList" style="margin-top: 20px;"></div>
      </div>
    </section>
    
    <!-- Activity Log Section -->
    <section id="activity-log" class="section">
      <div class="content-card">
        <div class="content-card-header">
          <h3 class="content-card-title">Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª</h3>
          <button class="btn btn-primary" onclick="refreshActivityLog()">
            <i class="fas fa-sync-alt"></i>
            ØªØ­Ø¯ÙŠØ«
          </button>
        </div>
        
        <div id="activityLogContent">
          <p style="text-align: center; color: #999; padding: 20px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª...</p>
        </div>
      </div>
    </section>
    
  </main>
  
  <!-- Token Setup Modal -->
  <div id="tokenModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Ø¥Ø¯Ø®Ø§Ù„ GitHub Token</h3>
        <button class="modal-close" onclick="closeTokenModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom: 15px; color: #666;">
          ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ GitHub Personal Access Token Ù„Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ù„ØªØªÙ…ÙƒÙ† Ù…Ù† Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª.
        </p>
        
        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
          <strong style="color: #856404;">ÙƒÙŠÙÙŠØ© Ø¥Ù†Ø´Ø§Ø¡ Token:</strong>
          <ol style="margin: 10px 0; padding-right: 20px; color: #856404; font-size: 0.9em;">
            <li>Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ <a href="https://github.com/settings/tokens" target="_blank" style="color: #0066cc;">GitHub Settings â†’ Tokens</a></li>
            <li>Ø§Ù†Ù‚Ø± "Generate new token (classic)"</li>
            <li>Ø§Ø®ØªØ± ØµÙ„Ø§Ø­ÙŠØ© <strong>repo</strong></li>
            <li>Ø§Ù†Ø³Ø® Ø§Ù„ØªÙˆÙƒÙ†</li>
          </ol>
        </div>
        
        <div class="form-group">
          <label class="form-label">GitHub Token</label>
          <input type="password" id="tokenInput" class="form-control" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
        </div>
        
        <div class="status-message" id="tokenModalStatus"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="saveToken()">
          <i class="fas fa-save"></i>
          Ø­ÙØ¸
        </button>
        <button class="btn btn-warning" onclick="useDefaultToken()">
          <i class="fas fa-key"></i>
          Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
        </button>
      </div>
    </div>
  </div>

  <!-- Shop Edit Modal -->
  <div id="shopEditModal" class="modal">
    <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
      <div class="modal-header">
        <h3 class="modal-title">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„</h3>
        <button class="modal-close" onclick="closeShopEditModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="shopEditOriginalName">
        
        <!-- Required Fields Section -->
        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
          <h4 style="color: #2d3561; font-size: 1.1em; margin-bottom: 15px;">ğŸ“‹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ø¥Ø¬Ø¨Ø§Ø±ÙŠØ©)</h4>
          <div style="margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„ <span style="color: red;">*</span></label>
            <input type="text" id="shopEditName" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„">
          </div>
          <div style="margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© <span style="color: red;">*</span></label>
            <select id="shopEditArea" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
              <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©...</option>
            </select>
          </div>
        </div>
        
        <!-- Optional Details Section -->
        <div style="background: #e8f4f8; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
          <h4 style="color: #2d3561; font-size: 1.1em; margin-bottom: 15px;">ğŸ“ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©)</h4>
          
          <div style="margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</label>
            <input type="text" id="shopEditNameEn" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Shop Name in English">
          </div>
          
          <div style="margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Ø±Ù‚Ù… Ø§Ù„ØªØ±Ø®ÙŠØµ</label>
            <input type="text" id="shopEditLicense" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Ù…Ø«Ø§Ù„: CN-1234567">
          </div>
          
          <div style="margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
            <input type="text" id="shopEditAddress" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ù…Ø­Ù„">
          </div>
          
          <div style="margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
            <input type="tel" id="shopEditPhone" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Ù…Ø«Ø§Ù„: 0501234567">
          </div>
          
          <div style="margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
            <input type="email" id="shopEditEmail" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="example@email.com">
          </div>
          
          <div style="margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">ğŸ—ºï¸ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø­Ù„ Ø¹Ù„Ù‰ Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„</label>
            <!-- âš ï¸ CRITICAL: Manual Google Maps link ONLY - NO auto-generation -->
            <input type="url" id="shopEditGoogleMaps" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="https://maps.google.com/...">
            <small style="color: #666; display: block; margin-top: 5px;">
              ğŸ’¡ Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ù† Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„ Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­Ù„
            </small>
            <small style="color: #d9534f; display: block; margin-top: 3px; font-weight: 500;">
              âš ï¸ ÙŠØ¬Ø¨ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù…Ù† Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„ - Ù„Ø§ ØªÙˆÙ„ÙŠØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ
            </small>
          </div>
          
          <div style="margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Ø·Ø¨ÙŠØ¹Ø© Ù†Ø´Ø§Ø· Ø§Ù„Ù…Ø­Ù„</label>
            <textarea id="shopEditActivity" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" rows="3" placeholder="Ù…Ø«Ø§Ù„: Ø¨ÙŠØ¹ Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø§Ù„Ø£Ù„ÙŠÙØ©ØŒ Ø¨ÙŠØ¹ Ø£Ø³Ù…Ø§Ùƒ Ø§Ù„Ø²ÙŠÙ†Ø©ØŒ Ø¨ÙŠØ¹ Ø§Ù„Ø·ÙŠÙˆØ±..."></textarea>
          </div>
          
          <div style="margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Ø±Ù…Ø² ADM</label>
            <input type="text" id="shopEditAdmCode" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="Ù…Ø«Ø§Ù„: ADM0001">
          </div>
        </div>
        
        <div class="status-message" id="shopEditStatus"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="saveShopEdit()">
          <i class="fas fa-save"></i>
          ğŸ’¾ Ø­ÙØ¸ ÙÙˆØ±Ø§Ù‹
        </button>
        <button class="btn btn-warning" onclick="closeShopEditModal()">
          <i class="fas fa-times"></i>
          âœ• Ø¥Ù„ØºØ§Ø¡
        </button>
      </div>
    </div>
  </div>
  
  <script>
    // ========================
    // Configuration & Global Variables
    // ========================
    const repo = "aliabdelaal-adm/Monthly_inspection_plan";
    const planPath = "plan-data.json";
    const filesPath = "files.json";
    const maintenancePath = "maintenance-status.json";
    
    let planData = null;
    let filesData = null;
    let planSha = "";
    let filesSha = "";
    let shopsDetails = null;
    
    // Chart instances
    let inspectorsChart = null;
    let areasChart = null;
    let inspectorsStatsChart = null;
    
    // ========================
    // Token Management
    // ========================
    function getToken() {
      return localStorage.getItem("devToken") || "";
    }
    
    function setToken(token) {
      localStorage.setItem("devToken", token);
    }
    
    function removeToken() {
      localStorage.removeItem("devToken");
    }
    
    function showTokenModal() {
      document.getElementById("tokenModal").classList.add("show");
      document.getElementById("tokenInput").focus();
    }
    
    function closeTokenModal() {
      document.getElementById("tokenModal").classList.remove("show");
    }
    
    function saveToken() {
      const token = document.getElementById("tokenInput").value.trim();
      if (!token) {
        showMessage("tokenModalStatus", "error", "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØªÙˆÙƒÙ†!");
        return;
      }
      setToken(token);
      closeTokenModal();
      showMessage("tokenModalStatus", "success", "ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙˆÙƒÙ† Ø¨Ù†Ø¬Ø§Ø­!");
      setTimeout(() => {
        initDashboard();
      }, 500);
    }
    
    function useDefaultToken() {
      const defaultToken = "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";
      setToken(defaultToken);
      closeTokenModal();
      showMessage("tokenModalStatus", "success", "ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ!");
      setTimeout(() => {
        initDashboard();
      }, 500);
    }
    
    // ========================
    // Navigation & UI
    // ========================
    function showSection(sectionId) {
      // Hide all sections
      document.querySelectorAll('.section').forEach(section => {
        section.classList.remove('active');
      });
      
      // Remove active class from all nav links
      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
      });
      
      // Show selected section
      document.getElementById(sectionId).classList.add('active');
      
      // Add active class to clicked nav link
      event.target.closest('.nav-link').classList.add('active');
      
      // Close sidebar on mobile
      if (window.innerWidth <= 768) {
        toggleSidebar();
      }
      
      // Load section-specific data
      loadSectionData(sectionId);
    }
    
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('active');
    }
    
    function loadSectionData(sectionId) {
      switch(sectionId) {
        case 'dashboard':
          refreshDashboard();
          break;
        case 'plan-editor':
          if (!planData) loadPlan();
          break;
        case 'file-management':
          // File management loads on demand
          break;
        case 'inspectors':
          loadInspectorsList();
          break;
        case 'areas':
          loadAreasList();
          populateAreaFilter();
          break;
        case 'shops':
          loadShops();
          break;
        case 'activity-log':
          refreshActivityLog();
          break;
      }
    }
    
    function showMessage(elementId, type, message) {
      const element = document.getElementById(elementId);
      element.className = `status-message show ${type}`;
      element.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i> ${message}`;
      
      setTimeout(() => {
        element.classList.remove('show');
      }, 5000);
    }
    
    // ========================
    // Data Loading
    // ========================
    async function loadPlan() {
      const token = getToken();
      if (!token) {
        showTokenModal();
        return;
      }
      
      try {
        showMessage("planEditorStatus", "info", "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...");
        
        // Try to load from GitHub first
        try {
          const res = await fetch(`https://api.github.com/repos/${repo}/contents/${planPath}`, {
            headers: {
              "Authorization": `Bearer ${token}`,
              "Content-Type": "application/json"
            }
          });
          
          if (res.ok) {
            const file = await res.json();
            const content = decodeURIComponent(escape(atob(file.content)));
            planData = JSON.parse(content);
            planSha = file.sha;
            
            document.getElementById("planEditor").value = JSON.stringify(planData, null, 2);
            showMessage("planEditorStatus", "success", "ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ Ù…Ù† GitHub!");
            
            // Update dashboard stats
            updateDashboardStats();
            return;
          }
        } catch (ghError) {
          console.warn('Could not load from GitHub, trying local file:', ghError.message);
        }
        
        // Fallback: Load from local file
        const localRes = await fetch('plan-data.json');
        if (localRes.ok) {
          planData = await localRes.json();
          planSha = "";
          
          document.getElementById("planEditor").value = JSON.stringify(planData, null, 2);
          showMessage("planEditorStatus", "success", "ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ Ù…Ù† Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø­Ù„ÙŠ!");
          
          // Update dashboard stats
          updateDashboardStats();
          return;
        }
        
        throw new Error('Could not load plan data from GitHub or local file');
        
      } catch (error) {
        showMessage("planEditorStatus", "error", "Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: " + error.message);
        if (error.message.includes("401") || error.message.includes("403")) {
          removeToken();
          setTimeout(showTokenModal, 500);
        }
      }
    }
    
    async function savePlan() {
      const token = getToken();
      if (!token) {
        showTokenModal();
        return;
      }
      
      let jsonData;
      try {
        jsonData = JSON.parse(document.getElementById("planEditor").value);
      } catch(e) {
        showMessage("planEditorStatus", "error", "Ø®Ø·Ø£ ÙÙŠ ØªÙ†Ø³ÙŠÙ‚ JSON! Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø£Ù‚ÙˆØ§Ø³ ÙˆØ§Ù„ÙÙˆØ§ØµÙ„.");
        return;
      }
      
      try {
        document.getElementById("savePlanBtn").disabled = true;
        showMessage("planEditorStatus", "info", "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...");
        
        const content = btoa(unescape(encodeURIComponent(JSON.stringify(jsonData, null, 2))));
        const res = await fetch(`https://api.github.com/repos/${repo}/contents/${planPath}`, {
          method: "PUT",
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: "ØªØ­Ø¯ÙŠØ« Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©",
            content: content,
            sha: planSha
          })
        });
        
        if (res.status === 200 || res.status === 201) {
          showMessage("planEditorStatus", "success", "âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
          planData = jsonData;
          await loadPlan(); // Reload to get new SHA
          updateDashboardStats();
          logActivity("ØªØ¹Ø¯ÙŠÙ„ Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´", "ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¹Ù„Ù‰ Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´");
        } else {
          const err = await res.json().catch(() => ({ message: `HTTP ${res.status}` }));
          showMessage("planEditorStatus", "error", "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: " + (err.message || "ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙƒÙ†"));
        }
      } catch (error) {
        showMessage("planEditorStatus", "error", "âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: " + error.message);
      } finally {
        document.getElementById("savePlanBtn").disabled = false;
      }
    }
    
    // ========================
    // Dashboard Statistics
    // ========================
    function updateDashboardStats() {
      if (!planData || !planData.inspectionData) return;
      
      const inspections = planData.inspectionData;
      
      // Count unique inspectors
      const inspectors = new Set(inspections.map(i => i.inspector));
      document.getElementById("totalInspectors").textContent = inspectors.size;
      
      // Count unique areas
      const areas = new Set(inspections.map(i => i.area));
      document.getElementById("totalAreas").textContent = areas.size;
      
      // Count unique shops
      const shops = new Set();
      inspections.forEach(i => {
        if (i.shops && Array.isArray(i.shops)) {
          i.shops.forEach(shop => shops.add(shop));
        }
      });
      document.getElementById("totalShops").textContent = shops.size;
      
      // Total inspections
      document.getElementById("totalInspections").textContent = inspections.length;
      
      // Update charts
      updateCharts(inspections, inspectors, areas);
    }
    
    function updateCharts(inspections, inspectors, areas) {
      // Inspectors distribution
      const inspectorCounts = {};
      inspections.forEach(i => {
        inspectorCounts[i.inspector] = (inspectorCounts[i.inspector] || 0) + 1;
      });
      
      if (inspectorsChart) {
        inspectorsChart.destroy();
      }
      
      const ctx1 = document.getElementById('inspectorsChart');
      if (ctx1) {
        inspectorsChart = new Chart(ctx1, {
          type: 'bar',
          data: {
            labels: Object.keys(inspectorCounts),
            datasets: [{
              label: 'Ø¹Ø¯Ø¯ Ø§Ù„ØªÙØªÙŠØ´Ø§Øª',
              data: Object.values(inspectorCounts),
              backgroundColor: 'rgba(102, 126, 234, 0.7)',
              borderColor: 'rgba(102, 126, 234, 1)',
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
      }
      
      // Areas distribution
      const areaCounts = {};
      inspections.forEach(i => {
        areaCounts[i.area] = (areaCounts[i.area] || 0) + 1;
      });
      
      if (areasChart) {
        areasChart.destroy();
      }
      
      const ctx2 = document.getElementById('areasChart');
      if (ctx2) {
        areasChart = new Chart(ctx2, {
          type: 'pie',
          data: {
            labels: Object.keys(areaCounts),
            datasets: [{
              data: Object.values(areaCounts),
              backgroundColor: [
                'rgba(102, 126, 234, 0.7)',
                'rgba(17, 153, 142, 0.7)',
                'rgba(240, 147, 251, 0.7)',
                'rgba(79, 172, 254, 0.7)',
                'rgba(250, 112, 154, 0.7)',
                'rgba(254, 225, 64, 0.7)'
              ],
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom'
              }
            }
          }
        });
      }
    }
    
    async function refreshDashboard() {
      if (!planData) {
        await loadPlan();
      } else {
        updateDashboardStats();
      }
    }
    
    // ========================
    // File Management
    // ========================
    async function uploadFile() {
      const token = getToken();
      if (!token) {
        showTokenModal();
        return;
      }
      
      const fileInput = document.getElementById("fileUpload");
      const category = document.getElementById("fileCategory").value;
      const description = document.getElementById("fileDescription").value;
      
      if (!fileInput.files[0]) {
        showMessage("fileUploadStatus", "error", "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹");
        return;
      }
      
      const file = fileInput.files[0];
      const maxSize = 25 * 1024 * 1024; // 25 MB
      if (file.size > maxSize) {
        showMessage("fileUploadStatus", "error", "Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹! ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† 25 MB");
        return;
      }
      
      try {
        document.getElementById("uploadBtn").disabled = true;
        showMessage("fileUploadStatus", "info", "â³ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù...");
        
        const reader = new FileReader();
        reader.onload = async function(e) {
          const content = e.target.result.split(',')[1];
          const fileName = file.name;
          const filePath = `files/${category}/${fileName}`;
          
          try {
            const uploadRes = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`, {
              method: "PUT",
              headers: {
                "Authorization": `Bearer ${token}`,
                "Content-Type": "application/json"
              },
              body: JSON.stringify({
                message: `Ø±ÙØ¹ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯: ${fileName}`,
                content: content
              })
            });
            
            if (uploadRes.status === 201) {
              await updateFilesRegistry(fileName, filePath, category, file.size, description || fileName, token);
              showMessage("fileUploadStatus", "success", `âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­! ${fileName}`);
              fileInput.value = '';
              document.getElementById("fileDescription").value = '';
              setTimeout(() => loadFilesList(), 1000);
              logActivity("Ø±ÙØ¹ Ù…Ù„Ù", `ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù: ${fileName}`);
            } else if (uploadRes.status === 422) {
              showMessage("fileUploadStatus", "error", "âŒ Ù…Ù„Ù Ø¨Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹!");
            } else {
              showMessage("fileUploadStatus", "error", "âŒ Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù");
            }
          } catch (error) {
            showMessage("fileUploadStatus", "error", "âŒ Ø®Ø·Ø£: " + error.message);
          } finally {
            document.getElementById("uploadBtn").disabled = false;
          }
        };
        
        reader.onerror = function() {
          showMessage("fileUploadStatus", "error", "âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù");
          document.getElementById("uploadBtn").disabled = false;
        };
        
        reader.readAsDataURL(file);
        
      } catch (error) {
        showMessage("fileUploadStatus", "error", "âŒ Ø®Ø·Ø£: " + error.message);
        document.getElementById("uploadBtn").disabled = false;
      }
    }
    
    async function updateFilesRegistry(fileName, filePath, category, fileSize, description, token) {
      try {
        const res = await fetch(`https://api.github.com/repos/${repo}/contents/${filesPath}`, {
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          }
        });
        
        let filesData = { files: [], categories: [], lastUpdate: new Date().toISOString() };
        let currentSha = "";
        
        if (res.ok) {
          const file = await res.json();
          filesData = JSON.parse(decodeURIComponent(escape(atob(file.content))));
          currentSha = file.sha;
        }
        
        const newFile = {
          id: Date.now().toString(),
          name: fileName,
          path: filePath,
          category: category,
          type: fileName.split('.').pop().toLowerCase(),
          size: fileSize,
          uploadDate: new Date().toISOString(),
          description: description,
          uploader: "Ø¯. Ø¹Ù„ÙŠ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø§Ù„",
          visible: true
        };
        
        filesData.files.push(newFile);
        filesData.lastUpdate = new Date().toISOString();
        
        const content = btoa(unescape(encodeURIComponent(JSON.stringify(filesData, null, 2))));
        await fetch(`https://api.github.com/repos/${repo}/contents/${filesPath}`, {
          method: "PUT",
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: `ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª - Ø¥Ø¶Ø§ÙØ© ${fileName}`,
            content: content,
            sha: currentSha
          })
        });
      } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª:", error);
      }
    }
    
    async function loadFilesList() {
      const token = getToken();
      if (!token) {
        showTokenModal();
        return;
      }
      
      try {
        const res = await fetch(`https://api.github.com/repos/${repo}/contents/${filesPath}`, {
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          }
        });
        
        if (res.ok) {
          const file = await res.json();
          filesData = JSON.parse(decodeURIComponent(escape(atob(file.content))));
          displayFilesList(filesData.files);
        } else {
          document.getElementById("filesList").innerHTML = '<p style="text-align: center; color: #999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª</p>';
        }
      } catch (error) {
        document.getElementById("filesList").innerHTML = '<p style="text-align: center; color: #f5576c;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª</p>';
      }
    }
    
    function displayFilesList(files) {
      const container = document.getElementById("filesList");
      
      if (!files || files.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ù…Ø±ÙÙˆØ¹Ø©</p>';
        return;
      }
      
      const visibleFiles = files.filter(f => f.visible !== false);
      
      let html = '';
      visibleFiles.forEach(file => {
        const fileSize = formatFileSize(file.size);
        const uploadDate = new Date(file.uploadDate).toLocaleDateString('ar-EG');
        
        html += `
          <div class="file-item">
            <div class="file-info">
              <div class="file-name"><i class="fas fa-file"></i> ${file.name}</div>
              <div class="file-meta">${file.description}</div>
              <div class="file-meta">Ø§Ù„Ø­Ø¬Ù…: ${fileSize} | Ø§Ù„ØªØ§Ø±ÙŠØ®: ${uploadDate}</div>
            </div>
            <div class="file-actions">
              <button class="btn btn-success" onclick="downloadFile('${file.path}')">
                <i class="fas fa-download"></i> ØªØ­Ù…ÙŠÙ„
              </button>
              <button class="btn btn-danger" onclick="deleteFile('${file.id}', '${file.path}', '${escapeQuotes(file.name)}')">
                <i class="fas fa-trash"></i> Ø­Ø°Ù
              </button>
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html;
    }
    
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    function escapeQuotes(str) {
      return str.replace(/'/g, "\\'").replace(/"/g, '\\"');
    }
    
    async function downloadFile(filePath) {
      const token = getToken();
      if (!token) return;
      
      try {
        const res = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`, {
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          }
        });
        
        if (res.ok) {
          const file = await res.json();
          const content = atob(file.content);
          const blob = new Blob([content], { type: 'application/octet-stream' });
          const url = URL.createObjectURL(blob);
          
          const a = document.createElement('a');
          a.href = url;
          a.download = file.name;
          a.click();
          URL.revokeObjectURL(url);
        }
      } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù:", error);
      }
    }
    
    async function deleteFile(fileId, filePath, fileName) {
      if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù "${fileName}"ØŸ`)) {
        return;
      }
      
      const token = getToken();
      if (!token) return;
      
      try {
        const fileRes = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`, {
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          }
        });
        
        if (fileRes.ok) {
          const file = await fileRes.json();
          const deleteRes = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`, {
            method: "DELETE",
            headers: {
              "Authorization": `Bearer ${token}`,
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              message: `Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù: ${fileName}`,
              sha: file.sha
            })
          });
          
          if (deleteRes.ok) {
            await removeFromFilesRegistry(fileId, token);
            loadFilesList();
            logActivity("Ø­Ø°Ù Ù…Ù„Ù", `ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù: ${fileName}`);
          }
        }
      } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù:", error);
      }
    }
    
    async function removeFromFilesRegistry(fileId, token) {
      try {
        const res = await fetch(`https://api.github.com/repos/${repo}/contents/${filesPath}`, {
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          }
        });
        
        if (res.ok) {
          const file = await res.json();
          const filesData = JSON.parse(decodeURIComponent(escape(atob(file.content))));
          
          filesData.files = filesData.files.filter(f => f.id !== fileId);
          filesData.lastUpdate = new Date().toISOString();
          
          const content = btoa(unescape(encodeURIComponent(JSON.stringify(filesData, null, 2))));
          await fetch(`https://api.github.com/repos/${repo}/contents/${filesPath}`, {
            method: "PUT",
            headers: {
              "Authorization": `Bearer ${token}`,
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              message: `ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª - Ø­Ø°Ù Ù…Ù„Ù`,
              content: content,
              sha: file.sha
            })
          });
        }
      } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª:", error);
      }
    }
    
    // ========================
    // Inspectors Management
    // ========================
    function loadInspectorsList() {
      if (!planData || !planData.inspectionData) {
        document.getElementById("inspectorsList").innerHTML = '<p style="text-align: center; color: #999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>';
        return;
      }
      
      const inspections = planData.inspectionData;
      const inspectorStats = {};
      
      inspections.forEach(i => {
        if (!inspectorStats[i.inspector]) {
          inspectorStats[i.inspector] = {
            name: i.inspector,
            totalInspections: 0,
            areas: new Set(),
            shops: new Set()
          };
        }
        inspectorStats[i.inspector].totalInspections++;
        inspectorStats[i.inspector].areas.add(i.area);
        if (i.shops && Array.isArray(i.shops)) {
          i.shops.forEach(shop => inspectorStats[i.inspector].shops.add(shop));
        }
      });
      
      let html = `
        <table class="data-table">
          <thead>
            <tr>
              <th>Ø§Ù„Ù…ÙØªØ´</th>
              <th>Ø¹Ø¯Ø¯ Ø§Ù„ØªÙØªÙŠØ´Ø§Øª</th>
              <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</th>
              <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ù„Ø§Øª</th>
              <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>
          </thead>
          <tbody>
      `;
      
      Object.values(inspectorStats).forEach(inspector => {
        html += `
          <tr>
            <td><i class="fas fa-user-tie"></i> ${inspector.name}</td>
            <td>${inspector.totalInspections}</td>
            <td>${inspector.areas.size}</td>
            <td>${inspector.shops.size}</td>
            <td>
              <button class="btn btn-warning" style="padding: 5px 10px; font-size: 0.85em; margin-left: 5px;" 
                      onclick="editInspector('${inspector.name.replace(/'/g, "\\'")}')">
                <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
              </button>
              <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.85em;" 
                      onclick="deleteInspector('${inspector.name.replace(/'/g, "\\'")}')">
                <i class="fas fa-trash"></i> Ø­Ø°Ù
              </button>
            </td>
          </tr>
        `;
      });
      
      html += '</tbody></table>';
      document.getElementById("inspectorsList").innerHTML = html;
    }
    
    // ========================
    // Areas Management
    // ========================
    function loadAreasList() {
      if (!planData || !planData.inspectionData) {
        document.getElementById("areasList").innerHTML = '<p style="text-align: center; color: #999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>';
        return;
      }
      
      const inspections = planData.inspectionData;
      const areaStats = {};
      
      inspections.forEach(i => {
        if (!areaStats[i.area]) {
          areaStats[i.area] = {
            name: i.area,
            totalInspections: 0,
            inspectors: new Set(),
            shops: new Set()
          };
        }
        areaStats[i.area].totalInspections++;
        areaStats[i.area].inspectors.add(i.inspector);
        if (i.shops && Array.isArray(i.shops)) {
          i.shops.forEach(shop => areaStats[i.area].shops.add(shop));
        }
      });
      
      let html = `
        <table class="data-table">
          <thead>
            <tr>
              <th>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th>
              <th>Ø¹Ø¯Ø¯ Ø§Ù„ØªÙØªÙŠØ´Ø§Øª</th>
              <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙØªØ´ÙŠÙ†</th>
              <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ù„Ø§Øª</th>
              <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>
          </thead>
          <tbody>
      `;
      
      Object.values(areaStats).forEach(area => {
        html += `
          <tr>
            <td><i class="fas fa-map-marker-alt"></i> ${area.name}</td>
            <td>${area.totalInspections}</td>
            <td>${area.inspectors.size}</td>
            <td>${area.shops.size}</td>
            <td>
              <button class="btn btn-warning" style="padding: 5px 10px; font-size: 0.85em; margin-left: 5px;" 
                      onclick="editArea('${area.name.replace(/'/g, "\\'")}')">
                <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
              </button>
              <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.85em;" 
                      onclick="deleteArea('${area.name.replace(/'/g, "\\'")}')">
                <i class="fas fa-trash"></i> Ø­Ø°Ù
              </button>
            </td>
          </tr>
        `;
      });
      
      html += '</tbody></table>';
      document.getElementById("areasList").innerHTML = html;
    }
    
    // ========================
    // Shops Management
    // ========================
    function loadShopsList() {
      if (!planData || !planData.inspectionData) {
        document.getElementById("shopsList").innerHTML = '<p style="text-align: center; color: #999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>';
        return;
      }
      
      const inspections = planData.inspectionData;
      const shopStats = {};
      
      inspections.forEach(i => {
        if (i.shops && Array.isArray(i.shops)) {
          i.shops.forEach(shop => {
            if (!shopStats[shop]) {
              shopStats[shop] = {
                name: shop,
                totalInspections: 0,
                areas: new Set(),
                inspectors: new Set()
              };
            }
            shopStats[shop].totalInspections++;
            shopStats[shop].areas.add(i.area);
            shopStats[shop].inspectors.add(i.inspector);
          });
        }
      });
      
      let html = `
        <table class="data-table">
          <thead>
            <tr>
              <th>Ø§Ù„Ù…Ø­Ù„</th>
              <th>Ø¹Ø¯Ø¯ Ø§Ù„ØªÙØªÙŠØ´Ø§Øª</th>
              <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</th>
              <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙØªØ´ÙŠÙ†</th>
              <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>
          </thead>
          <tbody>
      `;
      
      Object.values(shopStats).forEach(shop => {
        html += `
          <tr>
            <td><i class="fas fa-store"></i> ${shop.name}</td>
            <td>${shop.totalInspections}</td>
            <td>${shop.areas.size}</td>
            <td>${shop.inspectors.size}</td>
            <td>
              <button class="btn btn-warning" style="padding: 5px 10px; font-size: 0.85em; margin-left: 5px;" 
                      onclick="editShop('${shop.name.replace(/'/g, "\\'")}')">
                <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
              </button>
              <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.85em;" 
                      onclick="deleteShop('${shop.name.replace(/'/g, "\\'")}')">
                <i class="fas fa-trash"></i> Ø­Ø°Ù
              </button>
            </td>
          </tr>
        `;
      });
      
      html += '</tbody></table>';
      document.getElementById("shopsList").innerHTML = html;
    }
    
    // ========================
    // GitHub Direct Save Functions
    // ========================
    
    // Save Inspectors to GitHub
    async function saveInspectorsToGitHub() {
      const token = getToken();
      if (!token) {
        showTokenModal();
        return;
      }
      
      if (!planData || !planData.inspectionData) {
        showMessage("inspectorsStatus", "error", "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø­ÙØ¸!");
        return;
      }
      
      try {
        showMessage("inspectorsStatus", "info", "Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ´ÙŠÙ† ÙÙŠ GitHub...");
        document.getElementById("saveInspectorsBtn").disabled = true;
        
        await savePlanToGitHub();
        
        showMessage("inspectorsStatus", "success", "âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙØªØ´ÙŠÙ† ÙÙŠ GitHub Ø¨Ù†Ø¬Ø§Ø­!");
        logActivity("Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ´ÙŠÙ†", "ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙØªØ´ÙŠÙ† Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ GitHub");
        
      } catch (error) {
        showMessage("inspectorsStatus", "error", "âŒ ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: " + error.message);
      } finally {
        document.getElementById("saveInspectorsBtn").disabled = false;
      }
    }
    
    // Save Areas to GitHub
    async function saveAreasToGitHub() {
      const token = getToken();
      if (!token) {
        showTokenModal();
        return;
      }
      
      if (!planData || !planData.inspectionData) {
        showMessage("areasStatus", "error", "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø­ÙØ¸!");
        return;
      }
      
      try {
        showMessage("areasStatus", "info", "Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ ÙÙŠ GitHub...");
        document.getElementById("saveAreasBtn").disabled = true;
        
        await savePlanToGitHub();
        
        showMessage("areasStatus", "success", "âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ ÙÙŠ GitHub Ø¨Ù†Ø¬Ø§Ø­!");
        logActivity("Ø­ÙØ¸ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚", "ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ GitHub");
        
        // Refresh area dropdown
        populateAreaFilter();
        
      } catch (error) {
        showMessage("areasStatus", "error", "âŒ ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: " + error.message);
      } finally {
        document.getElementById("saveAreasBtn").disabled = false;
      }
    }
    
    // Save Shops to GitHub
    async function saveShopsToGitHub() {
      const token = getToken();
      if (!token) {
        showTokenModal();
        return;
      }
      
      if (!planData || !planData.inspectionData) {
        showMessage("shopsStatus", "error", "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø­ÙØ¸!");
        return;
      }
      
      try {
        showMessage("shopsStatus", "info", "Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ù„Ø§Øª ÙÙŠ GitHub...");
        document.getElementById("saveShopsBtn").disabled = true;
        
        await savePlanToGitHub();
        
        showMessage("shopsStatus", "success", "âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„Ø§Øª ÙÙŠ GitHub Ø¨Ù†Ø¬Ø§Ø­!");
        logActivity("Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ù„Ø§Øª", "ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ GitHub");
        
      } catch (error) {
        showMessage("shopsStatus", "error", "âŒ ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: " + error.message);
      } finally {
        document.getElementById("saveShopsBtn").disabled = false;
      }
    }
    
    // Helper function to save plan to GitHub
    async function savePlanToGitHub() {
      const token = getToken();
      if (!token) {
        throw new Error("Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙˆÙƒÙ† GitHub");
      }
      
      // Encode plan data
      const content = btoa(unescape(encodeURIComponent(JSON.stringify(planData, null, 2))));
      
      // Get current file SHA
      const getRes = await fetch(`https://api.github.com/repos/${repo}/contents/${planPath}`, {
        headers: {
          "Authorization": `Bearer ${token}`,
          "Content-Type": "application/json"
        }
      });
      
      if (!getRes.ok) {
        throw new Error("ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ SHA Ù„Ù„Ù…Ù„Ù");
      }
      
      const fileData = await getRes.json();
      const sha = fileData.sha;
      
      // Update file on GitHub
      const putRes = await fetch(`https://api.github.com/repos/${repo}/contents/${planPath}`, {
        method: "PUT",
        headers: {
          "Authorization": `Bearer ${token}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          message: "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Developer Dashboard Update",
          content: content,
          sha: sha,
          branch: "main"
        })
      });
      
      if (!putRes.ok) {
        const errorData = await putRes.json();
        throw new Error(errorData.message || "ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù");
      }
      
      return await putRes.json();
    }
    
    // Wrapper function for compatibility with smart-planner style calls
    async function savePlanDataToGitHub(commitMessage) {
      // Note: commitMessage is currently not used in savePlanToGitHub
      // Future enhancement: pass custom commit messages
      return await savePlanToGitHub();
    }
    
    // Filter shops by area
    function filterShopsByArea() {
      const selectedArea = document.getElementById("areaFilterSelect").value;
      const container = document.getElementById("areaShopsList");
      
      if (!selectedArea) {
        container.innerHTML = '<p style="text-align: center; color: #999;">Ø§Ø®ØªØ± Ù…Ù†Ø·Ù‚Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ù„Ø§Øª Ø§Ù„ØªØ§Ø¨Ø¹Ø© Ù„Ù‡Ø§</p>';
        return;
      }
      
      if (!planData || !planData.inspectionData) {
        container.innerHTML = '<p style="text-align: center; color: #999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>';
        return;
      }
      
      // Collect shops for selected area
      const areaShops = new Set();
      planData.inspectionData.forEach(inspection => {
        if (inspection.area === selectedArea && inspection.shops) {
          inspection.shops.forEach(shop => areaShops.add(shop));
        }
      });
      
      if (areaShops.size === 0) {
        container.innerHTML = `<p style="text-align: center; color: #999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ù„Ø§Øª Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Ù…Ù†Ø·Ù‚Ø© "${selectedArea}"</p>`;
        return;
      }
      
      // Display shops
      let html = `
        <div style="background: #e8f5e9; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
          <h4 style="margin-bottom: 10px; color: #2e7d32;">
            <i class="fas fa-map-marked-alt"></i> Ø§Ù„Ù…Ø­Ù„Ø§Øª ÙÙŠ Ù…Ù†Ø·Ù‚Ø©: ${selectedArea}
          </h4>
          <p style="color: #555;">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ù„Ø§Øª: <strong>${areaShops.size}</strong></p>
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;">
      `;
      
      Array.from(areaShops).sort().forEach((shop, index) => {
        html += `
          <div style="background: #fff; border: 2px solid #4caf50; border-radius: 10px; padding: 15px; transition: all 0.3s ease;">
            <div style="display: flex; align-items: center; gap: 10px;">
              <div style="background: linear-gradient(135deg, #4caf50 0%, #81c784 100%); 
                          width: 40px; height: 40px; border-radius: 50%; 
                          display: flex; align-items: center; justify-content: center; 
                          color: white; font-weight: bold;">
                ${index + 1}
              </div>
              <div style="flex: 1;">
                <div style="font-weight: 600; color: #1a1f36; margin-bottom: 5px;">
                  <i class="fas fa-store"></i> ${shop}
                </div>
                <div style="font-size: 0.85em; color: #666;">
                  <i class="fas fa-map-marker-alt"></i> ${selectedArea}
                </div>
              </div>
            </div>
          </div>
        `;
      });
      
      html += '</div>';
      container.innerHTML = html;
    }
    
    // Populate area filter dropdown
    function populateAreaFilter() {
      if (!planData || !planData.inspectionData) return;
      
      const areas = new Set();
      planData.inspectionData.forEach(inspection => {
        if (inspection.area) {
          areas.add(inspection.area);
        }
      });
      
      const select = document.getElementById("areaFilterSelect");
      if (!select) return;
      
      select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ù…Ù†Ø·Ù‚Ø© --</option>';
      Array.from(areas).sort().forEach(area => {
        const option = document.createElement('option');
        option.value = area;
        option.textContent = area;
        select.appendChild(option);
      });
    }
    
    // Load shops with enhanced features
    function loadShops() {
      loadShopsList();
      populateAreaFilter();
    }
    
    // Filter shops in the shops list
    function filterShops() {
      const searchTerm = document.getElementById("shopsSearchInput").value.toLowerCase();
      const table = document.querySelector("#shopsList table");
      
      if (!table) return;
      
      const rows = table.querySelectorAll("tbody tr");
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? "" : "none";
      });
    }
    
    // ========================
    // Edit and Delete Functions
    // ========================
    
    // Edit Inspector
    function editInspector(oldName) {
      const newName = prompt(`ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù…ÙØªØ´:\n\nØ§Ù„Ø§Ø³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ: ${oldName}\n\nØ£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:`, oldName);
      
      if (!newName || newName === oldName) return;
      
      if (!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„Ù…ÙØªØ´ Ù…Ù† "${oldName}" Ø¥Ù„Ù‰ "${newName}"ØŸ\n\nØ³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©.`)) {
        return;
      }
      
      // Update all inspections with this inspector
      let updateCount = 0;
      planData.inspectionData.forEach(inspection => {
        if (inspection.inspector === oldName) {
          inspection.inspector = newName;
          updateCount++;
        }
      });
      
      // Update the plan editor
      document.getElementById('planEditor').value = JSON.stringify(planData, null, 2);
      
      // Reload the list
      loadInspectorsList();
      
      showMessage("inspectorsStatus", "success", `âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ${updateCount} Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­! Ø§Ø¶ØºØ· "Ø­ÙØ¸ ÙÙŠ GitHub" Ù„Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª.`);
      logActivity("ØªØ¹Ø¯ÙŠÙ„ Ù…ÙØªØ´", `ØªÙ… ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„Ù…ÙØªØ´ Ù…Ù† "${oldName}" Ø¥Ù„Ù‰ "${newName}"`);
    }
    
    // Delete Inspector
    function deleteInspector(name) {
      if (!confirm(`âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ÙØªØ´ "${name}"ØŸ\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!`)) {
        return;
      }
      
      const beforeCount = planData.inspectionData.length;
      planData.inspectionData = planData.inspectionData.filter(inspection => inspection.inspector !== name);
      const deletedCount = beforeCount - planData.inspectionData.length;
      
      if (deletedCount === 0) {
        showMessage("inspectorsStatus", "warning", "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø³Ø¬Ù„Ø§Øª Ù„Ù„Ø­Ø°Ù!");
        return;
      }
      
      // Update the plan editor
      document.getElementById('planEditor').value = JSON.stringify(planData, null, 2);
      
      // Reload the list
      loadInspectorsList();
      
      showMessage("inspectorsStatus", "success", `âœ… ØªÙ… Ø­Ø°Ù ${deletedCount} Ø³Ø¬Ù„ Ù„Ù„Ù…ÙØªØ´ "${name}"! Ø§Ø¶ØºØ· "Ø­ÙØ¸ ÙÙŠ GitHub" Ù„Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª.`);
      logActivity("Ø­Ø°Ù Ù…ÙØªØ´", `ØªÙ… Ø­Ø°Ù ${deletedCount} Ø³Ø¬Ù„ Ù„Ù„Ù…ÙØªØ´ "${name}"`);
    }
    
    // Edit Area
    function editArea(oldName) {
      const newName = prompt(`ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:\n\nØ§Ù„Ø§Ø³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ: ${oldName}\n\nØ£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:`, oldName);
      
      if (!newName || newName === oldName) return;
      
      if (!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ù…Ù† "${oldName}" Ø¥Ù„Ù‰ "${newName}"ØŸ\n\nØ³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©.`)) {
        return;
      }
      
      // Update all inspections with this area
      let updateCount = 0;
      planData.inspectionData.forEach(inspection => {
        if (inspection.area === oldName) {
          inspection.area = newName;
          updateCount++;
        }
      });
      
      // Update the plan editor
      document.getElementById('planEditor').value = JSON.stringify(planData, null, 2);
      
      // Reload the list
      loadAreasList();
      populateAreaFilter();
      
      showMessage("areasStatus", "success", `âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ${updateCount} Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­! Ø§Ø¶ØºØ· "Ø­ÙØ¸ ÙÙŠ GitHub" Ù„Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª.`);
      logActivity("ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†Ø·Ù‚Ø©", `ØªÙ… ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ù…Ù† "${oldName}" Ø¥Ù„Ù‰ "${newName}"`);
    }
    
    // Delete Area
    function deleteArea(name) {
      if (!confirm(`âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ù†Ø·Ù‚Ø© "${name}"ØŸ\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!`)) {
        return;
      }
      
      const beforeCount = planData.inspectionData.length;
      planData.inspectionData = planData.inspectionData.filter(inspection => inspection.area !== name);
      const deletedCount = beforeCount - planData.inspectionData.length;
      
      if (deletedCount === 0) {
        showMessage("areasStatus", "warning", "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø³Ø¬Ù„Ø§Øª Ù„Ù„Ø­Ø°Ù!");
        return;
      }
      
      // Update the plan editor
      document.getElementById('planEditor').value = JSON.stringify(planData, null, 2);
      
      // Reload the list
      loadAreasList();
      populateAreaFilter();
      
      showMessage("areasStatus", "success", `âœ… ØªÙ… Ø­Ø°Ù ${deletedCount} Ø³Ø¬Ù„ Ù„Ù„Ù…Ù†Ø·Ù‚Ø© "${name}"! Ø§Ø¶ØºØ· "Ø­ÙØ¸ ÙÙŠ GitHub" Ù„Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª.`);
      logActivity("Ø­Ø°Ù Ù…Ù†Ø·Ù‚Ø©", `ØªÙ… Ø­Ø°Ù ${deletedCount} Ø³Ø¬Ù„ Ù„Ù„Ù…Ù†Ø·Ù‚Ø© "${name}"`);
    }
    
    // Edit Shop
    async function editShop(shopName) {
      // Check if data is loaded
      if (!planData || !planData.shops) {
        alert('âš ï¸ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯!\n\nØ§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©" Ø£ÙˆÙ„Ø§Ù‹ Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.');
        return;
      }
      
      // Find the shop in planData
      const shop = planData.shops.find(s => s.name === shopName);
      if (!shop) {
        alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­Ù„ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        return;
      }
      
      // Store original name for update
      document.getElementById('shopEditOriginalName').value = shopName;
      
      // Populate required fields
      document.getElementById('shopEditName').value = shop.name;
      
      // Populate areas dropdown
      const areaSelect = document.getElementById('shopEditArea');
      areaSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©...</option>';
      if (planData.areas) {
        planData.areas.forEach(area => {
          const option = document.createElement('option');
          option.value = area.id;
          option.textContent = area.name;
          areaSelect.appendChild(option);
        });
      }
      areaSelect.value = shop.areaId || '';
      
      // Load additional details from shops_details.json
      try {
        const response = await fetch('shops_details.json?' + new Date().getTime());
        const shopsDetails = await response.json();
        const details = shopsDetails[shopName];
        
        if (details) {
          document.getElementById('shopEditNameEn').value = details.nameEn || '';
          document.getElementById('shopEditLicense').value = details.licenseNo || '';
          document.getElementById('shopEditAddress').value = details.address || '';
          document.getElementById('shopEditPhone').value = details.contact || '';
          document.getElementById('shopEditEmail').value = details.email || '';
          document.getElementById('shopEditGoogleMaps').value = details.locationMap || '';
          document.getElementById('shopEditActivity').value = details.activity || '';
          document.getElementById('shopEditAdmCode').value = details.admCode || '';
        } else {
          // Clear optional fields if no details found
          document.getElementById('shopEditNameEn').value = '';
          document.getElementById('shopEditLicense').value = '';
          document.getElementById('shopEditAddress').value = '';
          document.getElementById('shopEditPhone').value = '';
          document.getElementById('shopEditEmail').value = '';
          document.getElementById('shopEditGoogleMaps').value = '';
          document.getElementById('shopEditActivity').value = '';
          document.getElementById('shopEditAdmCode').value = '';
        }
      } catch (error) {
        console.error('Error loading shop details:', error);
        // Clear optional fields on error
        document.getElementById('shopEditNameEn').value = '';
        document.getElementById('shopEditLicense').value = '';
        document.getElementById('shopEditAddress').value = '';
        document.getElementById('shopEditPhone').value = '';
        document.getElementById('shopEditEmail').value = '';
        document.getElementById('shopEditGoogleMaps').value = '';
        document.getElementById('shopEditActivity').value = '';
        document.getElementById('shopEditAdmCode').value = '';
      }
      
      // Show modal
      document.getElementById('shopEditModal').classList.add('show');
    }
    
    // Close shop edit modal
    function closeShopEditModal() {
      document.getElementById('shopEditModal').classList.remove('show');
    }
    
    // Save shop edit
    async function saveShopEdit() {
      const originalName = document.getElementById('shopEditOriginalName').value;
      const newName = document.getElementById('shopEditName').value.trim();
      const areaId = document.getElementById('shopEditArea').value;
      
      // Get optional fields
      const nameEn = document.getElementById('shopEditNameEn').value.trim();
      const licenseNo = document.getElementById('shopEditLicense').value.trim();
      const address = document.getElementById('shopEditAddress').value.trim();
      const contact = document.getElementById('shopEditPhone').value.trim();
      const email = document.getElementById('shopEditEmail').value.trim();
      
      // âš ï¸ CRITICAL: locationMap MUST be manually provided - NO AUTO-GENERATION
      // DO NOT auto-generate Google Maps links from address or coordinates
      // Requirement: Manual Google Maps links ONLY for 100% accuracy
      const locationMap = document.getElementById('shopEditGoogleMaps').value.trim();
      
      const activity = document.getElementById('shopEditActivity').value.trim();
      const admCode = document.getElementById('shopEditAdmCode').value.trim();
      
      if (!newName) {
        showMessage('shopEditStatus', 'error', 'âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„');
        return;
      }
      
      if (!areaId) {
        showMessage('shopEditStatus', 'error', 'âŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©');
        return;
      }
      
      const token = getToken();
      if (!token) {
        showTokenModal();
        return;
      }
      
      showMessage('shopEditStatus', 'info', 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...');
      
      try {
        // Update shop in planData
        const shopIndex = planData.shops.findIndex(s => s.name === originalName);
        if (shopIndex !== -1) {
          planData.shops[shopIndex].name = newName;
          planData.shops[shopIndex].areaId = areaId;
          // Update area name from areaId
          const area = planData.areas.find(a => a.id === areaId);
          if (area) {
            planData.shops[shopIndex].area = area.name;
          }
        }
        
        // Update all inspections that contain this shop
        if (originalName !== newName) {
          planData.inspectionData.forEach(inspection => {
            if (inspection.shops && Array.isArray(inspection.shops)) {
              const index = inspection.shops.indexOf(originalName);
              if (index !== -1) {
                inspection.shops[index] = newName;
              }
            }
          });
        }
        
        // Save to plan-data.json on GitHub
        await savePlanDataToGitHub(`ØªØ­Ø¯ÙŠØ« Ù…Ø­Ù„: ${newName}`);
        
        // Save additional details to shops_details.json if any optional field is filled
        if (nameEn || licenseNo || address || contact || email || locationMap || activity || admCode) {
          await saveShopDetailsToGitHub(originalName, newName, {
            nameAr: newName,
            nameEn: nameEn,
            licenseNo: licenseNo,
            address: address,
            contact: contact,
            email: email,
            locationMap: locationMap,
            activity: activity,
            admCode: admCode,
            area: planData.shops[shopIndex].area,
            areaId: areaId
          });
        }
        
        showMessage('shopEditStatus', 'success', 'âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­');
        setTimeout(() => {
          closeShopEditModal();
          loadShopsList();
          logActivity("ØªØ¹Ø¯ÙŠÙ„ Ù…Ø­Ù„", `ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„: ${newName}`);
        }, 1500);
        
      } catch (error) {
        showMessage('shopEditStatus', 'error', 'âŒ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸: ' + error.message);
      }
    }
    
    // Save shop details to shops_details.json on GitHub
    async function saveShopDetailsToGitHub(oldName, newName, details) {
      const token = getToken();
      if (!token) return;
      
      try {
        // Get current shops_details.json file
        const getRes = await fetch(`https://api.github.com/repos/${repo}/contents/shops_details.json`, {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Accept': 'application/vnd.github.v3+json'
          }
        });
        
        if (!getRes.ok) {
          throw new Error('ÙØ´Ù„ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ù„Ù shops_details.json');
        }
        
        const file = await getRes.json();
        const sha = file.sha;
        
        // Decode and parse current content
        const currentContent = JSON.parse(decodeURIComponent(escape(atob(file.content))));
        
        // If name changed, delete old entry
        if (oldName !== newName && currentContent[oldName]) {
          delete currentContent[oldName];
        }
        
        // Update or add shop details - remove empty fields
        const cleanDetails = {};
        if (details.nameAr) cleanDetails.nameAr = details.nameAr;
        if (details.nameEn) cleanDetails.nameEn = details.nameEn;
        if (details.licenseNo) cleanDetails.licenseNo = details.licenseNo;
        if (details.address) cleanDetails.address = details.address;
        if (details.contact) cleanDetails.contact = details.contact;
        if (details.email) cleanDetails.email = details.email;
        if (details.locationMap) cleanDetails.locationMap = details.locationMap;
        if (details.activity) cleanDetails.activity = details.activity;
        if (details.admCode) cleanDetails.admCode = details.admCode;
        if (details.area) cleanDetails.area = details.area;
        if (details.areaId) cleanDetails.areaId = details.areaId;
        
        currentContent[newName] = cleanDetails;
        
        // Prepare content
        const content = btoa(unescape(encodeURIComponent(JSON.stringify(currentContent, null, 2))));
        
        // Update file
        const updateRes = await fetch(`https://api.github.com/repos/${repo}/contents/shops_details.json`, {
          method: 'PUT',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Accept': 'application/vnd.github.v3+json',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            message: `ØªØ­Ø¯ÙŠØ« ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø­Ù„: ${newName}`,
            content: content,
            sha: sha
          })
        });
        
        if (!updateRes.ok) {
          throw new Error('ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ù…Ù„Ù shops_details.json');
        }
      } catch (error) {
        console.error('Error saving shop details:', error);
        // Don't throw - optional details save failure shouldn't block main save
      }
    }
    
    // Delete Shop
    function deleteShop(name) {
      // Check if data is loaded
      if (!planData || !planData.inspectionData) {
        alert('âš ï¸ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯!\n\nØ§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©" Ø£ÙˆÙ„Ø§Ù‹ Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.');
        return;
      }
      
      if (!confirm(`âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø­Ù„ "${name}" Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§ØªØŸ\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!`)) {
        return;
      }
      
      let deleteCount = 0;
      planData.inspectionData.forEach(inspection => {
        if (inspection.shops && Array.isArray(inspection.shops)) {
          const beforeLength = inspection.shops.length;
          inspection.shops = inspection.shops.filter(shop => shop !== name);
          if (inspection.shops.length < beforeLength) {
            deleteCount++;
          }
        }
      });
      
      if (deleteCount === 0) {
        showMessage("shopsStatus", "warning", "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­Ù„ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª!");
        return;
      }
      
      // Update the plan editor
      document.getElementById('planEditor').value = JSON.stringify(planData, null, 2);
      
      // Reload the list
      loadShopsList();
      
      showMessage("shopsStatus", "success", `âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø­Ù„ "${name}" Ù…Ù† ${deleteCount} Ø³Ø¬Ù„! Ø§Ø¶ØºØ· "Ø­ÙØ¸ ÙÙŠ GitHub" Ù„Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª.`);
      logActivity("Ø­Ø°Ù Ù…Ø­Ù„", `ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø­Ù„ "${name}" Ù…Ù† ${deleteCount} Ø³Ø¬Ù„`);
    }
    
    // ========================
    // Maintenance Mode
    // ========================
    async function enableMaintenanceMode() {
      if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©ØŸ Ø³ÙŠØªÙ… Ù…Ù†Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹.")) {
        return;
      }
      
      const token = getToken();
      if (!token) {
        showTokenModal();
        return;
      }
      
      try {
        showMessage("maintenanceStatus", "info", "Ø¬Ø§Ø±ÙŠ ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©...");
        
        const messageAr = document.getElementById("maintenanceMessageAr").value;
        const messageEn = document.getElementById("maintenanceMessageEn").value;
        
        const maintenanceData = {
          enabled: true,
          messages: {
            ar: messageAr,
            en: messageEn
          },
          enabledAt: new Date().toISOString(),
          enabledBy: "Ø¯. Ø¹Ù„ÙŠ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø§Ù„"
        };
        
        // Save to GitHub
        const content = btoa(unescape(encodeURIComponent(JSON.stringify(maintenanceData, null, 2))));
        
        // Get current file SHA
        const getRes = await fetch(`https://api.github.com/repos/${repo}/contents/${maintenancePath}`, {
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          }
        });
        
        let sha = "";
        if (getRes.ok) {
          const file = await getRes.json();
          sha = file.sha;
        }
        
        const res = await fetch(`https://api.github.com/repos/${repo}/contents/${maintenancePath}`, {
          method: "PUT",
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: "ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©",
            content: content,
            sha: sha
          })
        });
        
        if (res.status === 200 || res.status === 201) {
          showMessage("maintenanceStatus", "success", "âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø© Ø¨Ù†Ø¬Ø§Ø­!");
          logActivity("ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©", "ØªÙ… ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹");
        } else {
          showMessage("maintenanceStatus", "error", "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©");
        }
      } catch (error) {
        showMessage("maintenanceStatus", "error", "âŒ Ø®Ø·Ø£: " + error.message);
      }
    }
    
    async function disableMaintenanceMode() {
      if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©ØŸ Ø³ÙŠØªÙ…ÙƒÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹.")) {
        return;
      }
      
      const token = getToken();
      if (!token) {
        showTokenModal();
        return;
      }
      
      try {
        showMessage("maintenanceStatus", "info", "Ø¬Ø§Ø±ÙŠ Ø¥Ù„ØºØ§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©...");
        
        const maintenanceData = {
          enabled: false,
          messages: {},
          disabledAt: new Date().toISOString(),
          disabledBy: "Ø¯. Ø¹Ù„ÙŠ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø§Ù„"
        };
        
        const content = btoa(unescape(encodeURIComponent(JSON.stringify(maintenanceData, null, 2))));
        
        const getRes = await fetch(`https://api.github.com/repos/${repo}/contents/${maintenancePath}`, {
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          }
        });
        
        let sha = "";
        if (getRes.ok) {
          const file = await getRes.json();
          sha = file.sha;
        }
        
        const res = await fetch(`https://api.github.com/repos/${repo}/contents/${maintenancePath}`, {
          method: "PUT",
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: "Ø¥Ù„ØºØ§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©",
            content: content,
            sha: sha
          })
        });
        
        if (res.status === 200 || res.status === 201) {
          showMessage("maintenanceStatus", "success", "âœ… ØªÙ… Ø¥Ù„ØºØ§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø© Ø¨Ù†Ø¬Ø§Ø­!");
          logActivity("Ø¥Ù„ØºØ§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©", "ØªÙ… Ø¥Ù„ØºØ§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹");
        } else {
          showMessage("maintenanceStatus", "error", "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù„ØºØ§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©");
        }
      } catch (error) {
        showMessage("maintenanceStatus", "error", "âŒ Ø®Ø·Ø£: " + error.message);
      }
    }
    
    async function checkMaintenanceStatus() {
      const token = getToken();
      if (!token) {
        showTokenModal();
        return;
      }
      
      try {
        const res = await fetch(`https://api.github.com/repos/${repo}/contents/${maintenancePath}`, {
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          }
        });
        
        if (res.ok) {
          const file = await res.json();
          const maintenanceData = JSON.parse(decodeURIComponent(escape(atob(file.content))));
          
          if (maintenanceData.enabled) {
            showMessage("maintenanceStatus", "warning", `âš ï¸ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø© Ù…ÙØ¹Ù‘Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹ Ù…Ù†Ø°: ${new Date(maintenanceData.enabledAt).toLocaleString('ar-EG')}`);
          } else {
            showMessage("maintenanceStatus", "success", "âœ… ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø© ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„");
          }
        } else {
          showMessage("maintenanceStatus", "info", "â„¹ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù† ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©");
        }
      } catch (error) {
        showMessage("maintenanceStatus", "error", "âŒ Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©: " + error.message);
      }
    }
    
    // ========================
    // Activity Log
    // ========================
    function logActivity(action, details) {
      const activities = JSON.parse(localStorage.getItem("activityLog") || "[]");
      activities.unshift({
        timestamp: new Date().toISOString(),
        action: action,
        details: details,
        user: "Ø¯. Ø¹Ù„ÙŠ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø§Ù„"
      });
      
      // Keep only last 50 activities
      if (activities.length > 50) {
        activities.length = 50;
      }
      
      localStorage.setItem("activityLog", JSON.stringify(activities));
    }
    
    function refreshActivityLog() {
      const activities = JSON.parse(localStorage.getItem("activityLog") || "[]");
      const container = document.getElementById("activityLogContent");
      
      if (activities.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø´Ø§Ø·Ø§Øª Ù…Ø³Ø¬Ù„Ø©</p>';
        return;
      }
      
      let html = '<table class="data-table"><thead><tr><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th><th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th><th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th></tr></thead><tbody>';
      
      activities.forEach(activity => {
        const date = new Date(activity.timestamp);
        html += `
          <tr>
            <td>${date.toLocaleString('ar-EG')}</td>
            <td><strong>${activity.action}</strong></td>
            <td>${activity.details}</td>
            <td>${activity.user}</td>
          </tr>
        `;
      });
      
      html += '</tbody></table>';
      container.innerHTML = html;
    }
    
    // ========================
    // Utility Functions
    // ========================
    async function addNewInspection() {
      if (!planData) {
        alert("âŒ ÙŠØ¬Ø¨ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹!");
        await loadPlan();
        if (!planData) return;
      }
      
      // Load shops details if not already loaded
      if (!shopsDetails) {
        await loadShopsDetails();
      }
      
      // Get unique inspectors from existing data
      const inspectors = [...new Set(planData.inspectionData.map(i => i.inspector).filter(Boolean))].sort();
      
      // Get unique areas from shops_details.json
      const areas = shopsDetails ? [...new Set(Object.values(shopsDetails).map(s => s.address).filter(Boolean))].sort() : [];
      
      const modal = document.createElement('div');
      modal.className = 'modal show';
      modal.id = 'addInspectionModal';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 700px;">
          <div class="modal-header">
            <h3 class="modal-title">Ø¥Ø¶Ø§ÙØ© ØªÙØªÙŠØ´ Ø¬Ø¯ÙŠØ¯</h3>
            <button class="modal-close" onclick="closeModal('addInspectionModal')">&times;</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label class="form-label">Ø§Ù„Ù…ÙØªØ´</label>
              <select id="newInspectionInspector" class="form-control">
                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙØªØ´ --</option>
                ${inspectors.map(i => `<option value="${i}">${i}</option>`).join('')}
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
              <input type="date" id="newInspectionDate" class="form-control" 
                     value="${new Date().toISOString().split('T')[0]}">
            </div>
            <div class="form-group">
              <label class="form-label">Ø§Ù„ÙØªØ±Ø©</label>
              <select id="newInspectionShift" class="form-control">
                <option value="ØµØ¨Ø§Ø­ÙŠØ©">ØµØ¨Ø§Ø­ÙŠØ©</option>
                <option value="Ù…Ø³Ø§Ø¦ÙŠØ©">Ù…Ø³Ø§Ø¦ÙŠØ©</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
              <select id="newInspectionArea" class="form-control" onchange="updateShopsDropdownByArea()">
                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© --</option>
                ${areas.map(a => `<option value="${a}">${a}</option>`).join('')}
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Ø§Ù„Ù…Ø­Ù„Ø§Øª</label>
              <div style="background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                <small style="color: #666;">
                  <i class="fas fa-info-circle"></i> Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø£ÙˆÙ„Ø§Ù‹ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ù„Ø§Øª Ø§Ù„ØªØ§Ø¨Ø¹Ø© Ù„Ù‡Ø§. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ø¯ÙŠØ¯ Ø¹Ø¯Ø© Ù…Ø­Ù„Ø§Øª.
                </small>
              </div>
              <select id="newInspectionShopsSelect" class="form-control" multiple size="8" 
                      style="width: 100%;" disabled>
                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø£ÙˆÙ„Ø§Ù‹ --</option>
              </select>
              <small style="color: #999; display: block; margin-top: 5px;">
                Ø§Ø¶ØºØ· Ctrl (Ø£Ùˆ Cmd Ø¹Ù„Ù‰ Mac) + Ø§Ù†Ù‚Ø± Ù„ØªØ­Ø¯ÙŠØ¯ Ø¹Ø¯Ø© Ù…Ø­Ù„Ø§Øª
              </small>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-success" onclick="saveNewInspection()">
              <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªÙØªÙŠØ´
            </button>
            <button class="btn btn-secondary" onclick="closeModal('addInspectionModal')">
              Ø¥Ù„ØºØ§Ø¡
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }
    
    window.saveNewInspection = async function() {
      const inspector = document.getElementById('newInspectionInspector').value.trim();
      const day = document.getElementById('newInspectionDate').value;
      const shift = document.getElementById('newInspectionShift').value;
      const area = document.getElementById('newInspectionArea').value.trim();
      
      // Get selected shops from the multi-select dropdown
      const shopsSelect = document.getElementById('newInspectionShopsSelect');
      const shops = Array.from(shopsSelect.selectedOptions).map(option => option.value);
      
      if (!inspector || !day || !area || shops.length === 0) {
        alert('âŒ ÙŠØ¬Ø¨ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙˆØ§Ø®ØªÙŠØ§Ø± Ù…Ø­Ù„ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„!');
        return;
      }
      
      const newInspection = {
        inspector,
        day,
        shift,
        area,
        shops
      };
      
      planData.inspectionData.push(newInspection);
      document.getElementById('planEditor').value = JSON.stringify(planData, null, 2);
      
      await savePlan();
      
      alert(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙØªÙŠØ´ Ø¨Ù†Ø¬Ø§Ø­!\n\nØ§Ù„Ù…ÙØªØ´: ${inspector}\nØ§Ù„ØªØ§Ø±ÙŠØ®: ${day}\nØ§Ù„Ù…Ù†Ø·Ù‚Ø©: ${area}\nØ¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ù„Ø§Øª: ${shops.length}`);
      closeModal('addInspectionModal');
      
      // Refresh dashboard
      updateDashboardStats();
      
      logActivity("Ø¥Ø¶Ø§ÙØ© ØªÙØªÙŠØ´", `ØªÙ… Ø¥Ø¶Ø§ÙØ© ØªÙØªÙŠØ´ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…ÙØªØ´ ${inspector} ÙÙŠ ${area}`);
    }
    
    // Load shops details from GitHub or local file
    async function loadShopsDetails() {
      try {
        // Try to load from GitHub first
        const response = await fetch(`https://api.github.com/repos/${repo}/contents/shops_details.json`, {
          headers: {
            'Authorization': `token ${getToken()}`,
            'Accept': 'application/vnd.github.v3+json'
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          // Properly decode base64 with UTF-8 support for Arabic text
          const content = decodeURIComponent(Array.prototype.map.call(atob(data.content), function(c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
          }).join(''));
          shopsDetails = JSON.parse(content);
          console.log('Loaded shops details from GitHub:', Object.keys(shopsDetails).length, 'shops');
          return;
        }
      } catch (error) {
        console.warn('Could not load from GitHub, trying local file:', error.message);
      }
      
      // Fallback: Load from local file
      try {
        const response = await fetch('shops_details.json');
        if (response.ok) {
          shopsDetails = await response.json();
          console.log('Loaded shops details from local file:', Object.keys(shopsDetails).length, 'shops');
          return;
        }
      } catch (error) {
        console.error('Error loading shops details from local file:', error);
      }
      
      // Last resort: empty object
      shopsDetails = {};
      console.warn('Could not load shops details, using empty object');
    }
    
    // Update shops dropdown based on selected area
    window.updateShopsDropdownByArea = function() {
      const areaSelect = document.getElementById('newInspectionArea');
      const shopsSelect = document.getElementById('newInspectionShopsSelect');
      
      if (!areaSelect || !shopsSelect) return;
      
      const selectedArea = areaSelect.value;
      
      if (!selectedArea) {
        shopsSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø£ÙˆÙ„Ø§Ù‹ --</option>';
        shopsSelect.disabled = true;
        return;
      }
      
      // Filter shops by selected area
      const shopsInArea = shopsDetails ? 
        Object.entries(shopsDetails)
          .filter(([name, details]) => details.address === selectedArea)
          .map(([name, details]) => name)
          .sort() 
        : [];
      
      if (shopsInArea.length === 0) {
        shopsSelect.innerHTML = '<option value="">-- Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ù„Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© --</option>';
        shopsSelect.disabled = true;
        return;
      }
      
      // Populate shops dropdown
      shopsSelect.innerHTML = shopsInArea.map(shop => 
        `<option value="${shop}">${shop}</option>`
      ).join('');
      shopsSelect.disabled = false;
    }
    
    function exportData() {
      if (!planData) {
        alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§");
        return;
      }
      
      const dataStr = JSON.stringify(planData, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `plan-data-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      logActivity("ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", "ØªÙ… ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø·Ø©");
    }
    
    function backupData() {
      if (!planData) {
        alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ");
        return;
      }
      
      const backupData = {
        timestamp: new Date().toISOString(),
        data: planData
      };
      
      const backups = JSON.parse(localStorage.getItem("backups") || "[]");
      backups.unshift(backupData);
      
      // Keep only last 10 backups
      if (backups.length > 10) {
        backups.length = 10;
      }
      
      localStorage.setItem("backups", JSON.stringify(backups));
      alert("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!");
      
      logActivity("Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©", "ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
    }
    
    function validateData() {
      if (!planData) {
        alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù†Ù‡Ø§");
        return;
      }
      
      let errors = [];
      
      if (!planData.inspectionData || !Array.isArray(planData.inspectionData)) {
        errors.push("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø­Ù‚Ù„ inspectionData");
      } else {
        planData.inspectionData.forEach((item, index) => {
          if (!item.inspector) errors.push(`Ø§Ù„Ø¹Ù†ØµØ± ${index + 1}: Ø§Ø³Ù… Ø§Ù„Ù…ÙØªØ´ Ù…ÙÙ‚ÙˆØ¯`);
          if (!item.day) errors.push(`Ø§Ù„Ø¹Ù†ØµØ± ${index + 1}: Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…ÙÙ‚ÙˆØ¯`);
          if (!item.area) errors.push(`Ø§Ù„Ø¹Ù†ØµØ± ${index + 1}: Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ù…ÙÙ‚ÙˆØ¯Ø©`);
          if (!item.shops || !Array.isArray(item.shops)) errors.push(`Ø§Ù„Ø¹Ù†ØµØ± ${index + 1}: Ø§Ù„Ù…Ø­Ù„Ø§Øª Ù…ÙÙ‚ÙˆØ¯Ø© Ø£Ùˆ ØºÙŠØ± ØµØ­ÙŠØ­Ø©`);
        });
      }
      
      if (errors.length === 0) {
        alert("âœ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø© ÙˆÙ„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡!");
      } else {
        alert("âŒ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØªØ§Ù„ÙŠØ©:\n\n" + errors.join("\n"));
      }
    }
    
    function openVisualEditor() {
      if (!planData || !planData.inspectionData) {
        alert("âŒ ÙŠØ¬Ø¨ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹!");
        return;
      }
      
      // Create a modal for the visual editor
      const modal = document.createElement('div');
      modal.className = 'modal show';
      modal.id = 'visualEditorModal';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 95%; max-height: 95vh;">
          <div class="modal-header">
            <h3 class="modal-title">Ø§Ù„Ù…Ø­Ø±Ø± Ø§Ù„Ù…Ø±Ø¦ÙŠ Ù„Ù„Ø®Ø·Ø©</h3>
            <button class="modal-close" onclick="closeVisualEditor()">&times;</button>
          </div>
          <div class="modal-body">
            <div style="margin-bottom: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
              <button class="btn btn-success" onclick="addInspectionRow()">
                <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ØªÙØªÙŠØ´
              </button>
              <button class="btn btn-primary" onclick="saveFromVisualEditor()">
                <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
              </button>
              <button class="btn btn-warning" onclick="refreshVisualEditor()">
                <i class="fas fa-sync"></i> ØªØ­Ø¯ÙŠØ«
              </button>
              <input type="text" id="visualSearchInput" class="form-control" 
                     style="flex: 1; min-width: 200px;" 
                     placeholder="Ø¨Ø­Ø«... (Ù…ÙØªØ´ØŒ Ù…Ù†Ø·Ù‚Ø©ØŒ Ù…Ø­Ù„)"
                     onkeyup="filterVisualEditor()">
            </div>
            <div style="overflow-x: auto; max-height: 60vh; overflow-y: auto;">
              <table id="visualEditorTable" style="width: 100%; border-collapse: collapse; background: white;">
                <thead style="position: sticky; top: 0; background: #667eea; color: white; z-index: 10;">
                  <tr>
                    <th style="padding: 12px; border: 1px solid #ddd; min-width: 50px;">#</th>
                    <th style="padding: 12px; border: 1px solid #ddd; min-width: 150px;">Ø§Ù„Ù…ÙØªØ´</th>
                    <th style="padding: 12px; border: 1px solid #ddd; min-width: 120px;">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    <th style="padding: 12px; border: 1px solid #ddd; min-width: 100px;">Ø§Ù„ÙØªØ±Ø©</th>
                    <th style="padding: 12px; border: 1px solid #ddd; min-width: 150px;">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th>
                    <th style="padding: 12px; border: 1px solid #ddd; min-width: 200px;">Ø§Ù„Ù…Ø­Ù„Ø§Øª</th>
                    <th style="padding: 12px; border: 1px solid #ddd; min-width: 120px;">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                  </tr>
                </thead>
                <tbody id="visualEditorTableBody">
                </tbody>
              </table>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
      
      // Populate the table
      refreshVisualEditor();
      
      logActivity("Ø§Ù„Ù…Ø­Ø±Ø± Ø§Ù„Ù…Ø±Ø¦ÙŠ", "ØªÙ… ÙØªØ­ Ø§Ù„Ù…Ø­Ø±Ø± Ø§Ù„Ù…Ø±Ø¦ÙŠ Ù„Ù„Ø®Ø·Ø©");
    }
    
    window.closeVisualEditor = function() {
      const modal = document.getElementById('visualEditorModal');
      if (modal) {
        modal.remove();
      }
    }
    
    window.refreshVisualEditor = function() {
      const tbody = document.getElementById('visualEditorTableBody');
      if (!tbody || !planData || !planData.inspectionData) return;
      
      tbody.innerHTML = '';
      planData.inspectionData.forEach((item, index) => {
        const row = document.createElement('tr');
        row.dataset.index = index;
        const bgColor = index % 2 === 0 ? '#fffacd' : '#ffffff';
        row.style.background = bgColor;
        row.innerHTML = `
          <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${index + 1}</td>
          <td style="padding: 10px; border: 1px solid #ddd;">
            <input type="text" class="form-control" value="${item.inspector || ''}" 
                   onchange="updateInspectionField(${index}, 'inspector', this.value)">
          </td>
          <td style="padding: 10px; border: 1px solid #ddd;">
            <input type="date" class="form-control" value="${item.day || ''}" 
                   onchange="updateInspectionField(${index}, 'day', this.value)">
          </td>
          <td style="padding: 10px; border: 1px solid #ddd;">
            <select class="form-control" onchange="updateInspectionField(${index}, 'shift', this.value)">
              <option value="ØµØ¨Ø§Ø­ÙŠØ©" ${item.shift === 'ØµØ¨Ø§Ø­ÙŠØ©' ? 'selected' : ''}>ØµØ¨Ø§Ø­ÙŠØ©</option>
              <option value="Ù…Ø³Ø§Ø¦ÙŠØ©" ${item.shift === 'Ù…Ø³Ø§Ø¦ÙŠØ©' ? 'selected' : ''}>Ù…Ø³Ø§Ø¦ÙŠØ©</option>
            </select>
          </td>
          <td style="padding: 10px; border: 1px solid #ddd;">
            <input type="text" class="form-control" value="${item.area || ''}" 
                   onchange="updateInspectionField(${index}, 'area', this.value)">
          </td>
          <td style="padding: 10px; border: 1px solid #ddd;">
            <textarea class="form-control" rows="2" 
                      onchange="updateInspectionField(${index}, 'shops', this.value.split('\\n').filter(s => s.trim()))"
            >${(item.shops || []).join('\n')}</textarea>
          </td>
          <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">
            <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.9em;" 
                    onclick="deleteInspectionRow(${index})">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }
    
    window.updateInspectionField = function(index, field, value) {
      if (!planData || !planData.inspectionData || !planData.inspectionData[index]) return;
      planData.inspectionData[index][field] = value;
    }
    
    window.deleteInspectionRow = function(index) {
      if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªÙØªÙŠØ´ØŸ')) return;
      planData.inspectionData.splice(index, 1);
      refreshVisualEditor();
      logActivity("Ø­Ø°Ù ØªÙØªÙŠØ´", `ØªÙ… Ø­Ø°Ù Ø§Ù„ØªÙØªÙŠØ´ Ø±Ù‚Ù… ${index + 1}`);
    }
    
    window.addInspectionRow = function() {
      if (!planData.inspectionData) planData.inspectionData = [];
      
      planData.inspectionData.push({
        inspector: '',
        day: new Date().toISOString().split('T')[0],
        shift: 'ØµØ¨Ø§Ø­ÙŠØ©',
        area: '',
        shops: []
      });
      refreshVisualEditor();
      logActivity("Ø¥Ø¶Ø§ÙØ© ØªÙØªÙŠØ´", "ØªÙ… Ø¥Ø¶Ø§ÙØ© ØªÙØªÙŠØ´ Ø¬Ø¯ÙŠØ¯");
    }
    
    window.saveFromVisualEditor = async function() {
      document.getElementById('planEditor').value = JSON.stringify(planData, null, 2);
      await savePlan();
      alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
    }
    
    window.filterVisualEditor = function() {
      const searchTerm = document.getElementById('visualSearchInput').value.toLowerCase();
      const tbody = document.getElementById('visualEditorTableBody');
      if (!tbody) return;
      
      const rows = tbody.getElementsByTagName('tr');
      for (let row of rows) {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
      }
    }
    
    function addInspector() {
      const modal = document.createElement('div');
      modal.className = 'modal show';
      modal.id = 'addInspectorModal';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">
            <h3 class="modal-title">Ø¥Ø¶Ø§ÙØ© Ù…ÙØªØ´ Ø¬Ø¯ÙŠØ¯</h3>
            <button class="modal-close" onclick="closeModal('addInspectorModal')">&times;</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…ÙØªØ´</label>
              <input type="text" id="newInspectorName" class="form-control" placeholder="Ø¯. Ø§Ø³Ù… Ø§Ù„Ù…ÙØªØ´">
            </div>
            <div class="form-group">
              <label class="form-label">Ø§Ù„ØªØ®ØµØµ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
              <input type="text" id="newInspectorSpecialty" class="form-control" placeholder="Ø·Ø¨ Ø¨ÙŠØ·Ø±ÙŠ">
            </div>
            <div class="form-group">
              <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
              <input type="text" id="newInspectorPhone" class="form-control" placeholder="05xxxxxxxx">
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-success" onclick="saveNewInspector()">
              <i class="fas fa-save"></i> Ø­ÙØ¸
            </button>
            <button class="btn btn-secondary" onclick="closeModal('addInspectorModal')">
              Ø¥Ù„ØºØ§Ø¡
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }
    
    window.saveNewInspector = function() {
      const name = document.getElementById('newInspectorName').value.trim();
      if (!name) {
        alert('âŒ ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙØªØ´!');
        return;
      }
      
      // Add inspector to the list (for now, just log it)
      logActivity("Ø¥Ø¶Ø§ÙØ© Ù…ÙØªØ´", `ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙØªØ´: ${name}`);
      alert(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙØªØ´: ${name}\n\nÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ ÙÙŠ Ø§Ù„Ù…Ø­Ø±Ø± Ø§Ù„Ù…Ø±Ø¦ÙŠ Ø£Ùˆ Ù…Ø­Ø±Ø± JSON`);
      closeModal('addInspectorModal');
    }
    
    function addArea() {
      const modal = document.createElement('div');
      modal.className = 'modal show';
      modal.id = 'addAreaModal';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">
            <h3 class="modal-title">Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
            <button class="modal-close" onclick="closeModal('addAreaModal')">&times;</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
              <input type="text" id="newAreaName" class="form-control" placeholder="Ø³ÙˆÙ‚ Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡ØŒ Ø§Ù„Ø­ØµÙ†ØŒ Ø¥Ù„Ø®">
            </div>
            <div class="form-group">
              <label class="form-label">Ø§Ù„ÙˆØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
              <textarea id="newAreaDesc" class="form-control" rows="3" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© ÙˆÙ…Ù…ÙŠØ²Ø§ØªÙ‡Ø§"></textarea>
            </div>
            <div class="form-group">
              <label class="form-label">Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
              <input type="text" id="newAreaCoords" class="form-control" placeholder="24.xxx, 54.xxx">
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-success" onclick="saveNewArea()">
              <i class="fas fa-save"></i> Ø­ÙØ¸
            </button>
            <button class="btn btn-secondary" onclick="closeModal('addAreaModal')">
              Ø¥Ù„ØºØ§Ø¡
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }
    
    window.saveNewArea = function() {
      const name = document.getElementById('newAreaName').value.trim();
      if (!name) {
        alert('âŒ ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø·Ù‚Ø©!');
        return;
      }
      
      logActivity("Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚Ø©", `ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†Ø·Ù‚Ø©: ${name}`);
      alert(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†Ø·Ù‚Ø©: ${name}\n\nÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ Ø§Ù„Ù…Ø­Ø±Ø± Ø§Ù„Ù…Ø±Ø¦ÙŠ Ø£Ùˆ Ù…Ø­Ø±Ø± JSON`);
      closeModal('addAreaModal');
    }
    
    async function addShop() {
      const modal = document.createElement('div');
      modal.className = 'modal show';
      modal.id = 'addShopModal';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 700px;">
          <div class="modal-header">
            <h3 class="modal-title">Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ù„ Ø¬Ø¯ÙŠØ¯</h3>
            <button class="modal-close" onclick="closeModal('addShopModal')">&times;</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„ (Ø¹Ø±Ø¨ÙŠ)</label>
              <input type="text" id="newShopNameAr" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ">
            </div>
            <div class="form-group">
              <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„ (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
              <input type="text" id="newShopNameEn" class="form-control" placeholder="Shop Name in English">
            </div>
            <div class="form-group">
              <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ø±Ø®ØµØ©</label>
              <input type="text" id="newShopLicense" class="form-control" placeholder="CN-xxxxxxx">
            </div>
            <div class="form-group">
              <label class="form-label">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
              <input type="text" id="newShopArea" class="form-control" placeholder="Ø³ÙˆÙ‚ Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡">
            </div>
            <div class="form-group">
              <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
              <input type="text" id="newShopPhone" class="form-control" placeholder="05xxxxxxxx">
            </div>
            <div class="form-group">
              <label class="form-label">Ø§Ù„Ù†Ø´Ø§Ø·</label>
              <input type="text" id="newShopActivity" class="form-control" placeholder="Ø¨ÙŠØ¹ Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª">
            </div>
            <div class="form-group">
              <label class="form-label">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Google Maps)</label>
              <!-- âš ï¸ CRITICAL: Manual Google Maps link ONLY - NO auto-generation -->
              <input type="text" id="newShopLocation" class="form-control" placeholder="https://maps.google.com/...">
              <small style="color: #d9534f; display: block; margin-top: 3px; font-weight: 500;">
                âš ï¸ ÙŠØ¬Ø¨ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù…Ù† Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„ - Ù„Ø§ ØªÙˆÙ„ÙŠØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ
              </small>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-success" onclick="saveNewShop()">
              <i class="fas fa-save"></i> Ø­ÙØ¸
            </button>
            <button class="btn btn-secondary" onclick="closeModal('addShopModal')">
              Ø¥Ù„ØºØ§Ø¡
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }
    
    window.saveNewShop = async function() {
      const nameAr = document.getElementById('newShopNameAr').value.trim();
      const nameEn = document.getElementById('newShopNameEn').value.trim();
      const license = document.getElementById('newShopLicense').value.trim();
      
      if (!nameAr) {
        alert('âŒ ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ!');
        return;
      }
      
      const shopData = {
        nameAr: nameAr,
        nameEn: nameEn,
        licenseNo: license,
        address: document.getElementById('newShopArea').value.trim(),
        contact: document.getElementById('newShopPhone').value.trim(),
        activity: document.getElementById('newShopActivity').value.trim(),
        // âš ï¸ CRITICAL: locationMap MUST be manually provided - NO AUTO-GENERATION
        // DO NOT auto-generate Google Maps links from address or coordinates
        locationMap: document.getElementById('newShopLocation').value.trim(),
        admCode: 'ADM' + Date.now().toString().slice(-4)
      };
      
      logActivity("Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ù„", `ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­Ù„: ${nameAr}`);
      alert(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­Ù„: ${nameAr}\n\nØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:\n${JSON.stringify(shopData, null, 2)}\n\nÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ ÙÙŠ Ø§Ù„Ù…Ø­Ø±Ø± Ø§Ù„Ù…Ø±Ø¦ÙŠ`);
      closeModal('addShopModal');
    }
    
    function generateMonthlyReport() {
      if (!planData || !planData.inspectionData) {
        alert("âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªÙ‚Ø±ÙŠØ±!");
        return;
      }
      
      const modal = document.createElement('div');
      modal.className = 'modal show';
      modal.id = 'monthlyReportModal';
      
      // Analyze data by month
      const monthlyData = {};
      planData.inspectionData.forEach(item => {
        const month = item.day ? item.day.substring(0, 7) : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        if (!monthlyData[month]) {
          monthlyData[month] = {
            count: 0,
            inspectors: new Set(),
            areas: new Set(),
            shops: new Set()
          };
        }
        monthlyData[month].count++;
        if (item.inspector) monthlyData[month].inspectors.add(item.inspector);
        if (item.area) monthlyData[month].areas.add(item.area);
        if (item.shops) item.shops.forEach(shop => monthlyData[month].shops.add(shop));
      });
      
      let reportHtml = '<div style="max-height: 60vh; overflow-y: auto;">';
      Object.keys(monthlyData).sort().reverse().forEach(month => {
        const data = monthlyData[month];
        reportHtml += `
          <div style="border: 1px solid #ddd; border-radius: 10px; padding: 15px; margin-bottom: 15px; background: #f8f9fa;">
            <h4 style="color: #667eea; margin-bottom: 10px;">ğŸ“… ${month}</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
              <div><strong>Ø¹Ø¯Ø¯ Ø§Ù„ØªÙØªÙŠØ´Ø§Øª:</strong> ${data.count}</div>
              <div><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙØªØ´ÙŠÙ†:</strong> ${data.inspectors.size}</div>
              <div><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚:</strong> ${data.areas.size}</div>
              <div><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ù„Ø§Øª:</strong> ${data.shops.size}</div>
            </div>
          </div>
        `;
      });
      reportHtml += '</div>';
      
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 800px;">
          <div class="modal-header">
            <h3 class="modal-title">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ</h3>
            <button class="modal-close" onclick="closeModal('monthlyReportModal')">&times;</button>
          </div>
          <div class="modal-body">
            ${reportHtml}
          </div>
          <div class="modal-footer">
            <button class="btn btn-primary" onclick="exportReport('monthly')">
              <i class="fas fa-download"></i> ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            </button>
            <button class="btn btn-secondary" onclick="closeModal('monthlyReportModal')">
              Ø¥ØºÙ„Ø§Ù‚
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
      logActivity("ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ", "ØªÙ… Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ");
    }
    
    function generateInspectorReport() {
      if (!planData || !planData.inspectionData) {
        alert("âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªÙ‚Ø±ÙŠØ±!");
        return;
      }
      
      const modal = document.createElement('div');
      modal.className = 'modal show';
      modal.id = 'inspectorReportModal';
      
      // Analyze data by inspector
      const inspectorData = {};
      planData.inspectionData.forEach(item => {
        const inspector = item.inspector || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        if (!inspectorData[inspector]) {
          inspectorData[inspector] = {
            count: 0,
            areas: new Set(),
            shops: new Set(),
            dates: []
          };
        }
        inspectorData[inspector].count++;
        if (item.area) inspectorData[inspector].areas.add(item.area);
        if (item.shops) item.shops.forEach(shop => inspectorData[inspector].shops.add(shop));
        if (item.day) inspectorData[inspector].dates.push(item.day);
      });
      
      let reportHtml = '<div style="max-height: 60vh; overflow-y: auto;">';
      Object.keys(inspectorData).sort().forEach(inspector => {
        const data = inspectorData[inspector];
        const avgPerMonth = data.dates.length > 0 ? 
          (data.dates.length / (new Set(data.dates.map(d => d.substring(0, 7))).size || 1)).toFixed(1) : 0;
        
        reportHtml += `
          <div style="border: 1px solid #ddd; border-radius: 10px; padding: 15px; margin-bottom: 15px; background: #f8f9fa;">
            <h4 style="color: #667eea; margin-bottom: 10px;">ğŸ‘¨â€âš•ï¸ ${inspector}</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
              <div><strong>Ø¹Ø¯Ø¯ Ø§Ù„ØªÙØªÙŠØ´Ø§Øª:</strong> ${data.count}</div>
              <div><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚:</strong> ${data.areas.size}</div>
              <div><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ù„Ø§Øª:</strong> ${data.shops.size}</div>
              <div><strong>Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙØªÙŠØ´ Ø§Ù„Ø´Ù‡Ø±ÙŠ:</strong> ${avgPerMonth}</div>
            </div>
          </div>
        `;
      });
      reportHtml += '</div>';
      
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 800px;">
          <div class="modal-header">
            <h3 class="modal-title">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙØªØ´ÙŠÙ†</h3>
            <button class="modal-close" onclick="closeModal('inspectorReportModal')">&times;</button>
          </div>
          <div class="modal-body">
            ${reportHtml}
          </div>
          <div class="modal-footer">
            <button class="btn btn-primary" onclick="exportReport('inspector')">
              <i class="fas fa-download"></i> ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            </button>
            <button class="btn btn-secondary" onclick="closeModal('inspectorReportModal')">
              Ø¥ØºÙ„Ø§Ù‚
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
      logActivity("ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙØªØ´ÙŠÙ†", "ØªÙ… Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙØªØ´ÙŠÙ†");
    }
    
    function generateAreaReport() {
      if (!planData || !planData.inspectionData) {
        alert("âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªÙ‚Ø±ÙŠØ±!");
        return;
      }
      
      const modal = document.createElement('div');
      modal.className = 'modal show';
      modal.id = 'areaReportModal';
      
      // Analyze data by area
      const areaData = {};
      planData.inspectionData.forEach(item => {
        const area = item.area || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        if (!areaData[area]) {
          areaData[area] = {
            count: 0,
            inspectors: new Set(),
            shops: new Set()
          };
        }
        areaData[area].count++;
        if (item.inspector) areaData[area].inspectors.add(item.inspector);
        if (item.shops) item.shops.forEach(shop => areaData[area].shops.add(shop));
      });
      
      let reportHtml = '<div style="max-height: 60vh; overflow-y: auto;">';
      Object.keys(areaData).sort().forEach(area => {
        const data = areaData[area];
        reportHtml += `
          <div style="border: 1px solid #ddd; border-radius: 10px; padding: 15px; margin-bottom: 15px; background: #f8f9fa;">
            <h4 style="color: #667eea; margin-bottom: 10px;">ğŸ“ ${area}</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
              <div><strong>Ø¹Ø¯Ø¯ Ø§Ù„ØªÙØªÙŠØ´Ø§Øª:</strong> ${data.count}</div>
              <div><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙØªØ´ÙŠÙ†:</strong> ${data.inspectors.size}</div>
              <div><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ù„Ø§Øª:</strong> ${data.shops.size}</div>
            </div>
          </div>
        `;
      });
      reportHtml += '</div>';
      
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 800px;">
          <div class="modal-header">
            <h3 class="modal-title">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</h3>
            <button class="modal-close" onclick="closeModal('areaReportModal')">&times;</button>
          </div>
          <div class="modal-body">
            ${reportHtml}
          </div>
          <div class="modal-footer">
            <button class="btn btn-primary" onclick="exportReport('area')">
              <i class="fas fa-download"></i> ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            </button>
            <button class="btn btn-secondary" onclick="closeModal('areaReportModal')">
              Ø¥ØºÙ„Ø§Ù‚
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
      logActivity("ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù†Ø§Ø·Ù‚", "ØªÙ… Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù†Ø§Ø·Ù‚");
    }
    
    function generateShopReport() {
      if (!planData || !planData.inspectionData) {
        alert("âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªÙ‚Ø±ÙŠØ±!");
        return;
      }
      
      const modal = document.createElement('div');
      modal.className = 'modal show';
      modal.id = 'shopReportModal';
      
      // Analyze data by shop
      const shopData = {};
      planData.inspectionData.forEach(item => {
        if (item.shops) {
          item.shops.forEach(shop => {
            if (!shopData[shop]) {
              shopData[shop] = {
                count: 0,
                inspectors: new Set(),
                areas: new Set(),
                lastInspection: null
              };
            }
            shopData[shop].count++;
            if (item.inspector) shopData[shop].inspectors.add(item.inspector);
            if (item.area) shopData[shop].areas.add(item.area);
            if (item.day) {
              if (!shopData[shop].lastInspection || item.day > shopData[shop].lastInspection) {
                shopData[shop].lastInspection = item.day;
              }
            }
          });
        }
      });
      
      // Sort by inspection count
      const sortedShops = Object.keys(shopData).sort((a, b) => shopData[b].count - shopData[a].count);
      
      let reportHtml = '<div style="max-height: 60vh; overflow-y: auto;">';
      reportHtml += `<div style="margin-bottom: 15px; padding: 10px; background: #e8f5e9; border-radius: 8px;">
        <strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­Ù„Ø§Øª:</strong> ${sortedShops.length} Ù…Ø­Ù„
      </div>`;
      
      sortedShops.forEach(shop => {
        const data = shopData[shop];
        reportHtml += `
          <div style="border: 1px solid #ddd; border-radius: 10px; padding: 15px; margin-bottom: 15px; background: #f8f9fa;">
            <h4 style="color: #667eea; margin-bottom: 10px;">ğŸª ${shop}</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
              <div><strong>Ø¹Ø¯Ø¯ Ø§Ù„ØªÙØªÙŠØ´Ø§Øª:</strong> ${data.count}</div>
              <div><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙØªØ´ÙŠÙ†:</strong> ${data.inspectors.size}</div>
              <div><strong>Ø§Ù„Ù…Ù†Ø§Ø·Ù‚:</strong> ${Array.from(data.areas).join(', ')}</div>
              <div><strong>Ø¢Ø®Ø± ØªÙØªÙŠØ´:</strong> ${data.lastInspection || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
            </div>
          </div>
        `;
      });
      reportHtml += '</div>';
      
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 900px;">
          <div class="modal-header">
            <h3 class="modal-title">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø­Ù„Ø§Øª</h3>
            <button class="modal-close" onclick="closeModal('shopReportModal')">&times;</button>
          </div>
          <div class="modal-body">
            ${reportHtml}
          </div>
          <div class="modal-footer">
            <button class="btn btn-primary" onclick="exportReport('shop')">
              <i class="fas fa-download"></i> ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            </button>
            <button class="btn btn-secondary" onclick="closeModal('shopReportModal')">
              Ø¥ØºÙ„Ø§Ù‚
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
      logActivity("ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø­Ù„Ø§Øª", "ØªÙ… Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø­Ù„Ø§Øª");
    }
    
    window.exportReport = function(type) {
      const reportName = {
        'monthly': 'Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ',
        'inspector': 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙØªØ´ÙŠÙ†',
        'area': 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù†Ø§Ø·Ù‚',
        'shop': 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø­Ù„Ø§Øª'
      }[type];
      
      alert(`âœ… Ø¬Ø§Ø±ÙŠ ØªØµØ¯ÙŠØ± ${reportName}...\n\nØ³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ø¨ØµÙŠØºØ© PDF/Excel`);
      logActivity("ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ±", `ØªÙ… Ø·Ù„Ø¨ ØªØµØ¯ÙŠØ± ${reportName}`);
    }
    
    window.closeModal = function(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.remove();
      }
    }
    
    function saveSettings() {
      const token = document.getElementById("githubToken").value.trim();
      const devMode = document.getElementById("devMode").value;
      
      if (token) {
        setToken(token);
      }
      
      localStorage.setItem("devMode", devMode);
      
      showMessage("settingsStatus", "success", "âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
      logActivity("ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª", "ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…");
    }
    
    function createBackup() {
      backupData();
    }
    
    function listBackups() {
      const backups = JSON.parse(localStorage.getItem("backups") || "[]");
      const container = document.getElementById("backupsList");
      
      if (backups.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</p>';
        return;
      }
      
      let html = '<table class="data-table"><thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead><tbody>';
      
      backups.forEach((backup, index) => {
        const date = new Date(backup.timestamp);
        html += `
          <tr>
            <td>${date.toLocaleDateString('ar-EG')}</td>
            <td>${date.toLocaleTimeString('ar-EG')}</td>
            <td>
              <button class="btn btn-primary" onclick="restoreBackupByIndex(${index})">
                <i class="fas fa-undo"></i> Ø§Ø³ØªØ¹Ø§Ø¯Ø©
              </button>
            </td>
          </tr>
        `;
      });
      
      html += '</tbody></table>';
      container.innerHTML = html;
    }
    
    function restoreBackup() {
      listBackups();
    }
    
    function restoreBackupByIndex(index) {
      if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù‡Ø°Ù‡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©ØŸ")) {
        return;
      }
      
      const backups = JSON.parse(localStorage.getItem("backups") || "[]");
      if (index >= 0 && index < backups.length) {
        planData = backups[index].data;
        document.getElementById("planEditor").value = JSON.stringify(planData, null, 2);
        alert("âœ… ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!");
        logActivity("Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©", "ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
      }
    }
    
    function updateMaintenanceMessages() {
      alert("Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØµÙŠØ§Ù†Ø© Ø¹Ù†Ø¯ ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©");
    }
    
    // ========================
    // Advanced Developer Tools
    // ========================
    
    window.openAdvancedSearch = function() {
      const modal = document.createElement('div');
      modal.className = 'modal show';
      modal.id = 'advancedSearchModal';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 900px; max-height: 90vh;">
          <div class="modal-header">
            <h3 class="modal-title">ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù… ÙˆØ§Ù„ÙÙ„ØªØ±Ø©</h3>
            <button class="modal-close" onclick="closeModal('advancedSearchModal')">&times;</button>
          </div>
          <div class="modal-body" style="overflow-y: auto; max-height: 70vh;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
              <div class="form-group">
                <label class="form-label">Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ø§Ù…</label>
                <input type="text" id="advSearchGeneral" class="form-control" placeholder="Ø£ÙŠ ÙƒÙ„Ù…Ø©...">
              </div>
              <div class="form-group">
                <label class="form-label">Ø§Ù„Ù…ÙØªØ´</label>
                <input type="text" id="advSearchInspector" class="form-control" placeholder="Ø¯. Ø§Ø³Ù… Ø§Ù„Ù…ÙØªØ´">
              </div>
              <div class="form-group">
                <label class="form-label">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
                <input type="text" id="advSearchArea" class="form-control" placeholder="Ø³ÙˆÙ‚ Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡">
              </div>
              <div class="form-group">
                <label class="form-label">Ø§Ù„Ù…Ø­Ù„</label>
                <input type="text" id="advSearchShop" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„">
              </div>
              <div class="form-group">
                <label class="form-label">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                <input type="date" id="advSearchFromDate" class="form-control">
              </div>
              <div class="form-group">
                <label class="form-label">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                <input type="date" id="advSearchToDate" class="form-control">
              </div>
            </div>
            
            <div style="margin-bottom: 20px;">
              <button class="btn btn-primary" onclick="executeAdvancedSearch()">
                <i class="fas fa-search"></i> Ø¨Ø­Ø«
              </button>
              <button class="btn btn-secondary" onclick="clearAdvancedSearch()">
                <i class="fas fa-eraser"></i> Ù…Ø³Ø­
              </button>
            </div>
            
            <div id="advancedSearchResults"></div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }
    
    window.executeAdvancedSearch = function() {
      if (!planData || !planData.inspectionData) {
        alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¨Ø­Ø«!');
        return;
      }
      
      const general = document.getElementById('advSearchGeneral').value.toLowerCase();
      const inspector = document.getElementById('advSearchInspector').value.toLowerCase();
      const area = document.getElementById('advSearchArea').value.toLowerCase();
      const shop = document.getElementById('advSearchShop').value.toLowerCase();
      const fromDate = document.getElementById('advSearchFromDate').value;
      const toDate = document.getElementById('advSearchToDate').value;
      
      const results = planData.inspectionData.filter(item => {
        const matchGeneral = !general || 
          JSON.stringify(item).toLowerCase().includes(general);
        const matchInspector = !inspector || 
          (item.inspector && item.inspector.toLowerCase().includes(inspector));
        const matchArea = !area || 
          (item.area && item.area.toLowerCase().includes(area));
        const matchShop = !shop || 
          (item.shops && item.shops.some(s => s.toLowerCase().includes(shop)));
        const matchFromDate = !fromDate || (item.day && item.day >= fromDate);
        const matchToDate = !toDate || (item.day && item.day <= toDate);
        
        return matchGeneral && matchInspector && matchArea && matchShop && 
               matchFromDate && matchToDate;
      });
      
      const container = document.getElementById('advancedSearchResults');
      if (results.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬</p>';
        return;
      }
      
      let html = `<div style="background: #e8f5e9; padding: 10px; border-radius: 8px; margin-bottom: 15px;">
        <strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬:</strong> ${results.length}
      </div>`;
      
      results.forEach((item, index) => {
        html += `
          <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 10px; background: white;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
              <div><strong>Ø§Ù„Ù…ÙØªØ´:</strong> <span style="font-size: 0.9em;">${item.inspector || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span></div>
              <div><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> <span style="font-size: 0.9em;">${item.day || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span></div>
              <div><strong>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</strong> ${item.area || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
              <div><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ù„Ø§Øª:</strong> ${item.shops ? item.shops.length : 0}</div>
            </div>
            ${item.shops ? `<div style="margin-top: 10px;"><strong>Ø§Ù„Ù…Ø­Ù„Ø§Øª:</strong> ${item.shops.join(', ')}</div>` : ''}
          </div>
        `;
      });
      
      container.innerHTML = html;
    }
    
    window.clearAdvancedSearch = function() {
      document.getElementById('advSearchGeneral').value = '';
      document.getElementById('advSearchInspector').value = '';
      document.getElementById('advSearchArea').value = '';
      document.getElementById('advSearchShop').value = '';
      document.getElementById('advSearchFromDate').value = '';
      document.getElementById('advSearchToDate').value = '';
      document.getElementById('advancedSearchResults').innerHTML = '';
    }
    
    window.openCodeInspector = function() {
      const modal = document.createElement('div');
      modal.className = 'modal show';
      modal.id = 'codeInspectorModal';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 95%; max-height: 95vh;">
          <div class="modal-header">
            <h3 class="modal-title">ğŸ”§ Ù…ÙØªØ´ Ø§Ù„ÙƒÙˆØ¯ - Code Inspector</h3>
            <button class="modal-close" onclick="closeModal('codeInspectorModal')">&times;</button>
          </div>
          <div class="modal-body" style="overflow-y: auto; max-height: 75vh;">
            <div style="margin-bottom: 20px; padding: 15px; background: #e3f2fd; border-radius: 10px;">
              <h4 style="margin-bottom: 10px;">ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h4>
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                <div><strong>Ø­Ø¬Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</strong> <span id="dataSize">-</span></div>
                <div><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª:</strong> <span id="recordCount">-</span></div>
                <div><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙØªØ§Ø­Ø§Øª:</strong> <span id="keyCount">-</span></div>
                <div><strong>Ø§Ù„Ø¨Ù†ÙŠØ©:</strong> <span id="dataStructure">-</span></div>
              </div>
            </div>
            
            <div style="margin-bottom: 20px;">
              <h4 style="margin-bottom: 10px;">ğŸ” ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h4>
              <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="analyzeDataStructure()">
                  <i class="fas fa-sitemap"></i> ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù†ÙŠØ©
                </button>
                <button class="btn btn-success" onclick="findDuplicates()">
                  <i class="fas fa-copy"></i> Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª
                </button>
                <button class="btn btn-warning" onclick="findMissingData()">
                  <i class="fas fa-exclamation-triangle"></i> Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø§Ù‚ØµØ©
                </button>
                <button class="btn btn-info" onclick="generateStatistics()">
                  <i class="fas fa-chart-bar"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø´Ø§Ù…Ù„Ø©
                </button>
              </div>
            </div>
            
            <div id="codeInspectorResults" style="background: #f8f9fa; padding: 15px; border-radius: 10px; font-family: 'Courier New', monospace; white-space: pre-wrap; max-height: 400px; overflow-y: auto;">
              Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ­Ù„ÙŠÙ„...
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
      
      // Update initial data
      if (planData) {
        document.getElementById('dataSize').textContent = 
          (JSON.stringify(planData).length / 1024).toFixed(2) + ' KB';
        document.getElementById('recordCount').textContent = 
          planData.inspectionData ? planData.inspectionData.length : 0;
        document.getElementById('keyCount').textContent = 
          Object.keys(planData).length;
        document.getElementById('dataStructure').textContent = 
          Array.isArray(planData.inspectionData) ? 'Array' : 'Object';
      }
    }
    
    window.analyzeDataStructure = function() {
      if (!planData) {
        alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØ­Ù„ÙŠÙ„!');
        return;
      }
      
      const analysis = {
        totalRecords: planData.inspectionData ? planData.inspectionData.length : 0,
        uniqueInspectors: new Set(),
        uniqueAreas: new Set(),
        uniqueShops: new Set(),
        dateRange: { min: null, max: null },
        shiftDistribution: { 'ØµØ¨Ø§Ø­ÙŠØ©': 0, 'Ù…Ø³Ø§Ø¦ÙŠØ©': 0 }
      };
      
      if (planData.inspectionData) {
        planData.inspectionData.forEach(item => {
          if (item.inspector) analysis.uniqueInspectors.add(item.inspector);
          if (item.area) analysis.uniqueAreas.add(item.area);
          if (item.shops) item.shops.forEach(s => analysis.uniqueShops.add(s));
          if (item.day) {
            if (!analysis.dateRange.min || item.day < analysis.dateRange.min) 
              analysis.dateRange.min = item.day;
            if (!analysis.dateRange.max || item.day > analysis.dateRange.max) 
              analysis.dateRange.max = item.day;
          }
          if (item.shift) {
            analysis.shiftDistribution[item.shift] = 
              (analysis.shiftDistribution[item.shift] || 0) + 1;
          }
        });
      }
      
      const result = `
ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„
${'='.repeat(50)}

ğŸ“ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:
   â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ${analysis.totalRecords}
   â€¢ Ø§Ù„Ù…ÙØªØ´ÙˆÙ† Ø§Ù„ÙØ±ÙŠØ¯ÙˆÙ†: ${analysis.uniqueInspectors.size}
   â€¢ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„ÙØ±ÙŠØ¯Ø©: ${analysis.uniqueAreas.size}
   â€¢ Ø§Ù„Ù…Ø­Ù„Ø§Øª Ø§Ù„ÙØ±ÙŠØ¯Ø©: ${analysis.uniqueShops.size}

ğŸ“… Ù†Ø·Ø§Ù‚ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®:
   â€¢ Ù…Ù†: ${analysis.dateRange.min || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
   â€¢ Ø¥Ù„Ù‰: ${analysis.dateRange.max || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}

â° ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙØªØ±Ø§Øª:
   â€¢ ØµØ¨Ø§Ø­ÙŠØ©: ${analysis.shiftDistribution['ØµØ¨Ø§Ø­ÙŠØ©']}
   â€¢ Ù…Ø³Ø§Ø¦ÙŠØ©: ${analysis.shiftDistribution['Ù…Ø³Ø§Ø¦ÙŠØ©']}

ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØªØ´ÙŠÙ†:
${Array.from(analysis.uniqueInspectors).map((i, idx) => `   ${idx + 1}. ${i}`).join('\n')}

ğŸ“ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø§Ø·Ù‚:
${Array.from(analysis.uniqueAreas).map((a, idx) => `   ${idx + 1}. ${a}`).join('\n')}
      `;
      
      document.getElementById('codeInspectorResults').textContent = result;
    }
    
    window.findDuplicates = function() {
      if (!planData || !planData.inspectionData) {
        alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ÙØ­Øµ!');
        return;
      }
      
      const duplicates = [];
      const seen = new Map();
      
      planData.inspectionData.forEach((item, index) => {
        const key = `${item.inspector}_${item.day}_${item.area}`;
        if (seen.has(key)) {
          duplicates.push({
            index1: seen.get(key),
            index2: index,
            key: key,
            item: item
          });
        } else {
          seen.set(key, index);
        }
      });
      
      let result = `
ğŸ” ÙØ­Øµ Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª
${'='.repeat(50)}

`;
      
      if (duplicates.length === 0) {
        result += 'âœ… Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªÙƒØ±Ø§Ø±Ø§Øª!\n\nØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø¸ÙŠÙØ© ÙˆØ®Ø§Ù„ÙŠØ© Ù…Ù† Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª.';
      } else {
        result += `âš ï¸ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${duplicates.length} ØªÙƒØ±Ø§Ø±!\n\n`;
        duplicates.forEach((dup, idx) => {
          result += `${idx + 1}. Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¨ÙŠÙ† Ø§Ù„Ø³Ø·Ø± ${dup.index1 + 1} ÙˆØ§Ù„Ø³Ø·Ø± ${dup.index2 + 1}\n`;
          result += `   Ø§Ù„Ù…ÙØªØ´: ${dup.item.inspector}\n`;
          result += `   Ø§Ù„ØªØ§Ø±ÙŠØ®: ${dup.item.day}\n`;
          result += `   Ø§Ù„Ù…Ù†Ø·Ù‚Ø©: ${dup.item.area}\n\n`;
        });
      }
      
      document.getElementById('codeInspectorResults').textContent = result;
    }
    
    window.findMissingData = function() {
      if (!planData || !planData.inspectionData) {
        alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ÙØ­Øµ!');
        return;
      }
      
      const missing = [];
      
      planData.inspectionData.forEach((item, index) => {
        const issues = [];
        if (!item.inspector) issues.push('Ø§Ù„Ù…ÙØªØ´');
        if (!item.day) issues.push('Ø§Ù„ØªØ§Ø±ÙŠØ®');
        if (!item.area) issues.push('Ø§Ù„Ù…Ù†Ø·Ù‚Ø©');
        if (!item.shops || item.shops.length === 0) issues.push('Ø§Ù„Ù…Ø­Ù„Ø§Øª');
        
        if (issues.length > 0) {
          missing.push({ index, issues, item });
        }
      });
      
      let result = `
âš ï¸ ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø§Ù‚ØµØ©
${'='.repeat(50)}

`;
      
      if (missing.length === 0) {
        result += 'âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø©!\n\nÙ„Ø§ ØªÙˆØ¬Ø¯ Ø­Ù‚ÙˆÙ„ Ù†Ø§Ù‚ØµØ© ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.';
      } else {
        result += `âŒ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${missing.length} Ø³Ø¬Ù„ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©!\n\n`;
        missing.forEach((item, idx) => {
          result += `${idx + 1}. Ø§Ù„Ø³Ø·Ø± ${item.index + 1}:\n`;
          result += `   Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø§Ù‚ØµØ©: ${item.issues.join(', ')}\n`;
          if (item.item.inspector) result += `   Ø§Ù„Ù…ÙØªØ´: ${item.item.inspector}\n`;
          if (item.item.day) result += `   Ø§Ù„ØªØ§Ø±ÙŠØ®: ${item.item.day}\n`;
          result += '\n';
        });
      }
      
      document.getElementById('codeInspectorResults').textContent = result;
    }
    
    window.openBulkOperations = function() {
      const modal = document.createElement('div');
      modal.className = 'modal show';
      modal.id = 'bulkOpsModal';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 800px;">
          <div class="modal-header">
            <h3 class="modal-title">âš¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø¬Ù…Ø¹Ø© - Bulk Operations</h3>
            <button class="modal-close" onclick="closeModal('bulkOpsModal')">&times;</button>
          </div>
          <div class="modal-body">
            <div style="margin-bottom: 20px; padding: 15px; background: #fff3cd; border-radius: 8px;">
              <strong>âš ï¸ ØªÙ†Ø¨ÙŠÙ‡:</strong> Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø¬Ù…Ø¹Ø© Ù‚Ø¯ ØªØºÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ«ÙŠØ±Ø© Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©. Ø§Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹!
            </div>
            
            <div class="quick-actions" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
              <div class="quick-action-btn" onclick="bulkUpdateShift()">
                <i class="fas fa-clock"></i>
                <div class="label">ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØªØ±Ø©</div>
              </div>
              <div class="quick-action-btn" onclick="bulkUpdateArea()">
                <i class="fas fa-map-marked"></i>
                <div class="label">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</div>
              </div>
              <div class="quick-action-btn" onclick="bulkDeleteByDate()">
                <i class="fas fa-trash"></i>
                <div class="label">Ø­Ø°Ù Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®</div>
              </div>
              <div class="quick-action-btn" onclick="bulkExportFiltered()">
                <i class="fas fa-file-export"></i>
                <div class="label">ØªØµØ¯ÙŠØ± Ù…ÙÙ„ØªØ±</div>
              </div>
              <div class="quick-action-btn" onclick="bulkMergeShops()">
                <i class="fas fa-compress-arrows-alt"></i>
                <div class="label">Ø¯Ù…Ø¬ Ø§Ù„Ù…Ø­Ù„Ø§Øª</div>
              </div>
              <div class="quick-action-btn" onclick="bulkSortData()">
                <i class="fas fa-sort-amount-down"></i>
                <div class="label">ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
              </div>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }
    
    window.bulkUpdateShift = function() {
      if (!planData || !planData.inspectionData) {
        alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª!');
        return;
      }
      
      const oldShift = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© (ØµØ¨Ø§Ø­ÙŠØ©/Ù…Ø³Ø§Ø¦ÙŠØ©):');
      if (!oldShift) return;
      
      const newShift = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (ØµØ¨Ø§Ø­ÙŠØ©/Ù…Ø³Ø§Ø¦ÙŠØ©):');
      if (!newShift) return;
      
      let count = 0;
      planData.inspectionData.forEach(item => {
        if (item.shift === oldShift) {
          item.shift = newShift;
          count++;
        }
      });
      
      document.getElementById('planEditor').value = JSON.stringify(planData, null, 2);
      alert(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ${count} Ø³Ø¬Ù„ Ù…Ù† "${oldShift}" Ø¥Ù„Ù‰ "${newShift}"`);
      logActivity('Ø¹Ù…Ù„ÙŠØ© Ù…Ø¬Ù…Ø¹Ø©', `ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØªØ±Ø©: ${count} Ø³Ø¬Ù„`);
    }
    
    window.bulkUpdateArea = function() {
      if (!planData || !planData.inspectionData) {
        alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª!');
        return;
      }
      
      const oldArea = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©:');
      if (!oldArea) return;
      
      const newArea = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:');
      if (!newArea) return;
      
      let count = 0;
      planData.inspectionData.forEach(item => {
        if (item.area === oldArea) {
          item.area = newArea;
          count++;
        }
      });
      
      document.getElementById('planEditor').value = JSON.stringify(planData, null, 2);
      alert(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ${count} Ø³Ø¬Ù„ Ù…Ù† "${oldArea}" Ø¥Ù„Ù‰ "${newArea}"`);
      logActivity('Ø¹Ù…Ù„ÙŠØ© Ù…Ø¬Ù…Ø¹Ø©', `ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†Ø·Ù‚Ø©: ${count} Ø³Ø¬Ù„`);
    }
    
    window.bulkDeleteByDate = function() {
      if (!planData || !planData.inspectionData) {
        alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª!');
        return;
      }
      
      const date = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„Ù„Ø­Ø°Ù (YYYY-MM-DD) Ø£Ùˆ Ø´Ù‡Ø± (YYYY-MM):');
      if (!date) return;
      
      if (!confirm(`âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ "${date}"ØŸ`)) return;
      
      const beforeCount = planData.inspectionData.length;
      planData.inspectionData = planData.inspectionData.filter(item => 
        !item.day || !item.day.includes(date)
      );
      const deletedCount = beforeCount - planData.inspectionData.length;
      
      document.getElementById('planEditor').value = JSON.stringify(planData, null, 2);
      alert(`âœ… ØªÙ… Ø­Ø°Ù ${deletedCount} Ø³Ø¬Ù„`);
      logActivity('Ø¹Ù…Ù„ÙŠØ© Ù…Ø¬Ù…Ø¹Ø©', `Ø­Ø°Ù Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®: ${deletedCount} Ø³Ø¬Ù„`);
    }
    
    window.bulkExportFiltered = function() {
      if (!planData || !planData.inspectionData) {
        alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª!');
        return;
      }
      
      const filter = prompt('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù„Ù„ÙÙ„ØªØ±Ø© (Ù…ÙØªØ´ØŒ Ù…Ù†Ø·Ù‚Ø©ØŒ Ø£Ùˆ Ø£ÙŠ ÙƒÙ„Ù…Ø©):');
      if (!filter) return;
      
      const filtered = planData.inspectionData.filter(item => 
        JSON.stringify(item).toLowerCase().includes(filter.toLowerCase())
      );
      
      if (filtered.length === 0) {
        alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø³Ø¬Ù„Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ø§Ù„ÙÙ„ØªØ±!');
        return;
      }
      
      const exportData = { inspectionData: filtered };
      const dataStr = JSON.stringify(exportData, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `filtered-data-${filter}-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      alert(`âœ… ØªÙ… ØªØµØ¯ÙŠØ± ${filtered.length} Ø³Ø¬Ù„!`);
      logActivity('Ø¹Ù…Ù„ÙŠØ© Ù…Ø¬Ù…Ø¹Ø©', `ØªØµØ¯ÙŠØ± Ù…ÙÙ„ØªØ±: ${filtered.length} Ø³Ø¬Ù„`);
    }
    
    window.bulkMergeShops = function() {
      alert('ğŸ”§ Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© ØªØ¯Ù…Ø¬ Ø§Ù„Ù…Ø­Ù„Ø§Øª Ø§Ù„Ù…ØªØ´Ø§Ø¨Ù‡Ø© ÙÙŠ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡.\n\nÙ‚Ø±ÙŠØ¨Ø§Ù‹ Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§...');
    }
    
    window.bulkSortData = function() {
      if (!planData || !planData.inspectionData) {
        alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª!');
        return;
      }
      
      const sortBy = prompt('Ø§Ù„ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨:\n1. Ø§Ù„ØªØ§Ø±ÙŠØ®\n2. Ø§Ù„Ù…ÙØªØ´\n3. Ø§Ù„Ù…Ù†Ø·Ù‚Ø©\n\nØ£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù…:');
      
      if (sortBy === '1') {
        planData.inspectionData.sort((a, b) => 
          (a.day || '').localeCompare(b.day || '')
        );
      } else if (sortBy === '2') {
        planData.inspectionData.sort((a, b) => 
          (a.inspector || '').localeCompare(b.inspector || '')
        );
      } else if (sortBy === '3') {
        planData.inspectionData.sort((a, b) => 
          (a.area || '').localeCompare(b.area || '')
        );
      } else {
        alert('âŒ Ø§Ø®ØªÙŠØ§Ø± ØºÙŠØ± ØµØ­ÙŠØ­!');
        return;
      }
      
      document.getElementById('planEditor').value = JSON.stringify(planData, null, 2);
      alert('âœ… ØªÙ… ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
      logActivity('Ø¹Ù…Ù„ÙŠØ© Ù…Ø¬Ù…Ø¹Ø©', 'ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
    }
    
    window.openDataTransformer = function() {
      const modal = document.createElement('div');
      modal.className = 'modal show';
      modal.id = 'dataTransformerModal';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 900px;">
          <div class="modal-header">
            <h3 class="modal-title">ğŸ”„ Ù…Ø­ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Data Transformer</h3>
            <button class="modal-close" onclick="closeModal('dataTransformerModal')">&times;</button>
          </div>
          <div class="modal-body">
            <div style="margin-bottom: 20px; padding: 15px; background: #e3f2fd; border-radius: 8px;">
              <strong>â„¹ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø©:</strong> Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© Ù„ØªØ­ÙˆÙŠÙ„ ÙˆØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            </div>
            
            <div class="form-group">
              <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„</label>
              <select id="transformType" class="form-control">
                <option value="json-to-csv">JSON Ø¥Ù„Ù‰ CSV</option>
                <option value="json-to-excel">JSON Ø¥Ù„Ù‰ Excel Format</option>
                <option value="normalize">ØªØ·Ø¨ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</option>
                <option value="deduplicate">Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª</option>
                <option value="fill-missing">Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø§Ù‚ØµØ©</option>
              </select>
            </div>
            
            <button class="btn btn-primary" onclick="executeTransform()">
              <i class="fas fa-magic"></i> ØªÙ†ÙÙŠØ° Ø§Ù„ØªØ­ÙˆÙŠÙ„
            </button>
            
            <div id="transformResult" style="margin-top: 20px;"></div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }
    
    window.executeTransform = function() {
      if (!planData || !planData.inspectionData) {
        alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª!');
        return;
      }
      
      const type = document.getElementById('transformType').value;
      const result = document.getElementById('transformResult');
      
      switch(type) {
        case 'json-to-csv':
          const csv = convertToCSV(planData.inspectionData);
          result.innerHTML = `
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
              <h4>Ù…Ø¹Ø§ÙŠÙ†Ø© CSV:</h4>
              <pre style="white-space: pre-wrap; max-height: 300px; overflow-y: auto;">${csv}</pre>
              <button class="btn btn-success" onclick="downloadCSV()">
                <i class="fas fa-download"></i> ØªØ­Ù…ÙŠÙ„ CSV
              </button>
            </div>
          `;
          window.currentCSV = csv;
          break;
          
        case 'normalize':
          normalizeData();
          result.innerHTML = `<div class="status-message" style="background: #d4edda; color: #155724; padding: 15px; border-radius: 8px;">
            âœ… ØªÙ… ØªØ·Ø¨ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ØªÙˆØ­ÙŠØ¯ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ØŒ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø§Ù„Ø²Ø§Ø¦Ø¯Ø©)
          </div>`;
          break;
          
        case 'deduplicate':
          const beforeCount = planData.inspectionData.length;
          removeDuplicates();
          const afterCount = planData.inspectionData.length;
          result.innerHTML = `<div class="status-message" style="background: #d4edda; color: #155724; padding: 15px; border-radius: 8px;">
            âœ… ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© ${beforeCount - afterCount} ØªÙƒØ±Ø§Ø±
          </div>`;
          break;
          
        case 'fill-missing':
          fillMissingData();
          result.innerHTML = `<div class="status-message" style="background: #d4edda; color: #155724; padding: 15px; border-radius: 8px;">
            âœ… ØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø§Ù‚ØµØ© Ø¨Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
          </div>`;
          break;
          
        default:
          result.innerHTML = `<div class="status-message" style="background: #fff3cd; color: #856404; padding: 15px; border-radius: 8px;">
            âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±
          </div>`;
      }
      
      logActivity('ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', `Ù†ÙˆØ¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„: ${type}`);
    }
    
    function convertToCSV(data) {
      if (!data || data.length === 0) return '';
      
      const headers = ['Ø§Ù„Ù…ÙØªØ´', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ù„ÙØªØ±Ø©', 'Ø§Ù„Ù…Ù†Ø·Ù‚Ø©', 'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ù„Ø§Øª', 'Ø§Ù„Ù…Ø­Ù„Ø§Øª'];
      let csv = headers.join(',') + '\n';
      
      data.forEach(item => {
        const row = [
          item.inspector || '',
          item.day || '',
          item.shift || '',
          item.area || '',
          item.shops ? item.shops.length : 0,
          item.shops ? item.shops.join('; ') : ''
        ];
        csv += row.map(cell => `"${cell}"`).join(',') + '\n';
      });
      
      return csv;
    }
    
    window.downloadCSV = function() {
      const blob = new Blob([window.currentCSV], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `plan-data-${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      URL.revokeObjectURL(url);
    }
    
    function normalizeData() {
      planData.inspectionData.forEach(item => {
        if (item.inspector) item.inspector = item.inspector.trim();
        if (item.area) item.area = item.area.trim();
        if (item.shops) item.shops = item.shops.map(s => s.trim());
      });
      document.getElementById('planEditor').value = JSON.stringify(planData, null, 2);
    }
    
    function removeDuplicates() {
      const seen = new Set();
      planData.inspectionData = planData.inspectionData.filter(item => {
        const key = `${item.inspector}_${item.day}_${item.area}`;
        if (seen.has(key)) return false;
        seen.add(key);
        return true;
      });
      document.getElementById('planEditor').value = JSON.stringify(planData, null, 2);
    }
    
    function fillMissingData() {
      planData.inspectionData.forEach(item => {
        if (!item.inspector) item.inspector = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        if (!item.area) item.area = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        if (!item.shift) item.shift = 'ØµØ¨Ø§Ø­ÙŠØ©';
        if (!item.shops) item.shops = [];
      });
      document.getElementById('planEditor').value = JSON.stringify(planData, null, 2);
    }
    
    window.generateStatistics = function() {
      if (!planData || !planData.inspectionData) {
        alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØ­Ù„ÙŠÙ„!');
        return;
      }
      
      const stats = {
        inspectors: {},
        areas: {},
        months: {},
        totalShops: 0
      };
      
      planData.inspectionData.forEach(item => {
        // Count by inspector
        if (item.inspector) {
          stats.inspectors[item.inspector] = 
            (stats.inspectors[item.inspector] || 0) + 1;
        }
        
        // Count by area
        if (item.area) {
          stats.areas[item.area] = 
            (stats.areas[item.area] || 0) + 1;
        }
        
        // Count by month
        if (item.day) {
          const month = item.day.substring(0, 7);
          stats.months[month] = 
            (stats.months[month] || 0) + 1;
        }
        
        // Total shops
        if (item.shops) {
          stats.totalShops += item.shops.length;
        }
      });
      
      // Sort by count
      const topInspectors = Object.entries(stats.inspectors)
        .sort((a, b) => b[1] - a[1]).slice(0, 10);
      const topAreas = Object.entries(stats.areas)
        .sort((a, b) => b[1] - a[1]).slice(0, 10);
      
      let result = `
ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø´Ø§Ù…Ù„Ø©
${'='.repeat(50)}

ğŸ“ˆ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø§Ù…Ø©:
   â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙØªÙŠØ´Ø§Øª: ${planData.inspectionData.length}
   â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­Ù„Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©: ${stats.totalShops}
   â€¢ Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø­Ù„Ø§Øª Ù„ÙƒÙ„ ØªÙØªÙŠØ´: ${(stats.totalShops / planData.inspectionData.length).toFixed(2)}

ğŸ‘¨â€âš•ï¸ Ø£ÙƒØ«Ø± Ø§Ù„Ù…ÙØªØ´ÙŠÙ† Ù†Ø´Ø§Ø·Ø§Ù‹:
${topInspectors.map(([name, count], idx) => 
  `   ${idx + 1}. ${name}: ${count} ØªÙØªÙŠØ´`).join('\n')}

ğŸ“ Ø£ÙƒØ«Ø± Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ ØªÙØªÙŠØ´Ø§Ù‹:
${topAreas.map(([name, count], idx) => 
  `   ${idx + 1}. ${name}: ${count} ØªÙØªÙŠØ´`).join('\n')}

ğŸ“… Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø´Ù‡Ø±ÙŠ:
${Object.entries(stats.months).sort().map(([month, count]) => 
  `   ${month}: ${count} ØªÙØªÙŠØ´`).join('\n')}
      `;
      
      document.getElementById('codeInspectorResults').textContent = result;
    }
    
    // ========================
    // Maintenance Configuration Functions
    // ========================
    const configPath = "maintenance-config.json";
    
    // Load current maintenance configuration
    async function loadMaintenanceConfig() {
      const token = getToken();
      if (!token) {
        showMessage("configStatus", "error", "âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
        return;
      }
      
      try {
        showMessage("configStatus", "info", "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª...");
        
        const res = await fetch(`https://api.github.com/repos/${repo}/contents/${configPath}`, {
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          }
        });
        
        if (res.ok) {
          const file = await res.json();
          const config = JSON.parse(decodeURIComponent(escape(atob(file.content))));
          
          // Update UI with current config
          document.getElementById('checkIntervalSelect').value = config.checkInterval || 10000;
          
          const musicEnabledRadios = document.querySelectorAll('input[name="musicEnabled"]');
          musicEnabledRadios.forEach(radio => {
            radio.checked = radio.value === String(config.musicEnabled);
          });
          
          document.getElementById('musicDurationSelect').value = config.musicDuration || 600000;
          
          const volumePercent = Math.round((config.musicVolume || 0.15) * 100);
          document.getElementById('musicVolumeSlider').value = volumePercent;
          document.getElementById('volumeValue').textContent = volumePercent + '%';
          
          // Update status display
          updateConfigStatusDisplay(config);
          
          showMessage("configStatus", "success", "âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
        } else {
          showMessage("configStatus", "warning", "âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„Ù Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª - Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©");
        }
      } catch (error) {
        showMessage("configStatus", "error", "âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª: " + error.message);
      }
    }
    
    // Update status display
    function updateConfigStatusDisplay(config) {
      const intervalLabels = {
        0: "Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙØ­Øµ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ",
        5000: "5 Ø«ÙˆØ§Ù†Ù (Ø³Ø±ÙŠØ¹ Ø¬Ø¯Ø§Ù‹)",
        10000: "10 Ø«ÙˆØ§Ù†Ù (Ø§ÙØªØ±Ø§Ø¶ÙŠ)",
        30000: "30 Ø«Ø§Ù†ÙŠØ© (Ù…ØªÙˆØ³Ø·)",
        60000: "60 Ø«Ø§Ù†ÙŠØ© (Ø¨Ø·ÙŠØ¡)",
        300000: "5 Ø¯Ù‚Ø§Ø¦Ù‚ (Ø¨Ø·ÙŠØ¡ Ø¬Ø¯Ø§Ù‹)"
      };
      
      const durationLabels = {
        0: "ØªØ´ØºÙŠÙ„ Ù…Ø³ØªÙ…Ø± (Ø¨Ø¯ÙˆÙ† Ø¥ÙŠÙ‚Ø§Ù)",
        30000: "30 Ø«Ø§Ù†ÙŠØ©",
        60000: "Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©",
        300000: "5 Ø¯Ù‚Ø§Ø¦Ù‚",
        600000: "10 Ø¯Ù‚Ø§Ø¦Ù‚ (Ø§ÙØªØ±Ø§Ø¶ÙŠ)",
        1800000: "30 Ø¯Ù‚ÙŠÙ‚Ø©"
      };
      
      document.getElementById('currentCheckInterval').textContent = intervalLabels[config.checkInterval] || config.checkIntervalLabel || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
      document.getElementById('currentMusicEnabled').textContent = config.musicEnabled ? "âœ… Ù…ÙØ¹Ù‘Ù„" : "âŒ Ù…Ø¹Ø·Ù‘Ù„";
      document.getElementById('currentMusicDuration').textContent = durationLabels[config.musicDuration] || config.musicDurationLabel || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
      document.getElementById('currentMusicVolume').textContent = Math.round((config.musicVolume || 0.15) * 100) + '%';
    }
    
    // Save maintenance configuration
    async function saveMaintenanceConfig() {
      const token = getToken();
      if (!token) {
        showTokenModal();
        return;
      }
      
      if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­ÙØ¸ Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªØŸ\n\nØ³ØªØ¤Ø«Ø± Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© ÙÙˆØ±Ø§Ù‹.")) {
        return;
      }
      
      try {
        showMessage("configStatus", "info", "Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª...");
        
        const checkInterval = parseInt(document.getElementById('checkIntervalSelect').value);
        const musicEnabled = document.querySelector('input[name="musicEnabled"]:checked').value === 'true';
        const musicDuration = parseInt(document.getElementById('musicDurationSelect').value);
        const musicVolume = parseInt(document.getElementById('musicVolumeSlider').value) / 100;
        
        const intervalLabels = {
          0: "Ø¥ÙŠÙ‚Ø§Ù",
          5000: "5 Ø«ÙˆØ§Ù†Ù",
          10000: "10 Ø«ÙˆØ§Ù†Ù",
          30000: "30 Ø«Ø§Ù†ÙŠØ©",
          60000: "60 Ø«Ø§Ù†ÙŠØ©",
          300000: "5 Ø¯Ù‚Ø§Ø¦Ù‚"
        };
        
        const durationLabels = {
          0: "Ù…Ø³ØªÙ…Ø±",
          30000: "30 Ø«Ø§Ù†ÙŠØ©",
          60000: "Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©",
          300000: "5 Ø¯Ù‚Ø§Ø¦Ù‚",
          600000: "10 Ø¯Ù‚Ø§Ø¦Ù‚",
          1800000: "30 Ø¯Ù‚ÙŠÙ‚Ø©"
        };
        
        const config = {
          checkInterval: checkInterval,
          checkIntervalLabel: intervalLabels[checkInterval] || checkInterval + " Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©",
          musicEnabled: musicEnabled,
          musicDuration: musicDuration,
          musicDurationLabel: durationLabels[musicDuration] || musicDuration + " Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©",
          musicVolume: musicVolume,
          lastUpdated: new Date().toISOString(),
          updatedBy: "Ø§Ù„Ù…Ø·ÙˆØ±"
        };
        
        const content = btoa(unescape(encodeURIComponent(JSON.stringify(config, null, 2))));
        
        // Get current file SHA
        const getRes = await fetch(`https://api.github.com/repos/${repo}/contents/${configPath}`, {
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          }
        });
        
        let sha = "";
        if (getRes.ok) {
          const file = await getRes.json();
          sha = file.sha;
        }
        
        const res = await fetch(`https://api.github.com/repos/${repo}/contents/${configPath}`, {
          method: "PUT",
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: "ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø© ÙˆØ§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰",
            content: content,
            sha: sha
          })
        });
        
        if (res.status === 200 || res.status === 201) {
          updateConfigStatusDisplay(config);
          showMessage("configStatus", "success", "âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!\n\nğŸ“± Ø³ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø®Ù„Ø§Ù„ Ø«ÙˆØ§Ù†Ù.");
          logActivity("ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©", `ÙØ­Øµ: ${config.checkIntervalLabel}ØŒ Ù…ÙˆØ³ÙŠÙ‚Ù‰: ${musicEnabled ? 'Ù…ÙØ¹Ù‘Ù„Ø©' : 'Ù…Ø¹Ø·Ù‘Ù„Ø©'}`);
        } else {
          showMessage("configStatus", "error", "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª");
        }
      } catch (error) {
        showMessage("configStatus", "error", "âŒ Ø®Ø·Ø£: " + error.message);
      }
    }
    
    // Emergency stop all maintenance features
    async function emergencyStopAll() {
      if (!confirm("âš ï¸ ØªØ­Ø°ÙŠØ±: Ø¥ÙŠÙ‚Ø§Ù Ø·Ø§Ø±Ø¦ Ù„ÙƒÙ„ Ø´ÙŠØ¡!\n\nØ³ÙŠØªÙ…:\nâ€¢ Ø¥ÙŠÙ‚Ø§Ù ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø© ÙÙˆØ±Ø§Ù‹\nâ€¢ Ø¥ÙŠÙ‚Ø§Ù ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰\nâ€¢ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙØ­Øµ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ\n\nÙ‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) {
        return;
      }
      
      const token = getToken();
      if (!token) {
        showTokenModal();
        return;
      }
      
      try {
        showMessage("configStatus", "info", "ğŸš¨ Ø¬Ø§Ø±ÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø·Ø§Ø±Ø¦...");
        
        // 1. Disable maintenance mode
        const maintenanceData = {
          enabled: false,
          messages: {},
          disabledAt: new Date().toISOString(),
          disabledBy: "Ø§Ù„Ù…Ø·ÙˆØ± (Ø¥ÙŠÙ‚Ø§Ù Ø·Ø§Ø±Ø¦)"
        };
        
        let content = btoa(unescape(encodeURIComponent(JSON.stringify(maintenanceData, null, 2))));
        
        let getRes = await fetch(`https://api.github.com/repos/${repo}/contents/${maintenancePath}`, {
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          }
        });
        
        let sha = "";
        if (getRes.ok) {
          const file = await getRes.json();
          sha = file.sha;
        }
        
        await fetch(`https://api.github.com/repos/${repo}/contents/${maintenancePath}`, {
          method: "PUT",
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: "Ø¥ÙŠÙ‚Ø§Ù Ø·Ø§Ø±Ø¦ - Ø¥Ù„ØºØ§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©",
            content: content,
            sha: sha
          })
        });
        
        // 2. Update config to disable music and slow down checks
        const config = {
          checkInterval: 60000,
          checkIntervalLabel: "60 Ø«Ø§Ù†ÙŠØ©",
          musicEnabled: false,
          musicDuration: 0,
          musicDurationLabel: "Ù…Ø¹Ø·Ù‘Ù„",
          musicVolume: 0,
          lastUpdated: new Date().toISOString(),
          updatedBy: "Ø§Ù„Ù…Ø·ÙˆØ± (Ø¥ÙŠÙ‚Ø§Ù Ø·Ø§Ø±Ø¦)"
        };
        
        content = btoa(unescape(encodeURIComponent(JSON.stringify(config, null, 2))));
        
        getRes = await fetch(`https://api.github.com/repos/${repo}/contents/${configPath}`, {
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          }
        });
        
        sha = "";
        if (getRes.ok) {
          const file = await getRes.json();
          sha = file.sha;
        }
        
        await fetch(`https://api.github.com/repos/${repo}/contents/${configPath}`, {
          method: "PUT",
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: "Ø¥ÙŠÙ‚Ø§Ù Ø·Ø§Ø±Ø¦ - ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ ÙˆØ§Ù„ÙØ­Øµ Ø§Ù„Ø³Ø±ÙŠØ¹",
            content: content,
            sha: sha
          })
        });
        
        // Update UI
        await loadMaintenanceConfig();
        
        showMessage("configStatus", "success", "âœ… ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø·Ø§Ø±Ø¦ Ø¨Ù†Ø¬Ø§Ø­!\n\nâœ“ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©: Ù…Ø¹Ø·Ù‘Ù„\nâœ“ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰: Ù…Ø¹Ø·Ù‘Ù„Ø©\nâœ“ Ø§Ù„ÙØ­Øµ: Ù…Ø±Ø© ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©");
        showMessage("maintenanceStatus", "success", "âœ… ØªÙ… Ø¥Ù„ØºØ§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø© (Ø¥ÙŠÙ‚Ø§Ù Ø·Ø§Ø±Ø¦)");
        
        logActivity("Ø¥ÙŠÙ‚Ø§Ù Ø·Ø§Ø±Ø¦", "ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù…ÙŠØ¹ Ù…ÙŠØ²Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø© ÙˆØ§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ ÙÙˆØ±Ø§Ù‹");
      } catch (error) {
        showMessage("configStatus", "error", "âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø·Ø§Ø±Ø¦: " + error.message);
      }
    }
    
    // ========================
    // Initialization
    // ========================
    async function initDashboard() {
      const token = getToken();
      if (!token) {
        showTokenModal();
        return;
      }
      
      // Load plan data
      await loadPlan();
      
      // Load shops details for dropdowns
      await loadShopsDetails();
      
      // Initialize activity log
      refreshActivityLog();
      
      // Load maintenance configuration
      await loadMaintenanceConfig();
      
      // Log dashboard access
      logActivity("Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…", "ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©");
    }
    
    // Initialize on page load
    window.onload = function() {
      initDashboard();
    };
  </script>
</body>
</html>
