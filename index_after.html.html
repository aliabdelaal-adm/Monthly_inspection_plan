<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุฎุทุฉ ุงูุชูุชูุด ุงูุดูุฑูุฉ</title>
    <style>
        body {
            font-family: 'Cairo', Tahoma, Arial, sans-serif;
            background: #f7f8fa;
            margin: 0;
            padding: 0;
        }
        /* ... ุจููุฉ ุงูุชูุณููุงุช ููุง ูู ูู ูููู ... */
    </style>
</head>
<body>
    <div class="container">
        <!-- ุงูุนููุงู ุงูุฑุฆูุณู -->
        <div class="main-title">
            ุฎุทุฉ ุงูุชูุชูุด ุงูุดูุฑูุฉ
        </div>
        <!-- ุดุฑูุท ุงูุฃุฏูุงุช ุงูุนููู -->
        <div class="top-bar">
            <div>
                <span class="user-type-label">ููุน ุงููุณุชุฎุฏู:</span>
                <select id="userTypeSelect" onchange="handleUserTypeChange()">
                    <option value="inspector">ููุชุด</option>
                    <option value="developer">ุงููุทูุฑ</option>
                </select>
                <span id="inspectorSelectBox" style="display:inline-block;">
                    <label for="inspectorSelect">ุงุณู ุงูููุชุด:</label>
                    <select id="inspectorSelect" onchange="renderInspectorPage()"></select>
                </span>
                <button onclick="window.print()">ุทุจุงุนุฉ ุฃู ุญูุธ PDF</button>
                <button id="bellButton" onclick="playBirdSound()" title="ุชุดุบูู ุตูุช ุงูุนุตุงููุฑ" style="background: #228B22; margin-right: 10px;">๐</button>
            </div>
        </div>
        <!-- ูุฑุจุน ุงูุชูููู ูุธูุฑ ููุท ูู ูุถุน ุงููุทูุฑ -->
        <div id="apiTokenBar" class="api-token-bar" style="display:none;">
            <label for="apiTokenInput">API Token:</label>
            <input type="password" id="apiTokenInput" placeholder="ุฃุฏุฎู ุงูุชูููู ููุง" autocomplete="off" />
            <button type="button" id="saveApiTokenBtn">ุญูุธ ุงูุชูููู</button>
            <span id="apiTokenSavedMsg" class="api-token-saved" style="display:none;">ุชู ุงูุญูุธ โ</span>
            <button type="button" id="toggleApiTokenInputBtn" style="background:#888;" title="ุฅุธูุงุฑ/ุฅุฎูุงุก">๐๏ธ</button>
        </div>
        <!-- ููุญุฉ ุงูุฅุฏุงุฑุฉ ูููุทูุฑ -->
        <div id="adminPanel" style="display:none;">
            <div class="admin-panel">
                <!-- ุฅุฏุงุฑุฉ ุงูููุชุดูู -->
                <div class="admin-section">
                    <h3>ุฅุฏุงุฑุฉ ุฃุณูุงุก ุงูููุชุดูู</h3>
                    <form class="add-row-form" id="addInspectorForm">
                        <input type="text" id="newInspector" placeholder="ุงุณู ุงูููุชุด ุงูุฌุฏูุฏ" required />
                        <button type="submit">ุฅุถุงูุฉ</button>
                    </form>
                    <ul class="admin-list" id="inspectorList"></ul>
                </div>
                <!-- ุฅุฏุงุฑุฉ ุงููุญูุงุช -->
                <div class="admin-section">
                    <h3>ุฅุฏุงุฑุฉ ุฃุณูุงุก ุงููุญูุงุช</h3>
                    <form class="add-row-form" id="addShopForm">
                        <input type="text" id="newShop" placeholder="ุงุณู ุงููุญู ุงูุฌุฏูุฏ" required />
                        <button type="submit">ุฅุถุงูุฉ</button>
                    </form>
                    <ul class="admin-list" id="shopList"></ul>
                </div>
                <!-- ุฅุฏุงุฑุฉ ุงูููุงุทู -->
                <div class="admin-section">
                    <h3>ุฅุฏุงุฑุฉ ุฃุณูุงุก ุงูููุงุทู</h3>
                    <form class="add-row-form" id="addAreaForm">
                        <input type="text" id="newArea" placeholder="ุงุณู ุงูููุทูุฉ ุงูุฌุฏูุฏุฉ" required />
                        <button type="submit">ุฅุถุงูุฉ</button>
                    </form>
                    <ul class="admin-list" id="areaList"></ul>
                </div>
            </div>
            <div class="goal-section">
                <h3>ุฅุฏุงุฑุฉ ุฃูุฏุงู ุงูุชูุชูุด</h3>
                <form class="add-row-form" id="addGoalForm">
                    <input type="text" id="newGoal" placeholder="ูุฏู ุฌุฏูุฏ..." required />
                    <button type="submit">ุฅุถุงูุฉ</button>
                </form>
                <ul class="goal-list" id="goalList"></ul>
            </div>
            <!-- ุฅุฏุงุฑุฉ ุงููุญูุงุช ุญุณุจ ุงูููุทูุฉ -->
            <div class="admin-section shops-area-box">
                <div class="shops-area-title">ุฅุฏุงุฑุฉ ุงููุญูุงุช ุญุณุจ ุงูููุทูุฉ:</div>
                <div id="shopsByAreaList"></div>
                <form class="add-row-form" id="addShopByAreaForm" style="margin-top:8px;">
                    <input type="text" id="newShopByArea" placeholder="ุงุณู ูุญู ุฌุฏูุฏ" required />
                    <select id="areaForShop"></select>
                    <button type="submit">ุฅุถุงูุฉ ูุญู</button>
                </form>
            </div>
            <!-- ุชูุฒูุน ุงููุญูุงุช ุนูู ุงูููุชุดูู ูุงูุฃูุงู -->
            <div class="admin-section shops-area-box">
                <div class="shops-area-title">ุชูุฒูุน ุงููุญูุงุช ุนูู ุงูููุชุดูู ูุงูุฃูุงู:</div>
                <table class="distribution-table" style="width:100%;margin-bottom:10px;">
                    <thead>
                        <tr>
                            <th>ุงูููุชุด</th>
                            <th>ุงูููู</th>
                            <th>ุงูููุทูุฉ</th>
                            <th>ุงููุญู</th>
                            <th>ุญุฐู</th>
                        </tr>
                    </thead>
                    <tbody id="distributionTableBody"></tbody>
                </table>
                <button onclick="addDistributionRow()" style="margin-bottom: 8px;">ุฅุถุงูุฉ ุตู</button>
                <button onclick="autoDistributeShops()" style="background:#234093;color:#fff;">ุชูุฒูุน ุชููุงุฆู</button>
                <br>
                <button onclick="saveDistributionToFile()" style="background:#223;color:#fff;font-size:1.1em;padding:9px 18px;margin-top:12px;">ุญูุธ ุงูุฎุทุฉ (ุชุญููู ููู)</button>
                <button onclick="uploadDistributionToGitHub()" style="background:#19b55b;color:#fff;font-size:1.1em;padding:9px 18px;margin-top:12px;">ุญูุธ ูุฑูุน ุชููุงุฆููุง ุฅูู GitHub</button>
            </div>
        </div>
        <!-- ุตูุญุฉ ุงูููุชุด -->
        <div id="inspectorPage">
            <!-- ุฌุฏูู ุงูุชูุชูุด -->
            <div class="section-box">
                <div class="table-title">ุฌุฏูู ุงูุชูุชูุด</div>
                <table id="inspectionTable">
                    <thead>
                        <tr>
                            <th>ุงูููู</th>
                            <th>ููุช ุงูููุงูุจุฉ</th>
                            <th>ุงูููุทูุฉ</th>
                            <th>ุงููุญูุงุช</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- ุงูุตููู ุฏููุงููููุงู -->
                    </tbody>
                </table>
            </div>
            <!-- ุฅุญุตุงุฆูุงุช ุงูููุชุด -->
            <div class="section-box">
                <div class="stats-title">ุงุญุตุงุฆูุงุช ุงูุชูุชูุด</div>
                <table class="stats-table" id="inspectorStatsTable">
                    <thead>
                        <tr>
                            <th>ุนุฏุฏ ุงูุชูุชูุดุงุช (ูู ุงูุดูุฑ)</th>
                            <th>ุนุฏุฏ ุงูุชูุชูุดุงุช ุงูุตุจุงุญูุฉ</th>
                            <th>ุนุฏุฏ ุงูุชูุชูุดุงุช ุงููุณุงุฆูุฉ</th>
                            <th>ุนุฏุฏ ุงูุชูุชูุดุงุช ูู ุงูุนุทูุฉ (ุฌูุนุฉ/ุณุจุช/ุฃุญุฏ)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- ุงูุฅุญุตุงุฆูุงุช ุฏููุงููููุงู -->
                    </tbody>
                </table>
            </div>
            <!-- ุฃูุฏุงู ุงูุชูุชูุด -->
            <div class="goals-section">
                <h3>ุฃูุฏุงู ุงูุชูุชูุด ูุฐุง ุงูุดูุฑ:</h3>
                <ul id="goalsList"></ul>
            </div>
            <div class="copyright">
                ุฌููุน ุงูุญููู ูุญููุธุฉ &copy; ุงููุทูุฑ ุฏ. ุนูู ุนุจุฏุงูุนุงู
            </div>
        </div>
    </div>
    <!-- ูุงูุฐุฉ ุนุฑุถ ุงููุญูุงุช -->
    <div id="shopsModal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <h4>ูุงุฆูุฉ ุงููุญูุงุช</h4>
            <ul id="shopsList"></ul>
            <button onclick="closeShopsModal()">ุฅุบูุงู</button>
        </div>
    </div>
    <!-- ูุงูุฐุฉ ุงูุฑูู ุงูุณุฑู -->
    <div id="modalPassword" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <label>ูู ูุถูู ุฃุฏุฎู ุงูุฑูู ุงูุณุฑู ูููุทูุฑ:</label>
            <input type="password" id="passwordInput" maxlength="10" autocomplete="off" />
            <div class="error-msg" id="passwordError" style="display:none;">ุงูุฑูู ุงูุณุฑู ุบูุฑ ุตุญูุญ!</div>
            <button onclick="checkPassword()">ุฏุฎูู</button>
        </div>
    </div>
    <!-- ุตูุช ุงูุทููุฑ ุงููุบุฑุฏุฉ -->
    <audio id="birds-audio" src="https://cdn.pixabay.com/audio/2022/07/26/audio_124bfa5c1c.mp3"></audio>
    <script>
        // ... ุจุงูู ุงูุฏูุงู ุงูุจุฑูุฌูุฉ ุญุณุจ ุงูููู ุงูุฃุตูู ...
        // =============== ุฑูุน ุชููุงุฆู ููุฌุฏูู ุฅูู GitHub ===============
        async function uploadDistributionToGitHub() {
            // ุฅุนุฏุงุฏ CSV
            let csv = "ุงูููุชุด,ุงูููู,ุงูููุทูุฉ,ุงููุญูุงุช\n";
            distributionRows.forEach(row=>{
                csv += `${row.inspector},${row.day},${row.area},"${(row.shop||[]).join(' - ')}"\n`;
            });

            // ุฅุนุฏุงุฏ ุจูุงูุงุช GitHub
            const repo = "aliabdelaal-adm/Monthly_inspection_plan";
            const branch = "main";
            const path = "ุฌุฏูู_ุชูุฒูุน_ุงููุญูุงุช.csv";
            const token = getApiToken();
            if (!token) {
                alert("ูุฑุฌู ุฅุฏุฎุงู ูุญูุธ ุงูุชูููู ุฃููุงู!");
                return;
            }

            // ุงูุญุตูู ุนูู sha ุงููุฏูู (ุฅุฐุง ูุงู ุงูููู ููุฌูุฏุงู)
            let sha = undefined;
            try {
                const resp = await fetch(`https://api.github.com/repos/${repo}/contents/${encodeURIComponent(path)}?ref=${branch}`, {
                    headers: { "Authorization": `token ${token}` }
                });
                if (resp.ok) {
                    const data = await resp.json();
                    sha = data.sha;
                }
            } catch (e) {}

            // ุฑูุน ุงูููู
            try {
                const res = await fetch(`https://api.github.com/repos/${repo}/contents/${encodeURIComponent(path)}`, {
                    method: "PUT",
                    headers: {
                        "Authorization": `token ${token}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        message: "ุฑูุน ุชููุงุฆู ูุฌุฏูู ุชูุฒูุน ุงููุญูุงุช",
                        content: btoa(unescape(encodeURIComponent(csv))),
                        branch: branch,
                        sha: sha
                    })
                });
                if (res.ok) {
                    alert("ุชู ุฑูุน ุงูุฌุฏูู ุฅูู GitHub ุจูุฌุงุญ ๐");
                } else {
                    const err = await res.json();
                    alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุฑูุน: " + (err.message || res.statusText));
                }
            } catch (e) {
                alert("ุชุนุฐุฑ ุงูุงุชุตุงู ุจู GitHub: " + e.message);
            }
        }
        // ... ุจููุฉ ุงูุฏูุงู ุงูุจุฑูุฌูุฉ ...
    </script>
</body>
</html>
