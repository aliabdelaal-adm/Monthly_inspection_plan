# 🚀 دليل الميزات الجديدة في Smart Planner

## 📋 نظرة عامة

تم تفعيل جميع الميزات التي كانت قيد التطوير في Smart Planner، بما في ذلك:
- الخريطة التفاعلية والحرارية للمحلات
- دمج بيانات المحلات (المكررة والمتشابهة)
- دمج البيانات من ملفات متعددة
- التعديل الجماعي للمحلات
- الحذف الجماعي للمحلات

---

## 🗺️ الخريطة التفاعلية والحرارية

### الوصول للميزة
1. افتح Smart Planner
2. انتقل إلى تبويب "إدارة المحلات"
3. اضغط على زر "🗺️ عرض على الخريطة"

### أنواع العرض

#### 1. العرض التفاعلي (📍)
- عرض جميع المحلات كبطاقات تفاعلية
- ألوان مختلفة حسب الأولوية:
  - 🔵 أزرق: محل عادي
  - 🟡 أصفر: أولوية متوسطة (آخر تفتيش قبل 14-30 يوم)
  - 🔴 أحمر: أولوية عالية (آخر تفتيش قبل أكثر من 30 يوم)
- معلومات تفصيلية عند النقر على أي محل
- إظهار تاريخ آخر تفتيش

#### 2. الخريطة الحرارية (🔥)
- عرض كثافة المحلات في كل منطقة
- ألوان متدرجة من الأخضر (قليل) إلى الأحمر (كثير)
- نسبة الكثافة لكل منطقة
- مثالية لتحديد المناطق ذات التركيز العالي

#### 3. عرض المجموعات (🎯)
- تجميع المحلات حسب المنطقة
- عرض مرئي منظم
- سهولة رؤية توزيع المحلات

### المميزات الإضافية

#### تصفية حسب المنطقة
- اختر منطقة محددة لعرض محلاتها فقط
- تحديث الإحصائيات تلقائياً

#### الإحصائيات الفورية
- إجمالي المحلات
- المحلات المعروضة (بعد التصفية)
- عدد المناطق

#### تصدير البيانات
- تصدير المحلات المعروضة بصيغة JSON
- يتضمن: الاسم، المنطقة، المعرف
- مفيد للتحليل والمشاركة

---

## 🔗 دمج بيانات المحلات

### الوصول للميزة
1. افتح Smart Planner
2. انتقل إلى تبويب "إدارة المحلات"
3. اضغط على زر "🔗 دمج بيانات"

### أنواع الدمج

#### 1. دمج المحلات المكررة
**كيف يعمل:**
- يبحث عن المحلات ذات الأسماء المتطابقة تماماً
- يعرض قائمة بالمحلات المكررة
- يحتفظ بالمحل الأول ويحذف النسخ المكررة

**مثال:**
```
المحل الأصلي: "محل الطيور"
المحل المكرر: "محل الطيور"
النتيجة: يتم الاحتفاظ بنسخة واحدة فقط
```

#### 2. دمج المحلات المتشابهة
**كيف يعمل:**
- يستخدم خوارزمية Levenshtein Distance
- يبحث عن محلات بأسماء متشابهة (نسبة التشابه أكثر من 70%)
- يعرض نسبة التشابه لكل زوج
- يمكنك مراجعة واختيار ما يُدمج

**مثال:**
```
المحل 1: "محل الطيور الجميلة"
المحل 2: "محل الطيور الجميله"
نسبة التشابه: 95%
```

#### 3. دمج من ملف خارجي
**كيف يعمل:**
- رفع ملف JSON يحتوي على قائمة محلات
- يتم دمج المحلات الجديدة مع القائمة الحالية
- يتجنب إضافة المكررات تلقائياً

**صيغة الملف المطلوبة:**
```json
[
  {
    "id": "shop_123",
    "name": "اسم المحل",
    "areaId": "area_456"
  },
  ...
]
```

أو:
```json
{
  "shops": [
    {
      "id": "shop_123",
      "name": "اسم المحل",
      "areaId": "area_456"
    },
    ...
  ]
}
```

### عملية الدمج

1. **اختر نوع الدمج**
   - دمج المكررات فقط
   - دمج المتشابهات
   - دمج من ملف

2. **معاينة النتائج**
   - عدد المحلات الحالية
   - عدد المكررات/المضافات
   - عدد المحلات بعد الدمج

3. **تنفيذ الدمج**
   - تأكيد العملية
   - الحفظ التلقائي في GitHub
   - تحديث القائمة فوراً

---

## ✏️ التعديل الجماعي للمحلات

### الوصول للميزة
1. افتح Smart Planner
2. انتقل إلى تبويب "إدارة المحلات"
3. اضغط على زر "✏️ تعديل جماعي"

### العمليات المتاحة

#### 1. تحديد المحلات
- ☑️ تحديد الكل
- ☐ إلغاء تحديد الكل
- 🗺️ تصفية حسب المنطقة
- عداد للمحلات المحددة

#### 2. نقل إلى منطقة جديدة
- اختر منطقة من القائمة
- سيتم نقل جميع المحلات المحددة إلى المنطقة الجديدة

#### 3. إضافة بادئة (Prefix)
**مثال:**
```
قبل: "الطيور"
البادئة: "محل - "
بعد: "محل - الطيور"
```

#### 4. إضافة لاحقة (Suffix)
**مثال:**
```
قبل: "الطيور"
اللاحقة: " - الفرع الرئيسي"
بعد: "الطيور - الفرع الرئيسي"
```

### خطوات التعديل

1. حدد المحلات المراد تعديلها
2. اختر عملية أو أكثر:
   - نقل منطقة
   - إضافة بادئة
   - إضافة لاحقة
3. اضغط "✅ تطبيق التعديلات"
4. تأكيد العملية
5. الحفظ التلقائي في GitHub

**ملاحظة:** يمكنك تطبيق عدة عمليات معاً (مثل: نقل منطقة + إضافة بادئة)

---

## 🗑️ الحذف الجماعي للمحلات

### الوصول للميزة
1. افتح Smart Planner
2. انتقل إلى تبويب "إدارة المحلات"
3. اضغط على زر "🗑️ حذف جماعي"

### نظام الحماية

⚠️ **تحذير:** عملية الحذف نهائية ولا يمكن التراجع عنها!

**آليات الحماية:**
1. رسالة تحذير واضحة
2. تأكيد مزدوج
3. معاينة المحلات المحددة للحذف
4. عرض عدد المحلات التي ستُحذف

### خطوات الحذف

1. حدد المحلات المراد حذفها
   - يمكنك التصفية حسب المنطقة أولاً
   - تحديد الكل أو اختيار محلات معينة
2. راجع عدد المحلات المحددة
3. اضغط "🗑️ حذف نهائي"
4. قراءة رسالة التحذير بعناية
5. تأكيد الحذف
6. الحفظ التلقائي في GitHub

---

## 💡 نصائح وإرشادات

### أفضل الممارسات

#### للخريطة التفاعلية
- استخدم العرض التفاعلي للحصول على تفاصيل كل محل
- استخدم الخريطة الحرارية لتحديد المناطق المكتظة
- صفِّ حسب المنطقة لتحليل منطقة محددة
- صدِّر البيانات للتحليل الخارجي

#### لدمج البيانات
- ابدأ بدمج المكررات أولاً
- ثم استخدم دمج المتشابهات للعثور على نتائج إضافية
- راجع المعاينة بعناية قبل التنفيذ
- احتفظ بنسخة احتياطية قبل الدمج الكبير

#### للتعديل الجماعي
- صفِّ المحلات حسب المنطقة أولاً
- تأكد من تحديد المحلات الصحيحة
- استخدم المعاينة للتحقق من النتيجة
- يمكنك تطبيق عدة عمليات معاً

#### للحذف الجماعي
- ⚠️ **مهم جداً:** احتفظ بنسخة احتياطية قبل الحذف!
- صفِّ حسب المنطقة إذا كنت تريد حذف محلات منطقة معينة
- راجع القائمة المحددة مرتين على الأقل
- الحذف نهائي ولا يمكن التراجع عنه

### حل المشاكل

#### "لا توجد بيانات"
**الحل:** تأكد من تسجيل الدخول وتحميل البيانات أولاً

#### "فشل الحفظ"
**الحل:**
1. تحقق من صلاحية GitHub Token
2. تأكد من وجود اتصال بالإنترنت
3. تحقق من صلاحيات الكتابة على المستودع

#### "الخريطة فارغة"
**الحل:**
1. تأكد من وجود محلات في النظام
2. تحقق من تصفية المنطقة
3. حاول إعادة تحميل البيانات

---

## 🔧 التفاصيل التقنية

### الخوارزميات المستخدمة

#### Levenshtein Distance
- خوارزمية لقياس الاختلاف بين سلسلتين نصيتين
- تحسب عدد التعديلات المطلوبة لتحويل نص إلى آخر
- دقة عالية في اكتشاف التشابه

#### Heatmap Algorithm
- تجميع المحلات حسب المنطقة
- حساب الكثافة النسبية
- تخصيص ألوان متدرجة حسب الكثافة

### التكامل مع GitHub
- جميع العمليات تُحفظ مباشرة
- رسائل commit توضيحية
- إمكانية التتبع والرجوع للإصدارات السابقة

### الأمان
- نظام حماية متعدد المستويات
- تأكيد مزدوج للعمليات الحرجة
- معاينة قبل التنفيذ
- تسجيل جميع العمليات

---

## 📊 أمثلة عملية

### مثال 1: دمج المحلات المكررة

**السيناريو:** لديك قاعدة بيانات بها محلات مكررة من مصادر مختلفة

**الخطوات:**
1. افتح "دمج بيانات"
2. اختر "دمج المحلات المكررة فقط"
3. راجع القائمة:
   ```
   المحل الأصلي: "محل الطيور النادرة"
   المحل المكرر: "محل الطيور النادرة"
   ```
4. اضغط "✅ تنفيذ الدمج"
5. النتيجة: تم حذف 15 محل مكرر، المتبقي 150 محل فريد

### مثال 2: نقل محلات منطقة كاملة

**السيناريو:** تم دمج منطقتين وتريد نقل جميع المحلات

**الخطوات:**
1. افتح "تعديل جماعي"
2. صفِّ حسب "المنطقة القديمة"
3. اضغط "☑️ تحديد الكل"
4. اختر "المنطقة الجديدة" من القائمة
5. اضغط "✅ تطبيق التعديلات"
6. النتيجة: تم نقل 45 محل إلى المنطقة الجديدة

### مثال 3: عرض المحلات ذات الأولوية العالية

**السيناريو:** تريد رؤية المحلات التي لم تُفتش منذ فترة طويلة

**الخطوات:**
1. افتح "عرض على الخريطة"
2. اختر "📍 عرض تفاعلي"
3. ابحث عن المحلات الحمراء (أولوية عالية)
4. انقر على أي محل لرؤية تاريخ آخر تفتيش
5. النتيجة: رؤية واضحة للمحلات المهملة

---

## 🎯 الخلاصة

تم تفعيل جميع الميزات بنجاح! الآن يمكنك:

✅ عرض المحلات على خريطة تفاعلية وحرارية  
✅ دمج المحلات المكررة والمتشابهة  
✅ دمج البيانات من ملفات متعددة  
✅ تعديل عدة محلات دفعة واحدة  
✅ حذف عدة محلات بأمان  

جميع العمليات تُحفظ تلقائياً في GitHub مع نظام حماية متقدم!

---

## 📞 الدعم

إذا واجهت أي مشاكل:
1. راجع قسم "حل المشاكل" أعلاه
2. تحقق من صلاحيات GitHub Token
3. تأكد من الاتصال بالإنترنت
4. جرب إعادة تحميل الصفحة

**تاريخ التحديث:** 2025-10-19  
**الإصدار:** 2.0.0
