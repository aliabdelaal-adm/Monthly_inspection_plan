# دليل رفع الملفات - File Upload Guide

## نظرة عامة - Overview

تم تفعيل ميزة رفع الملفات الفعلي إلى GitHub لجميع الأقسام التالية:
File upload functionality has been activated for all the following sections:

### 1. 📅 جدول المناوبات - Shifts Schedule
- **الموقع**: في صفحة إدارة خدمات النظام > جدول المناوبات
- **أنواع الملفات المدعومة**: JSON, Excel (.xlsx, .xls), PDF, CSV, TXT, DOC
- **المجلد المستهدف**: `/files/schedules/`
- **الوصف**: رفع جداول المناوبات والجداول الزمنية

### 2. 🏖️ تتبع الإجازات - Vacation Tracking
- **الموقع**: في صفحة إدارة خدمات النظام > تتبع الإجازات
- **أنواع الملفات المدعومة**: JSON, Excel (.xlsx, .xls), PDF, CSV, TXT, DOC
- **المجلد المستهدف**: `/files/schedules/`
- **الوصف**: رفع ملفات الإجازات وجداول التتبع

### 3. 🏪 قائمة المحلات - Shops List
- **الموقع**: في صفحة إدارة خدمات النظام > قائمة المحلات
- **أنواع الملفات المدعومة**: JSON, Excel (.xlsx, .xls), CSV, PDF, TXT, DOC
- **المجلد المستهدف**: `/files/documents/`
- **الوصف**: رفع قوائم وبيانات المحلات

---

## كيفية الاستخدام - How to Use

### خطوات رفع الملف:

#### 1. تسجيل الدخول كمطور
```
- افتح الصفحة الرئيسية (index.html)
- أدخل كلمة المرور المطورة
- سيتم حفظ الجلسة تلقائياً
```

#### 2. اختيار القسم المناسب
```
- اذهب إلى "إدارة خدمات النظام"
- اختر القسم المناسب (المناوبات، الإجازات، أو المحلات)
- انقر على زر "📁 رفع ملف"
```

#### 3. اختيار الملف
```
- سيظهر مربع حوار لاختيار الملف
- اختر الملف من جهازك
- تأكد من أن حجم الملف أقل من 25 MB
```

#### 4. عملية الرفع
```
✅ سيتم عرض رسالة تحميل أثناء رفع الملف
✅ سيتم رفع الملف إلى GitHub
✅ سيتم تحديث سجل الملفات (files.json) تلقائياً
✅ سيتم معالجة الملف محلياً (إذا كان مدعوماً)
```

#### 5. التحقق من الرفع
```
- افتح قسم "مكتبة الملفات العامة"
- ستجد الملف في القسم المناسب
- يمكن لجميع المستخدمين تحميل الملف ومعاينته
```

---

## المميزات التقنية - Technical Features

### 🔒 الأمان - Security
- ✅ رفع الملفات متاح للمطور فقط
- ✅ يتطلب توكن GitHub صالح
- ✅ التحقق من الصلاحيات قبل كل عملية رفع

### 📊 معالجة الملفات - File Processing
- ✅ **معالجة مزدوجة**: الملف يُرفع إلى GitHub ويُعالج محلياً
- ✅ **دعم متعدد**: دعم لأنواع ملفات متنوعة
- ✅ **تحديث تلقائي**: تحديث سجل الملفات تلقائياً

### 💬 التغذية الراجعة - Feedback
- ✅ رسالة تحميل متحركة أثناء الرفع
- ✅ رسائل نجاح واضحة
- ✅ رسائل خطأ مفصلة

### 📁 التنظيم - Organization
- ✅ تصنيف تلقائي حسب نوع الملف
- ✅ تسجيل البيانات الوصفية (التاريخ، الحجم، المُرفع)
- ✅ إمكانية البحث والفلترة

---

## الحد الأقصى لحجم الملف - File Size Limit

```
⚠️ الحد الأقصى: 25 MB
⚠️ Max Size: 25 MB

السبب: قيود GitHub API
Reason: GitHub API limitations
```

---

## رسائل النجاح والخطأ - Success & Error Messages

### رسالة النجاح:
```
✅ تم رفع ملف [اسم القسم] بنجاح!

الملف: example.xlsx
الآن متاح للجميع في مكتبة الملفات
```

### رسائل الخطأ الشائعة:
```
❌ عذراً، رفع الملفات متاح للمطور فقط
   → الحل: قم بتسجيل الدخول كمطور أولاً

❌ يجب تسجيل الدخول كمطور أولاً
   → الحل: أدخل كلمة مرور المطور

❌ حجم الملف كبير جداً! يجب أن يكون أقل من 25 MB
   → الحل: قم بضغط الملف أو تقسيمه

❌ التوكن غير صالح أو منتهي الصلاحية!
   → الحل: 
   1. اذهب إلى GitHub: Settings → Developer settings → Personal access tokens
   2. أنشئ توكن جديد مع صلاحية "repo"
   3. اذهب إلى لوحة المطور (admin.html)
   4. انقر "تغيير التوكن" وأدخل التوكن الجديد

❌ التوكن ليس لديه صلاحيات كافية!
   → الحل: 
   1. اذهب إلى GitHub: Settings → Developer settings → Personal access tokens
   2. تأكد من أن التوكن لديه صلاحية "repo"
   3. إذا لم تكن موجودة، أنشئ توكن جديد

❌ ملف بنفس الاسم موجود مسبقاً!
   → الحل: 
   1. أعد تسمية الملف
   2. أو احذف الملف القديم من لوحة المطور أولاً

❌ خطأ في الاتصال بالإنترنت!
   → الحل: 
   1. تحقق من اتصال الإنترنت
   2. المحاولة مرة أخرى

❌ خطأ في صلاحيات التوكن. يرجى التحقق من صلاحية التوكن أو تحديثه
   → الحل: تحديث GitHub Personal Access Token في لوحة المطور
   → تأكد من أن التوكن لديه صلاحيات الكتابة على المستودع

⚠️ تم معالجة الملف محلياً، لكن فشل رفعه إلى الموقع
   → الحل: تحقق من اتصال الإنترنت وصلاحية التوكن
   → تأكد من أن التوكن ليس منتهي الصلاحية
```

---

## إنشاء GitHub Personal Access Token - Creating GitHub Token

### الخطوات التفصيلية:

1. **اذهب إلى GitHub Settings**
   - افتح GitHub وسجل الدخول
   - انقر على صورة ملفك الشخصي → Settings

2. **انتقل إلى Developer settings**
   - في القائمة الجانبية، انتقل إلى الأسفل
   - انقر على "Developer settings"

3. **أنشئ توكن جديد**
   - انقر على "Personal access tokens" → "Tokens (classic)"
   - انقر على "Generate new token (classic)"

4. **اختر الصلاحيات**
   - أدخل اسم للتوكن (مثل: "Monthly Inspection Plan Upload")
   - اختر مدة الصلاحية (مثلاً: 90 يوم)
   - ⚠️ **مهم جداً:** اختر صلاحية `repo` (Full control of private repositories)

5. **انسخ التوكن**
   - انقر على "Generate token"
   - انسخ التوكن فوراً (لن تتمكن من رؤيته مرة أخرى!)
   - احتفظ به في مكان آمن

6. **أدخل التوكن في النظام**
   - افتح لوحة المطور (admin.html)
   - انقر على "تغيير التوكن"
   - ألصق التوكن واحفظه

### ملاحظات مهمة:
- التوكن يبدأ بـ `ghp_`
- طول التوكن حوالي 40 حرف
- احتفظ بالتوكن في مكان آمن
- لا تشارك التوكن مع أحد
- إذا انتهت صلاحية التوكن، أنشئ توكن جديد

---

## هيكل المجلدات - Folder Structure

```
files/
├── documents/        → قوائم المحلات والوثائق
├── reports/          → التقارير والإحصائيات
├── schedules/        → جداول المناوبات والإجازات
└── resources/        → الموارد والمراجع
```

---

## ملف السجل - Registry File

### files.json
يتم تحديث هذا الملف تلقائياً عند رفع أي ملف جديد:

```json
{
  "files": [
    {
      "id": "1234567890",
      "name": "جدول_المناوبات_يناير.xlsx",
      "path": "files/schedules/جدول_المناوبات_يناير.xlsx",
      "category": "schedules",
      "type": "xlsx",
      "size": 245678,
      "uploadDate": "2025-01-15T10:30:00.000Z",
      "description": "جدول المناوبات - يناير 2025",
      "uploader": "د. علي عبدالعال",
      "visible": true
    }
  ],
  "lastUpdate": "2025-01-15T10:30:00.000Z"
}
```

---

## API المستخدمة - Used API

### GitHub Contents API
```javascript
PUT /repos/{owner}/{repo}/contents/{path}

Headers:
  Authorization: Bearer {GITHUB_TOKEN}
  Content-Type: application/json

Body:
  {
    "message": "رفع ملف جديد: filename",
    "content": "{base64_encoded_file}"
  }
```

---

## الأسئلة الشائعة - FAQ

### Q1: هل يمكن لأي مستخدم رفع الملفات؟
**A:** لا، رفع الملفات متاح للمطور فقط. المستخدمون العاديون يمكنهم فقط تحميل ومعاينة الملفات.

### Q2: ماذا يحدث للملف بعد رفعه؟
**A:** 
1. يتم رفعه إلى GitHub
2. يتم إضافته إلى files.json
3. يتم معالجته محلياً (إذا كان JSON, Excel, إلخ)
4. يصبح متاحاً في مكتبة الملفات العامة

### Q3: هل يمكن استبدال ملف موجود؟
**A:** حالياً، إذا كان اسم الملف موجود، سيفشل الرفع. يجب إعادة تسمية الملف أو حذف الملف القديم أولاً.

### Q4: كيف أحذف ملف تم رفعه؟
**A:** يمكن الحذف من لوحة الإدارة (admin.html) أو مباشرة من GitHub.

### Q5: هل المعالجة المحلية تؤثر على الرفع؟
**A:** لا، العمليتان مستقلتان. حتى لو فشلت المعالجة المحلية، سيتم رفع الملف إلى GitHub.

---

## الدعم والصيانة - Support & Maintenance

للمشاكل أو الأسئلة:
- **المطور**: د. علي عبدالعال
- **GitHub**: aliabdelaal-adm
- **Repository**: Monthly_inspection_plan

---

## التحديثات المستقبلية - Future Updates

### مخطط لها:
- [ ] إمكانية استبدال الملفات
- [ ] ضغط الملفات تلقائياً
- [ ] معاينة الملفات قبل الرفع
- [ ] دعم السحب والإفلات (Drag & Drop)
- [ ] سجل تاريخ الرفع
- [ ] إمكانية حذف الملفات من الواجهة

---

## الإصدار - Version
- **الإصدار الحالي**: 1.0.0
- **تاريخ الإصدار**: 2025-01-15
- **آخر تحديث**: 2025-01-15

---

## الترخيص - License
هذا المشروع مخصص للاستخدام الداخلي فقط.
This project is for internal use only.
