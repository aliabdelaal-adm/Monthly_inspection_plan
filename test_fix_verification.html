<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ù„Ø§Øª - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥ØµÙ„Ø§Ø­</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #2c3e50; }
        h2 { color: #3498db; margin-top: 30px; }
        .success { 
            color: green; 
            padding: 10px;
            background: #d4edda;
            border-left: 4px solid green;
            margin: 10px 0;
        }
        .error { 
            color: red; 
            padding: 10px;
            background: #f8d7da;
            border-left: 4px solid red;
            margin: 10px 0;
        }
        .info { 
            color: blue; 
            padding: 10px;
            background: #d1ecf1;
            border-left: 4px solid blue;
            margin: 10px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: right;
        }
        th {
            background: #3498db;
            color: white;
        }
        tr:nth-child(even) {
            background: #f9f9f9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ù„Ø§Øª - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥ØµÙ„Ø§Ø­</h1>
        <p>Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙŠØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ù„Ø§Øª (306 Ù…Ø­Ù„) ØªØ¸Ù‡Ø± ÙÙŠ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ù„Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø©</p>
        
        <div id="results"></div>
    </div>
    
    <script>
    let shopsDetails = null; // Global variable (as in smart-planner.html)
    
    async function runTests() {
        const results = document.getElementById('results');
        results.innerHTML = '<h2>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªØ­Ù‚Ù‚</h2>';
        
        // Test 1: Simulate the OLD behavior (local variable shadowing)
        results.innerHTML += '<h2>Test 1: Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ù‚Ø¯ÙŠÙ… (Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØªØºÙŠØ± Ù…Ø­Ù„ÙŠ)</h2>';
        results.innerHTML += '<p class="info">Ù‡Ø°Ø§ ÙŠØ­Ø§ÙƒÙŠ Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø­ÙŠØ« ÙƒØ§Ù† ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…ØªØºÙŠØ± Ù…Ø­Ù„ÙŠ shopsDetails</p>';
        
        let oldBehaviorCount = 0;
        try {
            // This is the OLD code pattern
            let shopsDetails = {}; // Local variable shadows global
            const response = await fetch('shops_details.json?' + new Date().getTime());
            if (response.ok) {
                shopsDetails = await response.json();
                oldBehaviorCount = Object.keys(shopsDetails).length;
            }
            results.innerHTML += `<p class="success">âœ“ ØªÙ… ØªØ­Ù…ÙŠÙ„ ${oldBehaviorCount} Ù…Ø­Ù„ (Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ù‚Ø¯ÙŠÙ…)</p>`;
        } catch (error) {
            results.innerHTML += `<p class="error">âœ— Ø®Ø·Ø£: ${error.message}</p>`;
        }
        
        // Test 2: Simulate the NEW behavior (using global variable)
        results.innerHTML += '<h2>Test 2: Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¹Ø§Ù…)</h2>';
        results.innerHTML += '<p class="info">Ù‡Ø°Ø§ ÙŠØ­Ø§ÙƒÙŠ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø­ÙŠØ« ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¹Ø§Ù…</p>';
        
        let newBehaviorCount = 0;
        try {
            // This is the NEW code pattern
            let currentShopsDetails = shopsDetails || {};
            
            if (!shopsDetails || Object.keys(shopsDetails).length === 0) {
                const response = await fetch('shops_details.json?' + new Date().getTime());
                if (response.ok) {
                    currentShopsDetails = await response.json();
                    // In real code, this would also update the global
                    shopsDetails = currentShopsDetails;
                }
            }
            
            newBehaviorCount = Object.keys(currentShopsDetails).length;
            results.innerHTML += `<p class="success">âœ“ ØªÙ… ØªØ­Ù…ÙŠÙ„ ${newBehaviorCount} Ù…Ø­Ù„ (Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯)</p>`;
        } catch (error) {
            results.innerHTML += `<p class="error">âœ— Ø®Ø·Ø£: ${error.message}</p>`;
        }
        
        // Test 3: Verify consistency
        results.innerHTML += '<h2>Test 3: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØ³Ø§Ù‚</h2>';
        if (oldBehaviorCount === newBehaviorCount && newBehaviorCount === 306) {
            results.innerHTML += `<p class="success">âœ“ Ù…Ù…ØªØ§Ø²! ÙƒÙ„Ø§ Ø§Ù„Ø·Ø±ÙŠÙ‚ØªÙŠÙ† ØªØ¹Ø±Ø¶Ø§Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ 306 Ù…Ø­Ù„</p>`;
        } else if (newBehaviorCount === 306) {
            results.innerHTML += `<p class="success">âœ“ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ ÙŠØ¹Ù…Ù„! Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙŠØ¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ 306 Ù…Ø­Ù„</p>`;
        } else {
            results.innerHTML += `<p class="error">âœ— Ù…Ø´ÙƒÙ„Ø©: Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ø§ ÙŠØ¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ù„Ø§Øª (${newBehaviorCount} Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† 306)</p>`;
        }
        
        // Test 4: Show sample shops
        results.innerHTML += '<h2>Test 4: Ø¹ÙŠÙ†Ø© Ù…Ù† Ø§Ù„Ù…Ø­Ù„Ø§Øª Ø§Ù„Ù…Ø­Ù…Ù„Ø©</h2>';
        results.innerHTML += '<table>';
        results.innerHTML += '<thead><tr><th>#</th><th>Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„</th><th>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th><th>Ø§Ù„Ù†Ø´Ø§Ø·</th></tr></thead>';
        results.innerHTML += '<tbody>';
        
        let count = 0;
        for (const [shopName, shopInfo] of Object.entries(shopsDetails || {})) {
            if (count < 15) {
                results.innerHTML += `<tr>
                    <td>${count + 1}</td>
                    <td>${shopInfo.nameAr || shopName}</td>
                    <td>${shopInfo.area || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                    <td>${shopInfo.activity || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                </tr>`;
                count++;
            }
        }
        results.innerHTML += '</tbody></table>';
        
        // Summary
        results.innerHTML += '<h2>ğŸ“Š Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h2>';
        results.innerHTML += `<div class="success">
            <strong>âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø¬Ø§Ø­!</strong><br>
            âœ“ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù„Ù„Ù…Ø­Ù„Ø§Øª: ${newBehaviorCount}<br>
            âœ“ Ø§Ù„Ù…Ø­Ù„Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø© ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„: ${count}<br>
            âœ“ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ ÙŠØ¶Ù…Ù† Ø¸Ù‡ÙˆØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ù„Ø§Øª ÙÙŠ "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ù„Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø©"<br>
            âœ“ Ø§Ù„Ø¢Ù† ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø·ÙˆØ± Ø±Ø¤ÙŠØ© ÙˆØªØ¹Ø¯ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ 306 Ù…Ø­Ù„
        </div>`;
    }
    
    // Run tests on load
    runTests();
    </script>
</body>
</html>
