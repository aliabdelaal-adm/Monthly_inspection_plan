<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اختبار إصلاح الصوت - Audio Fix Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 20px;
            direction: rtl;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            max-width: 700px;
            text-align: center;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
            text-align: right;
        }
        
        .success-box {
            background: #e8f5e9;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 20px 0;
            text-align: right;
        }
        
        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 20px 0;
            text-align: right;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: scale(1.05);
        }
        
        button:active {
            transform: scale(0.95);
        }
        
        .log {
            background: #f5f5f5;
            border: 1px solid #ddd;
            padding: 15px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
            text-align: right;
            font-family: monospace;
            font-size: 12px;
        }
        
        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        
        .maintenance-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }
        
        .maintenance-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
        }
        
        .maintenance-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }
        
        .close-btn {
            background: #f44336;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎵 اختبار إصلاح الصوت</h1>
        <p class="subtitle">Audio Fix Test - Maintenance Mode Music</p>
        
        <div class="info-box">
            <strong>📋 التغييرات المطبقة:</strong><br>
            ✅ إزالة <code>autoplay muted</code> من عنصر الصوت<br>
            ✅ الصوت يبدأ فقط عند عرض رسالة الصيانة<br>
            ✅ مستوى الصوت: 15% (هادئ جداً)<br>
            ✅ مدة الصوت: 20 دقيقة مع تنويعات ديناميكية
        </div>
        
        <div class="success-box">
            <strong>✨ النتيجة المتوقعة:</strong><br>
            عند الضغط على زر الاختبار، يجب أن:<br>
            1️⃣ تظهر رسالة الصيانة<br>
            2️⃣ يبدأ الصوت تلقائياً (بصوت هادئ جداً)<br>
            3️⃣ إذا منع المتصفح التشغيل التلقائي، يبدأ الصوت عند أول نقرة
        </div>
        
        <button onclick="testMaintenanceMode()">🧪 اختبار رسالة الصيانة مع الصوت</button>
        <button onclick="checkAudioState()">🔍 فحص حالة الصوت</button>
        <button onclick="clearLog()">🗑️ مسح السجل</button>
        
        <div class="log" id="log"></div>
    </div>
    
    <!-- Maintenance Overlay -->
    <div class="maintenance-overlay" id="maintenanceOverlay">
        <div class="maintenance-content">
            <div class="maintenance-icon">🔧</div>
            <h2>جاري التحديث...</h2>
            <p>يتم تحديث النظام الآن. يرجى الانتظار.</p>
            <p style="color: #666; font-size: 14px; margin-top: 20px;">
                🎵 يتم تشغيل الموسيقى تلقائياً في الخلفية (صوت هادئ جداً - 15%)
            </p>
            <button class="close-btn" onclick="hideMaintenanceMode()">إغلاق الاختبار</button>
        </div>
    </div>
    
    <!-- Audio Element (same as in index.html after fix) -->
    <audio id="maintenanceAudio" loop preload="auto" style="display:none;">
        <source src="music.mp3" type="audio/mpeg">
        متصفحك لا يدعم تشغيل الملفات الصوتية.
    </audio>
    
    <script>
        let logEntries = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = `[${timestamp}] ${message}`;
            logEntries.push(entry);
            
            const logDiv = document.getElementById('log');
            const entryDiv = document.createElement('div');
            entryDiv.className = 'log-entry';
            entryDiv.textContent = entry;
            logDiv.appendChild(entryDiv);
            logDiv.scrollTop = logDiv.scrollHeight;
            
            console.log(entry);
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
            logEntries = [];
            log('🗑️ Log cleared');
        }
        
        function testMaintenanceMode() {
            log('🔧 Starting maintenance mode test...');
            const overlay = document.getElementById('maintenanceOverlay');
            const audio = document.getElementById('maintenanceAudio');
            
            if (!overlay) {
                log('❌ Overlay element not found!');
                return;
            }
            
            if (!audio) {
                log('❌ Audio element not found!');
                return;
            }
            
            // Show overlay
            overlay.style.display = 'flex';
            log('✅ Maintenance overlay displayed');
            
            // Reset audio to start from beginning
            audio.currentTime = 0;
            log('🔄 Audio reset to beginning');
            
            // Set volume to very quiet level (15%)
            audio.volume = 0.15;
            audio.muted = false;
            log('🔊 Volume set to 15% (very quiet)');
            
            // Ensure audio plays with enhanced error handling
            audio.play().then(() => {
                log('✅ Audio playing successfully!');
                log('🎵 Volume: ' + audio.volume);
                log('🎵 Duration: ' + Math.floor(audio.duration / 60) + ' minutes');
            }).catch(err => {
                log('⚠️ Audio autoplay prevented by browser: ' + err.message);
                log('🔄 Trying alternative method...');
                
                // Alternative: Start muted, then unmute after a tiny delay
                audio.muted = true;
                audio.volume = 0.15;
                audio.play().then(() => {
                    log('✅ Audio started (muted)');
                    // Successfully started muted, now unmute
                    setTimeout(() => {
                        audio.muted = false;
                        log('✅ Audio unmuted! Playing at 15% volume');
                    }, 100);
                }).catch(e => {
                    log('❌ Audio play failed even when muted: ' + e.message);
                    
                    // Check if audio file exists
                    fetch('music.mp3', { method: 'HEAD' })
                        .then(response => {
                            if (!response.ok) {
                                log('❌ Audio file not found or inaccessible');
                            } else {
                                log('✅ Audio file exists and is accessible');
                            }
                        })
                        .catch(fetchErr => log('❌ Error checking audio file: ' + fetchErr.message));
                    
                    // Last resort: play on first user interaction
                    log('📌 Click anywhere to start audio playback');
                    const playOnInteraction = () => {
                        audio.muted = false;
                        audio.volume = 0.15;
                        audio.currentTime = 0;
                        audio.play()
                            .then(() => log('✅ Audio started on user interaction'))
                            .catch(err2 => log('❌ Audio play failed on interaction: ' + err2.message));
                        document.removeEventListener('click', playOnInteraction);
                        document.removeEventListener('touchstart', playOnInteraction);
                    };
                    document.addEventListener('click', playOnInteraction, { once: true });
                    document.addEventListener('touchstart', playOnInteraction, { once: true });
                });
            });
        }
        
        function hideMaintenanceMode() {
            log('🔧 Hiding maintenance mode...');
            const overlay = document.getElementById('maintenanceOverlay');
            const audio = document.getElementById('maintenanceAudio');
            
            if (overlay) {
                overlay.style.display = 'none';
                log('✅ Maintenance overlay hidden');
            }
            
            // Stop and reset audio
            if (audio) {
                audio.pause();
                audio.currentTime = 0;
                log('⏸️ Audio stopped and reset');
            }
        }
        
        function checkAudioState() {
            log('🔍 Checking audio state...');
            const audio = document.getElementById('maintenanceAudio');
            
            if (!audio) {
                log('❌ Audio element not found!');
                return;
            }
            
            log('--- Audio State ---');
            log('📊 Muted: ' + audio.muted);
            log('📊 Volume: ' + audio.volume);
            log('📊 Current Time: ' + audio.currentTime.toFixed(2) + 's');
            log('📊 Duration: ' + (audio.duration ? (audio.duration / 60).toFixed(2) + ' minutes' : 'Unknown'));
            log('📊 Paused: ' + audio.paused);
            log('📊 ReadyState: ' + audio.readyState);
            log('📊 NetworkState: ' + audio.networkState);
            log('📊 Loop: ' + audio.loop);
            log('--- End State ---');
        }
        
        // Auto-log on page load
        window.addEventListener('load', () => {
            log('✅ Page loaded successfully');
            log('ℹ️ Audio element ready for testing');
            checkAudioState();
        });
    </script>
</body>
</html>
