# دليل سريع: مدقق الأخطاء الدوري

## 🎯 الهدف

تفعيل خاصية الفحص الدوري للأخطاء لتتم الجدولة للصيانة والفحص يومياً من الساعة 1 صباحاً وحتى انتهاء الفحص.

---

## ⚡ التثبيت السريع

### الخطوة 1: تشغيل سكريبت الإعداد

```bash
cd /path/to/Monthly_inspection_plan
chmod +x setup_periodic_checker.sh
./setup_periodic_checker.sh
```

### الخطوة 2: اختر طريقة الجدولة

عند سؤالك، اختر أحد الخيارات:

```
1. Cron (موصى به) ← أسهل طريقة لأنظمة Linux/Mac
2. Systemd Timer ← للمستخدمين المتقدمين
3. يدوي ← للتشغيل اليدوي فقط
```

**اختر الخيار 1 (Cron) للأغلبية**

---

## ✅ التحقق من التشغيل

### التحقق من الجدولة

```bash
# عرض الجدولة الحالية
crontab -l

# يجب أن ترى سطراً مشابهاً لهذا:
# 0 1 * * * cd /path/to/Monthly_inspection_plan && /usr/bin/python3 periodic_error_checker.py
```

### تشغيل فحص تجريبي

```bash
python3 periodic_error_checker.py
```

---

## 📋 ماذا يفعل النظام؟

### الفحوصات التلقائية:

1. **فحص تكرارات المحلات**
   - يتحقق من عدم تعيين نفس المحل لعدة مفتشين في نفس اليوم
   - يطبق على التواريخ من 7 أكتوبر 2024 فصاعداً

2. **فحص اكتمال البيانات**
   - يتحقق من وجود جميع الحقول المطلوبة (التاريخ، المفتش، المحلات)
   - يكشف السجلات الناقصة

### السجلات:

- يتم حفظ سجل جديد كل يوم في: `logs/error_checker/`
- اسم الملف: `error_check_YYYYMMDD.log`
- مثال: `error_check_20250127.log`

---

## 🕐 متى يعمل النظام؟

- **تلقائياً**: كل يوم في الساعة **1:00 صباحاً**
- **المدة**: يستمر حتى إتمام جميع الفحوصات (عادة أقل من دقيقة)
- **السجلات**: تُحفظ تلقائياً في مجلد logs/error_checker/

---

## 📊 قراءة النتائج

### عرض آخر سجل

```bash
# الانتقال إلى مجلد السجلات
cd logs/error_checker

# عرض أحدث ملف
ls -lt | head -5

# عرض سجل اليوم
cat error_check_$(date +%Y%m%d).log
```

### البحث عن الأخطاء

```bash
# البحث عن جميع الأخطاء
grep "❌" logs/error_checker/*.log

# البحث عن التكرارات
grep "تكرار" logs/error_checker/*.log

# عرض عدد الأخطاء في كل يوم
grep -c "❌" logs/error_checker/*.log
```

---

## 🔧 التعديلات الشائعة

### تغيير وقت التشغيل

إذا أردت تغيير الوقت من 1:00 صباحاً إلى وقت آخر:

```bash
# فتح محرر cron
crontab -e

# ابحث عن السطر:
# 0 1 * * * cd ...

# غيّر "0 1" إلى الوقت المطلوب:
# 0 2  = 2:00 صباحاً
# 0 3  = 3:00 صباحاً
# 30 1 = 1:30 صباحاً
# 0 0  = منتصف الليل
```

### إيقاف الجدولة مؤقتاً

```bash
# فتح محرر cron
crontab -e

# ضع علامة # في بداية السطر:
# #0 1 * * * cd /path/to/Monthly_inspection_plan && python3 periodic_error_checker.py

# احفظ وأغلق
```

### حذف الجدولة نهائياً

```bash
# فتح محرر cron
crontab -e

# احذف السطر الكامل الذي يحتوي على periodic_error_checker.py

# احفظ وأغلق
```

---

## 🚨 حل المشاكل الشائعة

### المشكلة: الفحص لا يعمل تلقائياً

**الحل 1: تحقق من الجدولة**
```bash
crontab -l
# يجب أن ترى السطر الخاص بـ periodic_error_checker.py
```

**الحل 2: تحقق من السجلات**
```bash
cat logs/error_checker/cron.log
# ابحث عن رسائل الأخطاء
```

**الحل 3: تحقق من الصلاحيات**
```bash
ls -la periodic_error_checker.py
# يجب أن تحتوي على 'x' للتنفيذ
# إذا لم تكن موجودة، نفذ:
chmod +x periodic_error_checker.py
```

### المشكلة: لا أجد مجلد السجلات

**الحل:**
```bash
# إنشاء المجلد يدوياً
mkdir -p logs/error_checker

# تشغيل الفحص مرة واحدة
python3 periodic_error_checker.py
```

### المشكلة: أخطاء في تحميل البيانات

**الحل:**
```bash
# تحقق من وجود الملف
ls -la plan-data.json

# تحقق من صحة JSON
python3 -m json.tool plan-data.json > /dev/null
```

---

## 📖 مثال على السجل

عند وجود أخطاء:

```
================================================================================
🔍 بدء الفحص الدوري للأخطاء / Starting Periodic Error Check
⏰ التاريخ والوقت: 2025-01-27 01:00:00
================================================================================
✅ تم تحميل plan-data.json بنجاح
📊 عدد السجلات: 85

🔍 الفحص 1: اكتمال البيانات
--------------------------------------------------------------------------------
✅ جميع البيانات كاملة

🔍 الفحص 2: تكرار المحلات
--------------------------------------------------------------------------------
❌ وجدت 15 حالات تكرار

📋 تفاصيل التكرارات:

1. 📅 التاريخ: 2025-09-26
   🏪 المحل: محل بيت الطيور
   👥 المفتشين (2):
      - د. آمنه بن صرم
      - د. علي عبدالعال
...

================================================================================
⚠️  تحذير: وجدت أخطاء تحتاج إلى تصحيح
📧 يرجى مراجعة السجلات ومعالجة الأخطاء
================================================================================
```

عند عدم وجود أخطاء:

```
================================================================================
🔍 بدء الفحص الدوري للأخطاء
⏰ التاريخ والوقت: 2025-01-27 01:00:00
================================================================================
✅ تم تحميل plan-data.json بنجاح
📊 عدد السجلات: 85

🔍 الفحص 1: اكتمال البيانات
--------------------------------------------------------------------------------
✅ جميع البيانات كاملة

🔍 الفحص 2: تكرار المحلات
--------------------------------------------------------------------------------
✅ لا يوجد تكرارات في المحلات

================================================================================
🎉 ممتاز! جميع الفحوصات نجحت
✅ البيانات صحيحة وجاهزة للاستخدام
================================================================================
```

---

## 📞 الدعم

للمزيد من المساعدة:

1. راجع الدليل الشامل: `PERIODIC_ERROR_CHECKER_README.md`
2. تحقق من السجلات في: `logs/error_checker/`
3. شغّل الفحص يدوياً: `python3 periodic_error_checker.py`

---

## ✅ الملخص

✨ **تم تفعيل خاصية الفحص الدوري للأخطاء!**

- ⏰ يعمل تلقائياً كل يوم في الساعة 1:00 صباحاً
- 🔍 يفحص تكرارات المحلات واكتمال البيانات
- 📊 يُنشئ سجلات مفصلة يومياً
- 🚀 جاهز للاستخدام الآن!

**تم الإنشاء:** 2025-01-27  
**الإصدار:** 1.0.0
