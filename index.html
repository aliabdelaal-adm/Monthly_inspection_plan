<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>خطة التفتيش الشهرية</title>
    <!-- منع الكاش بكافة الطرق الممكنة -->
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="expires" content="0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Cairo', Arial, sans-serif;
            background: #f7f9fc;
            min-height: 100vh;
            min-width: 100vw;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .main-container {
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 2px 16px #dadce0;
            padding: 54px 32px 24px 32px;
            max-width: 600px;
            min-width: 320px;
            min-height: 340px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        .bell-corner {
            position: absolute;
            top: 22px;
            right: 32px;
            z-index: 10;
        }
        .bell-circle {
            width: 42px;
            height: 42px;
            background: #234085;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .bell-circle svg {
            width: 23px;
            height: 23px;
            fill: #fff;
        }
        .last-update {
            position: absolute;
            top: 22px;
            left: 32px;
            color: #234085;
            font-size: 1em;
            font-weight: bold;
            background: #f7f9fc;
            padding: 4px 12px;
            border-radius: 8px;
            letter-spacing: 1px;
        }
        .title-row {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 28px;
            margin-top: 24px;
        }
        .blue-title-box {
            background: #234085;
            color: #fff;
            width: 100%;
            padding: 13px 0 13px 0;
            border-radius: 7px;
            font-size: 2em;
            font-weight: bold;
            text-align: center;
        }
        .dropdown-section {
            margin: 26px 0 20px 0;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .dropdown-label {
            font-size: 1.1em;
            white-space: nowrap;
        }
        select {
            padding: 7px 16px;
            font-size: 1em;
            border-radius: 6px;
            border: 1px solid #b6b6b6;
            min-width: 170px;
        }
        .save-btns {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 18px 0 0 0;
            flex-wrap: wrap;
        }
        .save-btns button {
            font-size: 1em;
            padding: 8px 24px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            margin-bottom: 5px;
        }
        .csv-btn { background: #6c757d; color: #fff; }
        .pdf-btn { background: #d63384; color: #fff; }
        .excel-btn { background: #198754; color: #fff; }
        .footer {
            text-align: center;
            margin-top: 22px;
            color: #234085;
            font-size: 1em;
        }
        @media (max-width:600px) {
          .main-container { padding: 16px 2vw 12px 2vw; min-width: 95vw;}
          .blue-title-box { font-size: 1.1em; }
          .bell-corner { right: 10px; top: 9px;}
          .bell-circle { width: 30px; height: 30px;}
          .bell-circle svg { width: 15px; height: 15px;}
          .last-update { left: 8px; top: 9px; font-size: 0.95em; padding: 2px 7px;}
          .save-btns button { padding: 6px 12px; font-size: 0.95em;}
          .dropdown-section { flex-direction: column; gap: 6px; margin-top: 16px;}
        }
    </style>
    <script>
      // إجبار تحديث الصفحة عند كل فتح (منع الكاش)
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(function(registrations) {
          for(let registration of registrations) {
            registration.unregister();
          }
        });
      }
      // إضافة باراميتر عشوائي للرابط دائماً لمنع الكاش
      (function() {
        if (window.location.search.indexOf('v=') === -1) {
          var newUrl = window.location.pathname + '?v=' + Date.now();
          window.history.replaceState({}, '', newUrl);
        }
      })();
    </script>
</head>
<body>
    <div class="main-container">
        <!-- الجرس أعلى يمين -->
        <div class="bell-corner">
            <div class="bell-circle" id="bell" title="تنبيه">
                <svg viewBox="0 0 24 24">
                  <path d="M12 2C10.067 2 8.5 3.567 8.5 5.5V6.086C6.348 7.192 5 9.462 5 12v4.5l-1.707 1.707a1 1 0 0 0 .707 1.707h16a1 1 0 0 0 .707-1.707L19 16.5V12c0-2.538-1.348-4.808-3.5-5.914V5.5C15.5 3.567 13.933 2 12 2zm0 18a2.5 2.5 0 0 0 2.45-2h-4.9A2.5 2.5 0 0 0 12 20z"></path>
                </svg>
            </div>
        </div>
        <!-- تاريخ اخر تحديث أعلى يسار -->
        <div class="last-update" id="last-update"></div>
        <div class="title-row">
            <div class="blue-title-box">
                خطة التفتيش الشهرية
            </div>
        </div>
        <div class="dropdown-section">
            <label for="inspectorSelect" class="dropdown-label">اختر اسم المفتش :</label>
            <select id="inspectorSelect">
                <option value="">-- اختر المفتش --</option>
                <option value="ahmed">أحمد عبد الله</option>
                <option value="sara">سارة علي</option>
                <option value="mohamed">محمد يوسف</option>
            </select>
        </div>
        <div class="save-btns">
            <button class="csv-btn" onclick="exportTableToCSV()">حفظ الخطة على الجهاز (CSV)</button>
            <button class="pdf-btn" onclick="exportTableToPDF()">حفظ كـ PDF</button>
            <button class="excel-btn" onclick="exportTableToExcel()">حفظ كـ Excel</button>
        </div>
        <div class="footer">
            جميع الحقوق محفوظة © المطور د. علي عبدالعال
        </div>
        <!-- صوت الطيور المغردة -->
        <audio id="birds-audio" src="https://cdn.pixabay.com/audio/2022/07/26/audio_124bfa5c1c.mp3"></audio>
    </div>
<script>
    // تصدير CSV
    function exportTableToCSV() {
        alert("يرجى اختيار اسم المفتش أولا! (مثال فقط)");
    }
    function exportTableToPDF() {
        alert("يرجى اختيار اسم المفتش أولا! (مثال فقط)");
    }
    function exportTableToExcel() {
        alert("يرجى اختيار اسم المفتش أولا! (مثال فقط)");
    }

    // تشغيل صوت الطيور عند الضغط على الجرس
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('bell').addEventListener('click', function() {
            var audio = document.getElementById('birds-audio');
            audio.currentTime = 0;
            audio.play().catch(function(){});
        });
    });

    // جلب تاريخ آخر تحديث حقيقي من GitHub API
    async function setLastUpdateDate() {
        // اسم المستودع واسم الملف حسب حالتك
        // هذا المثال لملف index_Version4.html في repo: aliabdelaal-adm/Monthly_inspection_plan
        const repo = "aliabdelaal-adm/Monthly_inspection_plan";
        const filePath = "index_Version4.html";
        const url = `https://api.github.com/repos/${repo}/commits?path=${filePath}&per_page=1`;
        try {
            const response = await fetch(url, {cache: "no-store"});
            const data = await response.json();
            if (data && data[0] && data[0].commit && data[0].commit.committer && data[0].commit.committer.date) {
                const commitDate = new Date(data[0].commit.committer.date);
                const day = String(commitDate.getDate()).padStart(2, '0');
                const month = String(commitDate.getMonth() + 1).padStart(2, '0');
                const year = commitDate.getFullYear();
                document.getElementById('last-update').textContent = "آخر تحديث: " + day + "-" + month + "-" + year;
            } else {
                // احتياطي: تاريخ اليوم الحالي (في حال فشل الجلب)
                const today = new Date();
                const day = String(today.getDate()).padStart(2, '0');
                const month = String(today.getMonth() + 1).padStart(2, '0');
                const year = today.getFullYear();
                document.getElementById('last-update').textContent = "آخر تحديث: " + day + "-" + month + "-" + year;
            }
        } catch (e) {
            // احتياطي: تاريخ اليوم الحالي (في حال فشل الجلب)
            const today = new Date();
            const day = String(today.getDate()).padStart(2, '0');
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const year = today.getFullYear();
            document.getElementById('last-update').textContent = "آخر تحديث: " + day + "-" + month + "-" + year;
        }
    }

    // نفذ عند فتح الصفحة
    window.addEventListener('DOMContentLoaded', function() {
        setLastUpdateDate();
    });
</script>
</body>
</html>
