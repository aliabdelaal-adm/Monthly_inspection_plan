# دليل استخدام نظام إدارة المحلات والمناطق الذكي

## 🎯 نظرة عامة

تم تطوير نظام ذكي متكامل لإدارة المحلات والمناطق في أداة التخطيط الشهري للتفتيش. يتيح هذا النظام للمطور:

### ✨ الميزات الرئيسية

#### 1️⃣ إدارة شاملة للمحلات
- ➕ **إضافة محلات جديدة** مع كافة التفاصيل
- ✏️ **تعديل بيانات المحلات** الموجودة
- 🗑️ **حذف المحلات** من النظام
- 👁️ **عرض تفاصيل كاملة** لكل محل
- 💾 **حفظ تلقائي** في GitHub

#### 2️⃣ ربط ذكي بين المحلات والمناطق
- 🔗 **ربط تلقائي** للمحلات بالمناطق التابعة لها
- 📍 **عرض فوري** لجميع المحلات عند اختيار منطقة
- 🔄 **تحديث ديناميكي** للبيانات
- 📊 **إحصائيات تفصيلية** لكل منطقة

---

## 📋 كيفية استخدام النظام

### الخطوة 1: الوصول إلى لوحة التحكم

1. افتح ملف `admin-dashboard.html` في المتصفح
2. أدخل GitHub Token الخاص بك (يطلب عند أول استخدام)
3. ستظهر لوحة التحكم الرئيسية

### الخطوة 2: إدارة المحلات

#### ➕ إضافة محل جديد

1. من القائمة الجانبية، اضغط على "إدارة المحلات" 🏪
2. اضغط على زر "إضافة محل جديد" الأخضر
3. ستظهر نافذة منبثقة تحتوي على نموذج

**البيانات المطلوبة:**

```
📝 اسم المحل (عربي)*          مثال: محل الطيور الأليفة
📝 اسم المحل (إنجليزي)         مثال: Pet Birds Shop
📍 المنطقة*                     مثال: سوق الميناء
🆔 رقم الرخصة                  مثال: CN-1234567
📞 رقم الهاتف                   مثال: 0501234567
💼 النشاط                       مثال: بيع الحيوانات
🔢 كود ADM                      مثال: ADM0001
🗺️ رابط الموقع                 مثال: https://maps.google.com/...

* حقول إلزامية
```

4. بعد ملء البيانات، اضغط "حفظ المحل"
5. ستظهر رسالة تأكيد: ✅ "تم إضافة المحل بنجاح!"
6. اضغط زر "حفظ في GitHub" 💾 لحفظ التغييرات بشكل دائم

#### ✏️ تعديل محل موجود

1. في قائمة المحلات، ابحث عن المحل المطلوب
2. اضغط على زر "تعديل" ⚠️ بجوار المحل
3. ستظهر نافذة التعديل مع البيانات الحالية
4. عدّل البيانات المطلوبة
5. اضغط "حفظ التعديلات"
6. ستظهر رسالة تأكيد: ✅ "تم تحديث بيانات المحل بنجاح!"
7. اضغط "حفظ في GitHub" لحفظ التغييرات

#### 👁️ عرض تفاصيل محل

1. في قائمة المحلات، اضغط على زر "عرض" ℹ️ بجوار المحل
2. ستظهر نافذة منبثقة تعرض:
   - 🏪 الاسم بالعربي والإنجليزي
   - 📍 المنطقة
   - 🆔 رقم الرخصة
   - 📞 رقم الهاتف
   - 💼 النشاط
   - 🔢 كود ADM
   - 🗺️ رابط الموقع (يمكن فتحه مباشرة)

#### 🗑️ حذف محل

1. في قائمة المحلات، اضغط على زر "حذف" 🔴 بجوار المحل
2. ستظهر رسالة تأكيد: ⚠️ "هل أنت متأكد من حذف المحل؟"
3. اضغط "OK" للتأكيد
4. سيتم حذف المحل من:
   - قاعدة بيانات المحلات (shops_details.json)
   - جميع سجلات التفتيش (plan-data.json)
5. اضغط "حفظ في GitHub" لحفظ التغييرات

### الخطوة 3: إدارة المناطق والربط مع المحلات

#### 🔗 عرض المحلات حسب المنطقة

1. من القائمة الجانبية، اضغط على "إدارة المناطق" 🗺️
2. انتقل إلى قسم "ربط المناطق بالمحلات"
3. اختر منطقة من القائمة المنسدلة

**سيتم عرض تلقائياً:**
```
📊 إحصائيات المنطقة:
   - عدد المحلات في المنطقة
   - اسم المنطقة

🏪 قائمة المحلات:
   - اسم المحل
   - 🆔 رقم الرخصة
   - 📞 رقم الهاتف
   - 💼 النشاط
   - 🗺️ رابط الموقع
   - أزرار تعديل وعرض التفاصيل
```

---

## 🔄 آلية عمل النظام

### 1. مصادر البيانات

#### shops_details.json 📁
```json
{
  "اسم المحل": {
    "nameAr": "اسم المحل بالعربي",
    "nameEn": "Shop Name in English",
    "licenseNo": "CN-1234567",
    "address": "المنطقة",
    "contact": "0501234567",
    "activity": "النشاط",
    "admCode": "ADM0001",
    "locationMap": "https://maps.google.com/..."
  }
}
```

#### plan-data.json 📁
```json
{
  "inspectionData": [
    {
      "inspector": "د. اسم المفتش",
      "day": "2025-10-19",
      "area": "المنطقة",
      "shops": ["محل 1", "محل 2"]
    }
  ]
}
```

### 2. التكامل بين الملفات

```
┌─────────────────────┐
│  shops_details.json │ ← قاعدة البيانات الرئيسية
└──────────┬──────────┘
           │
           ↓
     ┌─────────┐
     │ المنطقة │ ← حقل address
     └────┬────┘
          │
          ↓
┌─────────────────────┐
│   plan-data.json    │ ← سجلات التفتيش
└─────────────────────┘
```

### 3. عملية الحفظ

```
تعديل بيانات المحل
        ↓
تحديث shops_details.json محلياً
        ↓
تحديث plan-data.json إذا لزم (تغيير الاسم)
        ↓
ضغط زر "حفظ في GitHub"
        ↓
رفع shops_details.json إلى GitHub
        ↓
رفع plan-data.json إلى GitHub
        ↓
✅ تم الحفظ بنجاح!
```

---

## 💡 نصائح وإرشادات

### ✅ أفضل الممارسات

1. **دائماً اضغط "حفظ في GitHub"** بعد أي تعديل
2. **تأكد من صحة رقم الرخصة** قبل الحفظ
3. **استخدم أسماء واضحة** للمحلات
4. **حدد المنطقة بدقة** لتسهيل البحث

### ⚠️ تحذيرات هامة

1. **لا تحذف محلات** إلا بعد التأكد التام
2. **حذف محل يحذفه من جميع السجلات** - لا يمكن التراجع!
3. **تأكد من اتصال الإنترنت** قبل الحفظ في GitHub
4. **احتفظ بنسخة احتياطية** من البيانات بشكل دوري

---

## 🎨 واجهة المستخدم

### قائمة المحلات

```
┌────────────────────────────────────────────────────────┐
│  إدارة المحلات                                         │
│                                                        │
│  [➕ إضافة محل جديد]  [💾 حفظ في GitHub]  [🔄 تحديث]  │
│                                                        │
│  🔍 البحث: [_____________]                            │
│                                                        │
│  ┌──────────────────────────────────────────────────┐ │
│  │ المحل      │ المنطقة │ الرخصة │ الهاتف │ الإجراءات││
│  ├──────────────────────────────────────────────────┤ │
│  │ محل 1      │ الميناء  │ CN-123  │ 050xxx │ 👁️✏️🗑️  ││
│  │ محل 2      │ الحصن    │ CN-456  │ 055xxx │ 👁️✏️🗑️  ││
│  └──────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────┘
```

### ربط المناطق بالمحلات

```
┌────────────────────────────────────────────────────────┐
│  ربط المناطق بالمحلات                                  │
│                                                        │
│  اختر منطقة: [▼ سوق الميناء ____________]            │
│                                                        │
│  ┌──────────────────────────────────────────────────┐ │
│  │  📊 المحلات في منطقة: سوق الميناء                 │ │
│  │  عدد المحلات: 15                                  │ │
│  └──────────────────────────────────────────────────┘ │
│                                                        │
│  ┌────────┐  ┌────────┐  ┌────────┐                  │
│  │ محل 1  │  │ محل 2  │  │ محل 3  │                  │
│  │ CN-123 │  │ CN-456 │  │ CN-789 │                  │
│  │ 050xxx │  │ 055xxx │  │ 052xxx │                  │
│  │ [✏️][👁️]│  │ [✏️][👁️]│  │ [✏️][👁️]│                  │
│  └────────┘  └────────┘  └────────┘                  │
└────────────────────────────────────────────────────────┘
```

---

## 🐛 حل المشاكل

### مشكلة: لا تظهر المحلات

**الحل:**
1. تأكد من تسجيل الدخول بـ GitHub Token
2. اضغط على زر "تحديث القائمة"
3. تأكد من وجود ملف shops_details.json

### مشكلة: فشل الحفظ في GitHub

**الحل:**
1. تحقق من صحة GitHub Token
2. تأكد من الصلاحيات (write access)
3. تحقق من اتصال الإنترنت
4. حاول مرة أخرى

### مشكلة: لا تظهر المحلات عند اختيار المنطقة

**الحل:**
1. تأكد من أن حقل "المنطقة" في بيانات المحل مطابق لاسم المنطقة
2. اضغط على زر "تحديث القائمة"
3. تحقق من أن shops_details.json محدّث

---

## 📞 الدعم والمساعدة

إذا واجهت أي مشكلة:
1. راجع سجل النشاط (Activity Log) في لوحة التحكم
2. تحقق من رسائل الأخطاء في Console المتصفح (F12)
3. تواصل مع المطور

---

## 🔐 الأمان والصلاحيات

- ✅ يجب توفر GitHub Token صالح
- ✅ يجب توفر صلاحيات الكتابة على المستودع
- ✅ جميع التعديلات تُسجل في سجل النشاط
- ✅ يتم تشفير النصوص العربية بشكل صحيح (UTF-8)

---

## 📝 ملاحظات تقنية

- النظام يعمل بشكل متزامن (Async/Await)
- يتم التحقق من صحة البيانات قبل الحفظ
- دعم كامل للنصوص العربية
- واجهة متجاوبة (Responsive) مع جميع الأجهزة
- تحديثات فورية للواجهة بعد كل عملية

---

تم تطوير هذا النظام لتسهيل إدارة المحلات والمناطق بشكل ذكي وفعال! 🚀
