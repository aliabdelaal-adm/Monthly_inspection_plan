# دليل حفظ إشعارات الجرس
# Bell Notifications File Save Guide

## نظرة عامة (Overview)

تم تحديث نظام حفظ إشعارات الجرس ليتيح للمستخدم اختيار موقع محدد على جهازه لحفظ ملف `plan-data.json` بدلاً من التنزيل التلقائي إلى مجلد Downloads أو OneDrive.

The bell notifications save system has been updated to allow users to select a specific location on their device to save the `plan-data.json` file instead of automatically downloading to the Downloads or OneDrive folder.

---

## كيفية الاستخدام (How to Use)

### المرة الأولى (First Time)

1. افتح التطبيق في المتصفح (يُفضل Chrome أو Edge)
2. قم بإنشاء أو تعديل إشعار جرس
3. اضغط على زر "حفظ"
4. **سيظهر لك مربع حوار لاختيار موقع الحفظ:**
   - انتقل إلى مجلد المشروع على جهازك
   - اختر الملف الموجود `plan-data.json`
   - اضغط على "حفظ"
5. ✅ تم! سيتم حفظ الملف في الموقع الذي اخترته

### المرات التالية (Subsequent Times)

1. قم بإنشاء أو تعديل إشعار جرس
2. اضغط على زر "حفظ"
3. ✅ سيتم حفظ الملف **تلقائياً** في نفس الموقع الذي اخترته سابقاً
4. **لن تحتاج** لاختيار الموقع مرة أخرى

---

## المزايا (Benefits)

### ✅ قبل التحديث (Before)
- كان الملف يُنزّل تلقائياً إلى مجلد Downloads
- أو يُنزّل إلى OneDrive إذا كان مفعّلاً
- يحتاج المستخدم لنقل الملف يدوياً في كل مرة

### ✅ بعد التحديث (After)
- **اختيار الموقع مرة واحدة** فقط
- **حفظ تلقائي** في نفس الموقع دائماً
- **لا توجد تنزيلات** غير مرغوبة إلى Downloads أو OneDrive
- **المزامنة الفورية** مع ملف المشروع الأصلي

---

## التفاصيل التقنية (Technical Details)

### التقنية المستخدمة
يستخدم النظام الآن **File System Access API** المتوفر في:
- ✅ Google Chrome (الإصدار 86 وما فوق)
- ✅ Microsoft Edge (الإصدار 86 وما فوق)
- ✅ Opera (الإصدار 72 وما فوق)
- ❌ Firefox (غير مدعوم حالياً)
- ❌ Safari (غير مدعوم حالياً)

### آلية العمل

#### المرة الأولى:
```javascript
// عند عدم وجود مرجع ملف محفوظ
if (!window.bellDataFileHandle) {
    // إظهار مربع حوار لاختيار الموقع
    const fileHandle = await window.showSaveFilePicker({
        suggestedName: 'plan-data.json',
        types: [{
            description: 'JSON files',
            accept: {'application/json': ['.json']},
        }],
    });
    
    // حفظ مرجع الملف للاستخدام المستقبلي
    window.bellDataFileHandle = fileHandle;
    
    // كتابة البيانات
    const writable = await fileHandle.createWritable();
    await writable.write(dataStr);
    await writable.close();
}
```

#### المرات التالية:
```javascript
// استخدام مرجع الملف المحفوظ
if (window.bellDataFileHandle) {
    const writable = await window.bellDataFileHandle.createWritable();
    await writable.write(dataStr);
    await writable.close();
}
```

---

## استكشاف الأخطاء (Troubleshooting)

### لا يظهر مربع حوار اختيار الموقع؟
- تأكد من استخدام متصفح مدعوم (Chrome أو Edge)
- تأكد من تحديث المتصفح لآخر إصدار
- تحقق من أن المتصفح لديه صلاحية الوصول للملفات

### يظهر خطأ "تم إلغاء عملية الحفظ"؟
- هذا طبيعي إذا ضغطت على "إلغاء" في مربع اختيار الموقع
- البيانات محفوظة في localStorage ويمكنك المحاولة مرة أخرى

### أريد تغيير موقع الحفظ؟
حالياً، لتغيير الموقع:
1. أغلق المتصفح وأعد فتحه (لإعادة ضبط مرجع الملف)
2. أو استخدم وضع التصفح الخاص لاختيار موقع مختلف

---

## الفرق عن الطرق الأخرى (Difference from Other Methods)

### طريقة "تصدير البيانات" (Export Data Button)
- **الاستخدام:** زر "تصدير البيانات إلى ملف JSON" في Developer Mode
- **السلوك:** يظهر مربع حوار اختيار الموقع في كل مرة
- **الملف:** يُنزّل إلى الموقع المختار
- **متى تستخدمه:** عند الرغبة في إنشاء نسخة احتياطية يدوية

### طريقة "حفظ تلقائي" (Automatic Save - NEW)
- **الاستخدام:** عند حفظ إشعارات الجرس
- **السلوك:** مربع حوار **مرة واحدة** فقط، ثم حفظ تلقائي
- **الملف:** يُحفظ في نفس الموقع دائماً
- **متى تستخدمه:** للتحديثات اليومية العادية

---

## ملاحظات مهمة (Important Notes)

1. **الأمان:** النظام الجديد أكثر أماناً لأنه يطلب إذن المستخدم صراحةً
2. **الخصوصية:** مرجع الملف محفوظ في ذاكرة الجلسة فقط ولا يُخزّن بشكل دائم
3. **المتصفحات غير المدعومة:** في حال استخدام متصفح غير مدعوم، ستظل البيانات محفوظة في localStorage
4. **التوافق مع Git:** النظام الجديد يسهّل المزامنة مع Git لأن الملف يُحفظ مباشرة في مجلد المشروع

---

## الدعم (Support)

إذا واجهت أي مشاكل أو لديك اقتراحات، يرجى التواصل مع المطور.

---

**تاريخ التحديث:** يناير 2025
**الإصدار:** 2.0
