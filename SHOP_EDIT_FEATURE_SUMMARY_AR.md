# ุชูุนูู ุงูุชุนุฏูู ุงูุดุงูู ูููุญูุงุช ูู Smart Planner ู Admin Dashboard

## ุงููุดููุฉ ุงูุฃุณุงุณูุฉ

ูุงู ุงููุทูุฑ ููุงุฌู ุตุนูุจุฉ ูู ุชุนุฏูู ุจูุงูุงุช ุงููุญูุงุช ูู ูุธุงู ุงูุชุฎุทูุท ุงูุดูุฑู:

1. **ูู admin-dashboard.html (ุฅุฏุงุฑุฉ ุงููุญูุงุช ุงููุงููุฉ)**:
   - ูุธููุฉ `editShop()` ูุงูุช ุชุนุฏู ุงุณู ุงููุญู ููุท ุนุจุฑ ูุงูุฐุฉ prompt ุจุณูุทุฉ
   - ูุง ุชูุฌุฏ ุฅููุงููุฉ ูุชุนุฏูู ุงูุชูุงุตูู ุงูุฃุฎุฑู ูุซู ุงูุชุฑุฎูุตุ ุงูุนููุงูุ ุงููุงุชูุ ุฅูุฎ

2. **ูู smart-planner.html (ูุงุฆูุฉ ุงููุญูุงุช ุงูุฐููุฉ)**:
   - ูุธููุฉ `editShopFromSmartList()` ูุงูุช ุชุทูุจ ุฅุฏุฎุงู ุฃุฑูุงู ุงูุญููู (1-9)
   - ุทุฑููุฉ ุบูุฑ ุงุญุชุฑุงููุฉ ููุนูุฏุฉ ูููุณุชุฎุฏู
   - ุชุชุทูุจ ุนุฏุฉ ุฎุทูุงุช ูุชุนุฏูู ุญูู ูุงุญุฏ

## ุงูุญู ุงููุทุจู

### 1. ุงูุชุนุฏููุงุช ูู smart-planner.html

#### ุฃ. ุงุณุชุจุฏุงู ูุธููุฉ editShopFromSmartList
```javascript
// ุงูููุฏ ุงููุฏูู (ุชู ุงุณุชุจุฏุงูู)
function editShopFromSmartList(shopName) {
    // ูุงู ูุทูุจ ุฅุฏุฎุงู ุฑูู ุงูุญูู (1-9)
    const choice = prompt('ุฃุฏุฎู ุฑูู ุงูุญูู ููุชุนุฏูู (1-9) ุฃู 0 ููุญูุธ:');
    // ...
}

// ุงูููุฏ ุงูุฌุฏูุฏ
function editShopFromSmartList(shopName) {
    // ูุจุญุซ ุนู ุงููุญู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
    const planShop = planData.shops.find(s => s.name === shopName);
    if (!planShop) {
        alert('โ ูู ูุชู ุงูุนุซูุฑ ุนูู ุงููุญู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช');
        return;
    }
    
    // ููุชุญ ุงููุงูุฐุฉ ุงูููุจุซูุฉ ุงูุดุงููุฉ ุงูููุฌูุฏุฉ ูุณุจูุงู
    openEditShopModal(planShop.id);
}
```

**ุงูููุงุฆุฏ**:
- ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงููุงูุฐุฉ ุงูููุจุซูุฉ ุงูููุฌูุฏุฉ (ูุง ุชูุฑุงุฑ ููููุฏ)
- ูุงุฌูุฉ ุงุญุชุฑุงููุฉ ูุน ุฌููุน ุงูุญููู ุธุงูุฑุฉ
- ุณูููุฉ ูู ุงูุงุณุชุฎุฏุงู

#### ุจ. ุชุญุณูู ูุธููุฉ saveShop
```javascript
// ุฅุถุงูุฉ ุชุญุฏูุซ ูุงุฆูุฉ ุงููุญูุงุช ุงูุฐููุฉ ุจุนุฏ ุงูุญูุธ
setTimeout(() => {
    closeShopModal();
    displayShopsList();
    populateAreas();
    // ุชุญุฏูุซ ูุงุฆูุฉ ุงููุญูุงุช ุงูุฐููุฉ ููุท ุฅุฐุง ูุงูุช ููุชูุญุฉ
    const smartShopModal = document.getElementById('smartShopListModal');
    if (smartShopModal && smartShopModal.style.display === 'block') {
        updateSmartShopList();
    }
}, 1500);
```

**ุงูููุงุฆุฏ**:
- ุชุญุฏูุซ ุชููุงุฆู ููููุงุฆู ุจุนุฏ ุงูุญูุธ
- ุชุญุณูู ุงูุฃุฏุงุก ุจุชุญุฏูุซ ุงููุงุฆูุฉ ููุท ุนูุฏ ุงูุญุงุฌุฉ

### 2. ุงูุชุนุฏููุงุช ูู admin-dashboard.html

#### ุฃ. ุฅุถุงูุฉ ูุงูุฐุฉ ููุจุซูุฉ ุดุงููุฉ ูุชุนุฏูู ุงููุญูุงุช

ุชู ุฅุถุงูุฉ modal ุฌุฏูุฏ ุจุนุฏ modal ุงูุชููู:

```html
<div id="shopEditModal" class="modal">
    <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
        <!-- ุฑุฃุณ ุงููุงูุฐุฉ -->
        <div class="modal-header">
            <h3 class="modal-title">โ๏ธ ุชุนุฏูู ุจูุงูุงุช ุงููุญู</h3>
            <button class="modal-close" onclick="closeShopEditModal()">...</button>
        </div>
        
        <!-- ูุญุชูู ุงููุงูุฐุฉ -->
        <div class="modal-body">
            <!-- ุงูุญููู ุงูุฅุฌุจุงุฑูุฉ -->
            <div style="background: #f8f9fa; ...">
                <h4>๐ ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ (ุฅุฌุจุงุฑูุฉ)</h4>
                <input id="shopEditName" ... />
                <select id="shopEditArea">...</select>
            </div>
            
            <!-- ุงูุญููู ุงูุงุฎุชูุงุฑูุฉ -->
            <div style="background: #e8f4f8; ...">
                <h4>๐ ุงูุชูุงุตูู ุงูุฅุถุงููุฉ (ุงุฎุชูุงุฑูุฉ)</h4>
                <input id="shopEditNameEn" ... />
                <input id="shopEditLicense" ... />
                <input id="shopEditAddress" ... />
                <input id="shopEditPhone" ... />
                <input id="shopEditEmail" ... />
                <input id="shopEditGoogleMaps" ... />
                <textarea id="shopEditActivity" ...></textarea>
                <input id="shopEditAdmCode" ... />
            </div>
        </div>
        
        <!-- ุฃุฒุฑุงุฑ ุงูุญูุธ ูุงูุฅูุบุงุก -->
        <div class="modal-footer">
            <button onclick="saveShopEdit()">๐พ ุญูุธ ููุฑุงู</button>
            <button onclick="closeShopEditModal()">โ ุฅูุบุงุก</button>
        </div>
    </div>
</div>
```

#### ุจ. ุงุณุชุจุฏุงู ูุธููุฉ editShop

```javascript
// ุงูููุฏ ุงููุฏูู (ุชู ุงุณุชุจุฏุงูู)
function editShop(oldName) {
    const newName = prompt(`ุชุนุฏูู ุงุณู ุงููุญู:...`);
    // ูุงู ูุนุฏู ุงูุงุณู ููุท
}

// ุงูููุฏ ุงูุฌุฏูุฏ
async function editShop(shopName) {
    // ุงูุชุญูู ูู ุชุญููู ุงูุจูุงูุงุช
    if (!planData || !planData.shops) {
        alert('โ๏ธ ูู ูุชู ุชุญููู ุงูุจูุงูุงุช ุจุนุฏ!');
        return;
    }
    
    // ุงูุจุญุซ ุนู ุงููุญู
    const shop = planData.shops.find(s => s.name === shopName);
    if (!shop) {
        alert('โ ูู ูุชู ุงูุนุซูุฑ ุนูู ุงููุญู');
        return;
    }
    
    // ุชุนุจุฆุฉ ุงูุญููู ุงูุฃุณุงุณูุฉ
    document.getElementById('shopEditName').value = shop.name;
    // ุชุนุจุฆุฉ ูุงุฆูุฉ ุงูููุงุทู...
    
    // ุชุญููู ุงูุชูุงุตูู ุงูุฅุถุงููุฉ ูู shops_details.json
    const response = await fetch('shops_details.json?...');
    const shopsDetails = await response.json();
    const details = shopsDetails[shopName];
    
    if (details) {
        // ุชุนุจุฆุฉ ุฌููุน ุงูุญููู ุงูุงุฎุชูุงุฑูุฉ
        document.getElementById('shopEditNameEn').value = details.nameEn || '';
        document.getElementById('shopEditLicense').value = details.licenseNo || '';
        // ... ุฅูุฎ
    }
    
    // ุฅุธูุงุฑ ุงููุงูุฐุฉ ุงูููุจุซูุฉ
    document.getElementById('shopEditModal').classList.add('show');
}
```

#### ุฌ. ุฅุถุงูุฉ ูุธููุฉ saveShopEdit

```javascript
async function saveShopEdit() {
    // ุงูุญุตูู ุนูู ุงูููู ูู ุงูุญููู
    const originalName = document.getElementById('shopEditOriginalName').value;
    const newName = document.getElementById('shopEditName').value.trim();
    const areaId = document.getElementById('shopEditArea').value;
    // ... ุงูุญููู ุงูุงุฎุชูุงุฑูุฉ
    
    // ุงูุชุญูู ูู ุงูุญููู ุงูุฅุฌุจุงุฑูุฉ
    if (!newName || !areaId) {
        showMessage('shopEditStatus', 'error', 'โ ูุฑุฌู ููุก ุงูุญููู ุงูุฅุฌุจุงุฑูุฉ');
        return;
    }
    
    // ุชุญุฏูุซ ุงููุญู ูู planData
    const shopIndex = planData.shops.findIndex(s => s.name === originalName);
    if (shopIndex !== -1) {
        planData.shops[shopIndex].name = newName;
        planData.shops[shopIndex].areaId = areaId;
        // ...
    }
    
    // ุชุญุฏูุซ ุฌููุน ุงูุณุฌูุงุช ุงูุชู ุชุญุชูู ุนูู ุงููุญู (ูู ุญุงูุฉ ุชุบููุฑ ุงูุงุณู)
    if (originalName !== newName) {
        planData.inspectionData.forEach(inspection => {
            if (inspection.shops && Array.isArray(inspection.shops)) {
                const index = inspection.shops.indexOf(originalName);
                if (index !== -1) {
                    inspection.shops[index] = newName;
                }
            }
        });
    }
    
    // ุญูุธ ูู plan-data.json ุนูู GitHub
    await savePlanDataToGitHub(`ุชุญุฏูุซ ูุญู: ${newName}`);
    
    // ุญูุธ ุงูุชูุงุตูู ุงูุฅุถุงููุฉ ูู shops_details.json
    if (/* ุฃู ุญูู ุงุฎุชูุงุฑู ููุชูุฆ */) {
        await saveShopDetailsToGitHub(originalName, newName, details);
    }
    
    // ุฅุบูุงู ุงููุงูุฐุฉ ูุชุญุฏูุซ ุงููุงุฆูุฉ
    closeShopEditModal();
    loadShopsList();
}
```

#### ุฏ. ุฅุถุงูุฉ ูุธููุฉ saveShopDetailsToGitHub

```javascript
async function saveShopDetailsToGitHub(oldName, newName, details) {
    // ุงูุญุตูู ุนูู ูุญุชูู shops_details.json ุงูุญุงูู
    const getRes = await fetch(`https://api.github.com/repos/${repo}/contents/shops_details.json`, {...});
    const file = await getRes.json();
    const currentContent = JSON.parse(decodeURIComponent(escape(atob(file.content))));
    
    // ูู ุญุงูุฉ ุชุบููุฑ ุงูุงุณูุ ุญุฐู ุงูุณุฌู ุงููุฏูู
    if (oldName !== newName && currentContent[oldName]) {
        delete currentContent[oldName];
    }
    
    // ุฅุถุงูุฉ/ุชุญุฏูุซ ุงูุชูุงุตูู ุงูุฌุฏูุฏุฉ (ูุน ุญุฐู ุงูุญููู ุงููุงุฑุบุฉ)
    const cleanDetails = {};
    if (details.nameAr) cleanDetails.nameAr = details.nameAr;
    if (details.nameEn) cleanDetails.nameEn = details.nameEn;
    // ... ุฅูุฎ
    
    currentContent[newName] = cleanDetails;
    
    // ุฑูุน ุงูููู ุงููุญุฏุซ ุฅูู GitHub
    const updateRes = await fetch(`https://api.github.com/repos/${repo}/contents/shops_details.json`, {
        method: 'PUT',
        body: JSON.stringify({
            message: `ุชุญุฏูุซ ุชูุงุตูู ุงููุญู: ${newName}`,
            content: btoa(unescape(encodeURIComponent(JSON.stringify(currentContent, null, 2)))),
            sha: file.sha
        })
    });
}
```

## ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### 1. ูุงุฌูุฉ ุงุญุชุฑุงููุฉ
- ูุงูุฐุฉ ููุจุซูุฉ ููุธูุฉ ููุงุถุญุฉ
- ุชูุณูู ุงูุญููู ุฅูู ุฅุฌุจุงุฑูุฉ ูุงุฎุชูุงุฑูุฉ
- ุชุตููู ุฌุฐุงุจ ููุฑูุญ ููุนูู

### 2. ุชุนุฏูู ุดุงูู
ูููู ุชุนุฏูู ุฌููุน ูุนูููุงุช ุงููุญู ุฏูุนุฉ ูุงุญุฏุฉ:
- โ ุงูุงุณู ุจุงูุนุฑุจูุฉ
- โ ุงูุงุณู ุจุงูุฅูุฌููุฒูุฉ
- โ ุงูููุทูุฉ
- โ ุฑูู ุงูุชุฑุฎูุต
- โ ุงูุนููุงู
- โ ุฑูู ุงููุงุชู
- โ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- โ ูููุน ุงูุฎุฑุงุฆุท
- โ ุทุจูุนุฉ ุงููุดุงุท
- โ ููุฏ ADM

### 3. ุญูุธ ุชููุงุฆู
- ูุญูุธ ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ ูู `plan-data.json`
- ูุญูุธ ุงูุชูุงุตูู ุงูุฅุถุงููุฉ ูู `shops_details.json`
- ูุชู ุงูุญูุธ ูุจุงุดุฑุฉ ุนูู GitHub
- ูุง ุญุงุฌุฉ ูุฎุทูุงุช ุฅุถุงููุฉ ูููุฒุงููุฉ

### 4. ุชุญุฏูุซ ุฐูู
- ูุญุฏุซ ุฌููุน ุงูุณุฌูุงุช ุงููุฑุชุจุทุฉ ุจุงููุญู ุนูุฏ ุชุบููุฑ ุงูุงุณู
- ูุญุฏุซ ููุงุฆู ุงููุญูุงุช ุชููุงุฆูุงู ุจุนุฏ ุงูุญูุธ
- ูุชุญูู ูู ุญุงูุฉ ุงูุนุฑุถ ูุจู ุงูุชุญุฏูุซ ูุชุญุณูู ุงูุฃุฏุงุก

## ููููุฉ ุงูุงุณุชุฎุฏุงู

### ูู smart-planner.html

1. ุงูุชุญ `smart-planner.html` ูู ุงููุชุตูุญ
2. ุณุฌู ุฏุฎูู ุจุงูุชููู ุงููุทููุจ
3. ูุชุนุฏูู ูุญู ูู "ุฅุฏุงุฑุฉ ุงููุญูุงุช ุงููุงููุฉ":
   - ุงูุชูู ุฅูู ุชุจููุจ "ุงููุญูุงุช"
   - ุงุถุบุท ุนูู ุฃููููุฉ ุงูุชุนุฏูู (โ๏ธ) ุจุฌุงูุจ ุฃู ูุญู
   - ุณุชูุชุญ ูุงูุฐุฉ ููุจุซูุฉ ูุน ุฌููุน ุงูุญููู
4. ูุชุนุฏูู ูุญู ูู "ูุงุฆูุฉ ุงููุญูุงุช ุงูุฐููุฉ":
   - ุงูุชูู ุฅูู ูุณู "ูุงุฆูุฉ ุงููุญูุงุช ุงูุฐููุฉ"
   - ุงุถุบุท ุนูู ุฒุฑ ุงูุชุนุฏูู (โ๏ธ) ุจุฌุงูุจ ุฃู ูุญู
   - ุณุชูุชุญ ููุณ ุงููุงูุฐุฉ ุงูููุจุซูุฉ ุงูุดุงููุฉ
5. ุนุฏู ุงูุญููู ุงููุทููุจุฉ
6. ุงุถุบุท "๐พ ุญูุธ ููุฑุงู"
7. ูุชู ุงูุญูุธ ุชููุงุฆูุงู ุนูู GitHub

### ูู admin-dashboard.html

1. ุงูุชุญ `admin-dashboard.html` ูู ุงููุชุตูุญ
2. ุณุฌู ุฏุฎูู ุจุงูุชููู ุงููุทููุจ
3. ุงูุชูู ุฅูู ูุณู "ุฅุฏุงุฑุฉ ุงููุญูุงุช"
4. ุงุถุบุท ุนูู "ุชุญุฏูุซ ุงููุงุฆูุฉ" ูุชุญููู ุงูุจูุงูุงุช
5. ุงุถุบุท ุนูู ุฒุฑ "ุชุนุฏูู" ุจุฌุงูุจ ุฃู ูุญู
6. ุณุชูุชุญ ูุงูุฐุฉ ููุจุซูุฉ ูุน ุฌููุน ุงูุญููู
7. ุนุฏู ุงูุญููู ุงููุทููุจุฉ
8. ุงุถุบุท "๐พ ุญูุธ ููุฑุงู"
9. ูุชู ุงูุญูุธ ุชููุงุฆูุงู ุนูู GitHub ูุชุญุฏูุซ ุงููุงุฆูุฉ

## ุงููููุงุช ุงููุนุฏูุฉ

1. **smart-planner.html**
   - ุณุทุฑ 11906-11918: ุงุณุชุจุฏุงู ูุธููุฉ `editShopFromSmartList`
   - ุณุทุฑ 4945-4955: ุชุญุฏูุซ ูุธููุฉ `saveShop` ูุชุญุฏูุซ ูุงุฆูุฉ ุงููุญูุงุช ุงูุฐููุฉ

2. **admin-dashboard.html**
   - ุณุทุฑ 1472-1588: ุฅุถุงูุฉ modal ุฌุฏูุฏ ูุชุนุฏูู ุงููุญูุงุช
   - ุณุทุฑ 2732-3095: ุงุณุชุจุฏุงู ูุธููุฉ `editShop` ูุฅุถุงูุฉ ุงููุธุงุฆู ุงููุณุงุนุฏุฉ
   - ุณุทุฑ 2598-2601: ุฅุถุงูุฉ ูุธููุฉ `savePlanDataToGitHub` ููุชูุงูู

3. **test_shop_edit_functionality.html** (ุฌุฏูุฏ)
   - ุฏููู ุดุงูู ููุงุฎุชุจุงุฑ ูุงูุชุญูู ูู ุงููุธุงุฆู ุงูุฌุฏูุฏุฉ

## ุงูุงุฎุชุจุงุฑ

ุชู ุฅูุดุงุก ููู `test_shop_edit_functionality.html` ุงูุฐู ูุญุชูู ุนูู:
- ููุฎุต ุดุงูู ููุชุบููุฑุงุช
- ุดุฑุญ ููููุฒุงุช ุงูุฌุฏูุฏุฉ
- ุฏููู ุฎุทูุฉ ุจุฎุทูุฉ ููุงุฎุชุจุงุฑ
- ุฑูุงุจุท ูุจุงุดุฑุฉ ููุชุญ ุงููุงุฌูุงุช

## ุงูุฃูุงู

- โ ุชู ุงูุชุญูู ูู ุงูููุฏ ุจุงุณุชุฎุฏุงู CodeQL - ูุง ุชูุฌุฏ ูุดููุงุช ุฃูููุฉ
- โ ูุชู ุงูุชุญูู ูู ุตูุงุญูุงุช GitHub Token ูุจู ุงูุญูุธ
- โ ูุชู ุงูุชุญูู ูู ูุฌูุฏ ุงูุจูุงูุงุช ูุจู ุงูุชุนุฏูู
- โ ูุชู ุชูุธูู ุงูููู ุงููุงุฑุบุฉ ูุจู ุงูุญูุธ
- โ ูุชู ุงุณุชุฎุฏุงู ููุณ ููุท ุงูุชุฑููุฒ ุงูููุฌูุฏ ูู ุงูููุฏ ุงูุฃุตูู ููุชูุงูู

## ุงูุฎูุงุตุฉ

ุชู ุญู ุงููุดููุฉ ุจูุฌุงุญ! ุงูุขู ูููู ูููุทูุฑ ุชุนุฏูู ุงููุญูุงุช ุจุณูููุฉ ูุงุญุชุฑุงููุฉ ูู ูู ูู:
- โ ูุงุฆูุฉ ุงููุญูุงุช ุงูุฐููุฉ ูู smart-planner.html
- โ ุฅุฏุงุฑุฉ ุงููุญูุงุช ุงููุงููุฉ ูู smart-planner.html
- โ ุฅุฏุงุฑุฉ ุงููุญูุงุช ูู admin-dashboard.html

ุฏูู ุงูุญุงุฌุฉ ุฅูู:
- โ ุฅุฏุฎุงู ุฃุฑูุงู ุงูุญููู (1-9)
- โ ุฎุทูุงุช ูุนูุฏุฉ
- โ ุชุนุฏููุงุช ูุชุนุฏุฏุฉ ูุญููู ูุฎุชููุฉ

ูุน ุชูููุฑ:
- โ ูุงุฌูุฉ ุงุญุชุฑุงููุฉ ูุณููุฉ ุงูุงุณุชุฎุฏุงู
- โ ุชุนุฏูู ุดุงูู ูุฌููุน ุงูุญููู ุฏูุนุฉ ูุงุญุฏุฉ
- โ ุญูุธ ุชููุงุฆู ุนูู GitHub
- โ ุชุญุฏูุซ ููุฑู ููููุงุฆู
