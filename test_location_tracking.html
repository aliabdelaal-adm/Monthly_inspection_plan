<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اختبار نظام تتبع الزيارات</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 40px;
            font-size: 1.1em;
        }
        
        .feature-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #667eea;
        }
        
        .feature-title {
            font-size: 1.4em;
            color: #234085;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .feature-description {
            color: #555;
            line-height: 1.8;
            margin-bottom: 15px;
        }
        
        .feature-list {
            list-style-position: inside;
            color: #555;
            line-height: 2;
        }
        
        .feature-list li {
            padding: 5px 0;
        }
        
        .button {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.1em;
            text-align: center;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            margin: 10px 5px;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        
        .button-success {
            background: linear-gradient(135deg, #43cea2 0%, #185a9d 100%);
        }
        
        .button-warning {
            background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
        }
        
        .demo-links {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .info-box {
            background: #e7f3ff;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            margin: 25px 0;
        }
        
        .info-box-title {
            color: #667eea;
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        
        .map-link {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            text-decoration: none;
            margin: 10px;
            transition: all 0.3s ease;
        }
        
        .map-link:hover {
            background: #20c997;
            transform: scale(1.05);
        }
        
        .status-box {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .status-text {
            font-size: 1.1em;
            color: #666;
            margin-bottom: 15px;
        }
        
        #locationStatus {
            font-weight: bold;
            color: #667eea;
            font-size: 1.2em;
        }
        
        .coordinates {
            font-family: monospace;
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>📍 اختبار نظام تتبع الزيارات</h1>
        <p class="subtitle">Inspector Location Tracking & Visit Monitoring System Test</p>
        
        <div class="feature-section">
            <div class="feature-title">
                <span>🎯</span>
                <span>الميزات الرئيسية</span>
            </div>
            <div class="feature-description">
                نظام متكامل لتتبع زيارات المفتشين للمحلات بطريقة مشروعة وآمنة:
            </div>
            <ul class="feature-list">
                <li>✅ تتبع موقع GPS الحقيقي للمفتش</li>
                <li>✅ تسجيل تلقائي عند الاقتراب من المحل (ضمن 100 متر)</li>
                <li>✅ تتبع فتح روابط خرائط جوجل للمحلات</li>
                <li>✅ إشعارات فورية للمطور عند الزيارة</li>
                <li>✅ لوحة تحكم شاملة مع إحصائيات</li>
                <li>✅ تصدير السجلات إلى CSV</li>
                <li>✅ خصوصية محترمة مع صلاحيات واضحة</li>
            </ul>
        </div>
        
        <div class="info-box">
            <div class="info-box-title">💡 كيفية الاختبار</div>
            <div>
                <strong>1. الحصول على صلاحيات الموقع:</strong>
                <div class="demo-links">
                    <button class="button button-success" onclick="requestLocation()">
                        📍 طلب صلاحية الموقع
                    </button>
                </div>
                
                <div class="status-box">
                    <div class="status-text">حالة الموقع:</div>
                    <div id="locationStatus">في انتظار الطلب...</div>
                    <div id="coordinates" class="coordinates" style="display: none;"></div>
                </div>
                
                <strong>2. اختبار تتبع روابط الخرائط:</strong>
                <div class="demo-links">
                    <a href="https://maps.google.com/?q=24.51006317138672,54.37873458862305" 
                       target="_blank" 
                       class="map-link"
                       data-shop-name="محل جرين لندز">
                        🗺️ محل جرين لندز - سوق الميناء
                    </a>
                    
                    <a href="https://maps.google.com/?q=24.4574,54.3775" 
                       target="_blank" 
                       class="map-link"
                       data-shop-name="محل اختبار الوثبة">
                        🗺️ محل اختبار الوثبة
                    </a>
                </div>
                
                <strong>3. فتح النظام الكامل:</strong>
                <div class="demo-links">
                    <a href="index.html" class="button">
                        🚀 فتح النظام الكامل
                    </a>
                </div>
            </div>
        </div>
        
        <div class="feature-section">
            <div class="feature-title">
                <span>🔒</span>
                <span>الخصوصية والأمان</span>
            </div>
            <ul class="feature-list">
                <li>يتم طلب صلاحية الموقع بشكل صريح من المستخدم</li>
                <li>جميع البيانات محفوظة محلياً في جهاز المستخدم</li>
                <li>النظام يستخدم الموقع فقط أثناء العمل</li>
                <li>يمكن إيقاف التتبع في أي وقت</li>
                <li>البيانات مشفرة ومحمية</li>
            </ul>
        </div>
        
        <div class="feature-section">
            <div class="feature-title">
                <span>📊</span>
                <span>التقارير المتاحة</span>
            </div>
            <div class="feature-description">
                يوفر النظام تقارير شاملة تشمل:
            </div>
            <ul class="feature-list">
                <li>إجمالي عدد الزيارات لكل مفتش</li>
                <li>الزيارات حسب النوع (GPS أو روابط الخرائط)</li>
                <li>المحلات الأكثر زيارة</li>
                <li>المفتشين الأكثر نشاطاً</li>
                <li>توزيع الزيارات حسب التاريخ والوقت</li>
                <li>المسافة الدقيقة عند الزيارة</li>
            </ul>
        </div>
        
        <div class="info-box">
            <div class="info-box-title">⚠️ متطلبات النظام</div>
            <ul class="feature-list">
                <li>متصفح حديث يدعم Geolocation API</li>
                <li>اتصال بالإنترنت (لخرائط جوجل)</li>
                <li>HTTPS أو localhost (لصلاحيات الموقع)</li>
                <li>تفعيل خدمات الموقع في الجهاز</li>
            </ul>
        </div>
    </div>
    
    <script>
        // Track map link clicks
        document.addEventListener('click', function(event) {
            const target = event.target;
            
            if (target.tagName === 'A' && target.href && 
                (target.href.includes('maps.google.com') || target.href.includes('google.com/maps'))) {
                
                const shopName = target.getAttribute('data-shop-name');
                
                if (shopName) {
                    setTimeout(() => {
                        alert(`✅ تم تسجيل فتح خرائط جوجل\n\nالمحل: ${shopName}\n\nفي النظام الحقيقي، سيتم:\n- إرسال إشعار للمطور\n- تسجيل الزيارة في السجل\n- حساب الوقت والتاريخ`);
                    }, 500);
                }
            }
        });
        
        // Request location permission
        function requestLocation() {
            const statusEl = document.getElementById('locationStatus');
            const coordsEl = document.getElementById('coordinates');
            
            statusEl.textContent = 'جاري الحصول على الموقع...';
            statusEl.style.color = '#ffc107';
            
            if (!navigator.geolocation) {
                statusEl.textContent = '❌ المتصفح لا يدعم خدمات الموقع';
                statusEl.style.color = '#dc3545';
                return;
            }
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude.toFixed(6);
                    const lng = position.coords.longitude.toFixed(6);
                    const accuracy = Math.round(position.coords.accuracy);
                    
                    statusEl.textContent = '✅ تم الحصول على الموقع بنجاح!';
                    statusEl.style.color = '#28a745';
                    
                    coordsEl.style.display = 'block';
                    coordsEl.innerHTML = `
                        <strong>الإحداثيات:</strong><br>
                        خط العرض: ${lat}<br>
                        خط الطول: ${lng}<br>
                        الدقة: ${accuracy} متر
                    `;
                    
                    // Show success message
                    setTimeout(() => {
                        alert(`✅ تم الحصول على موقعك بنجاح!\n\nالدقة: ${accuracy} متر\n\nالآن يمكنك:\n1. زيارة أحد المحلات (إذا كنت قريباً)\n2. النقر على روابط خرائط جوجل للاختبار\n3. فتح النظام الكامل لرؤية المزيد من الميزات`);
                    }, 500);
                },
                (error) => {
                    let errorMsg = '❌ فشل الحصول على الموقع';
                    
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMsg = '❌ تم رفض الصلاحية\n\nيرجى السماح بالوصول للموقع';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMsg = '❌ الموقع غير متاح';
                            break;
                        case error.TIMEOUT:
                            errorMsg = '❌ انتهت مهلة الطلب';
                            break;
                    }
                    
                    statusEl.textContent = errorMsg;
                    statusEl.style.color = '#dc3545';
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }
    </script>
</body>
</html>
