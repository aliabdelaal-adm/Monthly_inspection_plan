<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ÿÆÿ∑ÿ© ÿßŸÑÿ™ŸÅÿ™Ÿäÿ¥ ÿßŸÑÿ¥Ÿáÿ±Ÿäÿ©</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- ŸÖŸÉÿ™ÿ®ÿßÿ™ ÿßŸÑÿ™ÿµÿØŸäÿ± -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { font-family: 'Cairo', Arial, sans-serif; background: #f7f9fc; margin:0;}
        .main-container {
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 2px 16px #dadce0;
            padding: 36px 18px 24px 18px;
            max-width: 900px;
            min-width:320px;
            margin: 64px auto 0 auto;
            display: flex; flex-direction: column; align-items: center;
        }
        .header-top-bar {
            width:100%;
            display:flex;
            justify-content:space-between;
            align-items:center;
            margin-bottom: 8px;
            position: relative;
        }
        .last-update-row {
            color: #666;
            font-size: 0.97em;
            margin-right: 8px;
            margin-top: 0;
            text-align: right;
            direction: ltr;
        }
        .bell-container {
            margin-left:8px;
            margin-top:0;
        }
        .bell-btn {
            background: none;
            border: none;
            cursor: pointer;
            outline: none;
            padding: 0;
        }
        .bell-icon {
            width: 38px;
            height: 38px;
            fill: #ffc107;
            transition: fill 0.2s;
        }
        .bell-btn:hover .bell-icon {
            fill: #ff9800;
        }
        .horizontal-line {
            width: 100%;
            border: none;
            border-top: 1.5px solid #e0e3ea;
            margin: 16px 0 0 0;
        }
        .title-bar {
            width:100%;
            display:flex;
            justify-content:center;
            align-items:center;
            margin-top: 18px;
            margin-bottom: 24px;
        }
        .main-title-box {
            background:#234085;
            color:#fff;
            padding:28px 0 28px 0;
            border-radius:14px;
            width: 96%;
            max-width: 600px;
            min-height: 56px;
            font-size:2.12em;
            text-align:center;
            font-weight: bold;
            letter-spacing: 1px;
            margin:0 auto;
            box-shadow:0 2px 14px #e0e2f5;
        }
        .login-section, .inspector-select-section {margin: 10px 0 18px 0; width: 100%; display:flex;justify-content:center;align-items:center;gap:10px;}
        select, input[type="text"], input[type="date"], input[type="password"] {padding:7px 16px;font-size:1em;border-radius:6px;border:1px solid #b6b6b6;min-width:130px;max-width:210px;}
        .actions-row {width:100%;display:flex;justify-content:center;align-items:center;gap:18px;margin:20px 0 18px;}
        .save-box, .report-box {display:flex;gap:12px;}
        .save-box button, .report-box button {padding:10px 28px;border-radius:8px;border:none;cursor:pointer;font-size:1em;}
        .pdf-btn {background:#d63384;color:#fff;}
        .excel-btn {background:#198754;color:#fff;}
        .inspector-report-btn {background:#234085;color:#fff;}
        .monthly-report-btn {background:#ff9800;color:#fff;}
        .plan-table-container {width:100%;margin:18px 0;}
        .plan-table {width:100%;border-collapse:collapse;border-radius:13px;overflow:hidden;box-shadow:0 2px 14px #eee;}
        .plan-table th,.plan-table td {padding:10px 8px;text-align:center;}
        .plan-table th {
            background:#234085;
            color:#fff;
            font-weight:bold;
            font-size:1.12em;
        }
        .plan-table tr:nth-child(even) {background:#f5f7fb;}
        .plan-table td {
            border-bottom:1px solid #d7dcef;
            font-size:1em;
        }
        .dropdown-shops-btn {
            background:#234085;
            color:#fff;
            border:none;
            border-radius:6px;
            padding:6px 18px;
            cursor:pointer;
            font-size:0.98em;
            min-width:90px;
        }
        .shops-dropdown-list {
            display:none;
            position:fixed;
            background:#fff;
            border:1px solid #23408577;
            border-radius:9px;
            margin-top:5px;
            min-width:130px;
            max-height:210px;
            box-shadow:0 2px 14px #eaeaea;
            z-index:1000;
            right:unset;
            left:unset;
            text-align:right;
            overflow-y:auto;
        }
        .shops-dropdown-list ul {
            list-style: none;
            margin:0; padding:7px 5px;
        }
        .shops-dropdown-list ul li {
            padding:3px 0 3px 0;
            border-bottom:1px solid #eee;
            font-size:0.97em;
        }
        .shops-dropdown-list ul li:last-child {border-bottom:none;}
        .shops-dropdown-wrap {position:relative; display:inline-block;}
        .inspector-report-div {margin:16px 0 0 0;background:#f7f9fc;border-radius:10px;padding:18px 12px;width:100%;color:#234085;font-size:1.1em;box-shadow:0 1px 5px #e2e2e2;}
        .modal-overlay {
            display:none; position:fixed;z-index:9999;right:0;left:0;top:0;bottom:0; background:rgba(0,0,0,0.18);align-items:center;justify-content:center;
        }
        .modal-content {
            background:#fff; border-radius:16px; box-shadow:0 2px 16px #23409333;
            padding:32px 18px; margin:50px auto; max-width:95vw; min-width:70vw; position:relative; text-align:center;
        }
        .modal-content button.close-btn {
            position:absolute; left:10px; top:10px; border:none; background:#d32f2f; color:#fff; border-radius:50%; font-size:1.4em;width:38px;height:38px;cursor:pointer;
        }
        .modal-actions {
            margin: 16px 0 0 0;
            display:flex;
            justify-content:center;
            gap:10px;
        }
        .stats-title {color:#134093;font-size:1.18em;text-align:center;margin-bottom:15px;}
        .stats-table {width:100%;border-collapse:collapse;margin-bottom:0;font-size:1.04em;}
        .stats-table th, .stats-table td {border:1px solid #234093;padding:10px 6px;text-align:center;}
        .stats-table th {background:#234093;color:#fff;}
        .stats-table tr:nth-child(even) {background:#f3f5fa;}
        .footer {text-align:center;margin-top:22px;color:#234085;font-size:0.85em;}
        .red-total {
            color: #d32f2f !important;
            font-weight: bold !important;
            background: #fffbe9;
        }
        .pdf-title-arabic {
            font-size: 1.18em;
            text-align: center;
            color: #234085;
            font-weight: bold;
            margin-bottom: 10px;
            width: 100%;
            margin-top: 0;
        }
        .edit-btn, .delete-btn {
            background: #6c757d; color: #fff; border: none; border-radius: 5px; padding: 6px 12px; margin: 2px; cursor: pointer; font-size: 0.95em;
        }
        .edit-btn:hover { background: #495057; }
        .delete-btn { background: #d32f2f; }
        .delete-btn:hover { background: #b71c1c; }
        .dev-section {background:#e9ecef;border-radius:8px;padding:16px 11px;margin:14px 0 14px 0;}
        .dev-section .close-btn {background:#d32f2f;color:#fff;border:none;border-radius:5px;padding:0 13px;font-size:1.1em;cursor:pointer;float:left;}
        #devPasswordForm {margin-bottom:6px;}
        @media (max-width:600px) {
            .main-container {padding:10px 1vw 7px 1vw;}
            /* ... ÿßŸÑÿÆ ... */
        }
    </style>
</head>
<body>
<div class="main-container">
    <!-- ... ŸÉŸÑ ÿßŸÑÿµŸÅÿ≠ÿ© ŸÉŸÖÿß ŸáŸä ... -->
    <!-- ... ÿ£ŸÇÿ≥ÿßŸÖ ÿßŸÑÿµŸÅÿ≠ÿ© ... -->
    <div id="devSection" class="dev-section" style="display:none;">
        <form id="addEditForm" style="width:100%;max-width:700px;display:flex;flex-wrap:wrap;gap:12px 20px;align-items:center;justify-content:center;margin-bottom:12px;">
            <select id="formInspector" required>
                <option value="">ŸÖŸÅÿ™ÿ¥</option>
            </select>
            <input type="date" id="formDay" required>
            <select id="formShift" required>
                <option value="">ŸàŸÇÿ™ ÿßŸÑŸÖŸÜÿßŸàÿ®ÿ©</option>
                <option value="ÿµÿ®ÿßÿ≠Ÿäÿ©">ÿµÿ®ÿßÿ≠Ÿäÿ©</option>
                <option value="ŸÖÿ≥ÿßÿ¶Ÿäÿ©">ŸÖÿ≥ÿßÿ¶Ÿäÿ©</option>
            </select>
            <input type="text" id="formArea" placeholder="ÿßŸÑŸÖŸÜÿ∑ŸÇÿ©" required>
            <input type="text" id="formShops" placeholder="ÿßŸÑŸÖÿ≠ŸÑÿßÿ™ (ÿßŸÅÿµŸÑ ÿ®ŸäŸÜŸáÿß ÿ®ŸÅÿßÿµŸÑÿ© ,)" required>
            <button type="submit" style="background:#198754;color:#fff;border:none;padding:8px 22px;border-radius:7px;font-size:1em;cursor:pointer;">ÿ•ÿ∂ÿßŸÅÿ© / ÿ™ÿπÿØŸäŸÑ</button>
            <input type="hidden" id="formEditingIndex" value="">
        </form>
    </div>
    <!-- =============== ÿ®ÿØÿßŸäÿ© ŸÉŸàÿØ ÿßŸÑÿ≤ÿ± =============== -->
    <div id="githubSaveBar" style="display:none; margin: 15px 0;">
        <button id="saveToGitHubBtn" style="background:#222;color:#fff;padding:8px 25px;border-radius:8px;border:none;font-size:16px;cursor:pointer">
            üíæ ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÅŸä GitHub
        </button>
        <span id="githubSaveMsg" style="margin-right:15px;color:green;font-weight:bold"></span>
    </div>
    <div id="githubTokenModal" style="display:none; position:fixed;top:0;left:0;width:100vw;height:100vh;background:#0008;z-index:1000;justify-content:center;align-items:center">
        <div style="background:#fff;padding:30px 25px;border-radius:12px;max-width:350px">
            <h4 style="margin-bottom:10px">ÿ•ÿØÿÆÿßŸÑ GitHub Token</h4>
            <input type="password" id="githubTokenInput" style="width:100%;padding:8px" placeholder="ÿßŸÑÿµŸÇ ÿßŸÑÿ™ŸàŸÉŸÜ ŸáŸÜÿß" />
            <div id="githubTokenMsg" style="color:red;margin:7px 0 0"></div>
            <button onclick="saveGithubToken()" style="margin-top:10px;padding:6px 25px;border-radius:7px;background:#1976d2;color:#fff">ÿ≠ŸÅÿ∏</button>
        </div>
    </div>
    <!-- =============== ŸÜŸáÿßŸäÿ© ŸÉŸàÿØ ÿßŸÑÿ≤ÿ± =============== -->
    <!-- ... ÿ®ÿßŸÇŸä ÿßŸÑÿµŸÅÿ≠ÿ© ... -->
    <div id="planTableContainer" class="plan-table-container"></div>
    <!-- ... ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ± ŸàÿßŸÑŸÅŸàÿ™ÿ± ... -->
    <div class="footer">
        ÿ™ŸÖ ÿßŸÑÿ™ÿ∑ŸàŸäÿ± ÿ®Ÿàÿßÿ≥ÿ∑ÿ© &copy; ÿßŸÑŸÖÿ∑Ÿàÿ± ÿØ. ÿπŸÑŸä ÿπÿ®ÿØÿßŸÑÿπÿßŸÑ
    </div>
</div>
<script>
// ... ÿ¨ŸÖŸäÿπ ÿ≥ŸÉÿ±ÿ®ÿ™ŸÉ ÿßŸÑÿ£ÿµŸÑŸäÿ© ŸÉŸÖÿß ŸáŸä ...
// =============== ÿ®ÿØÿßŸäÿ© ŸÉŸàÿØ ÿßŸÑÿ≤ÿ± ===============
const GITHUB_REPO = "aliabdelaal-adm/Monthly_inspection_plan";
const PLAN_FILE = "plan-data.json";
function getGithubToken() {
    return localStorage.getItem("github_token") || "";
}
function setGithubToken(token) {
    localStorage.setItem("github_token", token);
}
function showGithubTokenModal(msg="") {
    document.getElementById("githubTokenModal").style.display = "flex";
    document.getElementById("githubTokenInput").value = "";
    document.getElementById("githubTokenMsg").innerText = msg;
    document.getElementById("githubTokenInput").focus();
}
function saveGithubToken() {
    const token = document.getElementById("githubTokenInput").value.trim();
    if(token.length < 10) {
        document.getElementById("githubTokenMsg").innerText = "ÿ™ŸàŸÉŸÜ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠!";
        return;
    }
    setGithubToken(token);
    document.getElementById("githubTokenModal").style.display = "none";
    document.getElementById("githubSaveMsg").innerText = "ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸàŸÉŸÜÿå ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ≠ŸÅÿ∏ ÿßŸÑÿ¢ŸÜ.";
}
function showGithubSaveIfDeveloper() {
    if(window.isDev) {
        document.getElementById('githubSaveBar').style.display = '';
    } else {
        document.getElementById('githubSaveBar').style.display = 'none';
    }
}
let origDevLoginBtn = document.getElementById("devLoginBtn").onclick;
document.getElementById("devLoginBtn").onclick = function() {
    if(origDevLoginBtn) origDevLoginBtn();
    setTimeout(showGithubSaveIfDeveloper, 50);
};
let origDevLogoutBtn = document.getElementById("devLogoutBtn").onclick;
document.getElementById("devLogoutBtn").onclick = function() {
    if(origDevLogoutBtn) origDevLogoutBtn();
    setTimeout(showGithubSaveIfDeveloper, 50);
};
document.addEventListener('DOMContentLoaded', function(){
    showGithubSaveIfDeveloper();
});
document.getElementById("saveToGitHubBtn").onclick = async function() {
    let token = getGithubToken();
    if (!token) { showGithubTokenModal(); return; }
    let planData = window.inspectionData;
    if (!planData) {
        document.getElementById("githubSaveMsg").innerText = "ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ®ŸäÿßŸÜÿßÿ™ ŸÑŸÑÿ≠ŸÅÿ∏!";
        return;
    }
    document.getElementById("githubSaveMsg").innerText = "ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ≠ŸÅÿ∏...";
    let nowDate = new Date();
    planData.lastUpdate = nowDate.getFullYear()+"-"+String(nowDate.getMonth()+1).padStart(2,'0')+"-"+String(nowDate.getDate()).padStart(2,'0")
        +" "+String(nowDate.getHours()).padStart(2,'0')+":"+String(nowDate.getMinutes()).padStart(2,'0');
    let planContent = JSON.stringify(planData,null,2);
    let sha = null;
    try {
        const res = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/${PLAN_FILE}`);
        if(res.ok) {
            const json = await res.json();
            sha = json.sha;
        }
    } catch {}
    const putRes = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/${PLAN_FILE}`, {
        method: "PUT",
        headers: {
            "Authorization": `token ${token}`,
            "Accept": "application/vnd.github+json"
        },
        body: JSON.stringify({
            message: "ÿ™ÿ≠ÿØŸäÿ´ ÿÆÿ∑ÿ© ÿßŸÑÿ™ŸÅÿ™Ÿäÿ¥ ŸÖŸÜ ÿµŸÅÿ≠ÿ© ÿßŸÑŸÖÿ∑Ÿàÿ±",
            content: btoa(unescape(encodeURIComponent(planContent))),
            sha: sha
        })
    });
    if(putRes.ok) {
        document.getElementById("githubSaveMsg").innerText = "‚úÖ ÿ™ŸÖ ÿßŸÑÿ≠ŸÅÿ∏ ÿ®ŸÜÿ¨ÿßÿ≠ ŸÅŸä GitHub!";
    } else {
        document.getElementById("githubSaveMsg").innerText = "‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ŸÅÿ∏ (ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ™ŸàŸÉŸÜ/ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿßÿ™)!";
        if(putRes.status === 401) showGithubTokenModal("ÿ™ŸàŸÉŸÜ ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠ ÿ£Ÿà ŸÖŸÜÿ™ŸáŸä!");
    }
}
// =============== ŸÜŸáÿßŸäÿ© ŸÉŸàÿØ ÿßŸÑÿ≤ÿ± ===============
// ... ÿ®ÿßŸÇŸä ÿ≥ŸÉÿ±ÿ®ÿ™ŸÉ ŸÉŸÖÿß ŸáŸä ...
</script>
</body>
</html>
