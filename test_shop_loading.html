<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Test Shop Loading</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>اختبار تحميل المحلات</h1>
    <div id="results"></div>
    
    <script>
    let shopsDetails = null; // Global variable like in smart-planner.html
    
    async function testShopLoading() {
        const results = document.getElementById('results');
        
        // Test 1: Load from local file (simulating non-logged-in state)
        results.innerHTML += '<h2>Test 1: Loading from local file</h2>';
        let currentShopsDetails = shopsDetails || {};
        
        if (!shopsDetails || Object.keys(shopsDetails).length === 0) {
            try {
                const response = await fetch('shops_details.json?' + new Date().getTime());
                if (response.ok) {
                    currentShopsDetails = await response.json();
                    results.innerHTML += `<p class="success">✓ Loaded ${Object.keys(currentShopsDetails).length} shops from local file</p>`;
                } else {
                    results.innerHTML += `<p class="error">✗ Failed to load from local file</p>`;
                }
            } catch (error) {
                results.innerHTML += `<p class="error">✗ Error: ${error.message}</p>`;
            }
        }
        
        // Test 2: Simulate global variable being set
        results.innerHTML += '<h2>Test 2: Using global shopsDetails variable</h2>';
        shopsDetails = currentShopsDetails; // Set the global
        
        // Now test the logic again
        let testShopsDetails = shopsDetails || {};
        if (!shopsDetails || Object.keys(shopsDetails).length === 0) {
            results.innerHTML += `<p class="error">✗ Global variable not being used</p>`;
        } else {
            results.innerHTML += `<p class="success">✓ Using global variable with ${Object.keys(testShopsDetails).length} shops</p>`;
        }
        
        // Test 3: Show sample shops
        results.innerHTML += '<h2>Sample shops:</h2><ul>';
        let count = 0;
        for (const [shopName, shopInfo] of Object.entries(currentShopsDetails)) {
            if (count < 10) {
                results.innerHTML += `<li>${shopInfo.nameAr || shopName} - ${shopInfo.area || 'No area'}</li>`;
                count++;
            }
        }
        results.innerHTML += '</ul>';
    }
    
    testShopLoading();
    </script>
</body>
</html>
