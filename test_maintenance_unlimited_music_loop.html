<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸµ Ø§Ø®ØªØ¨Ø§Ø± Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„ØµÙŠØ§Ù†Ø© - Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ…Ø± Ù…Ø¹ Loop</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .test-container {
            background: white;
            border-radius: 15px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
        }
        
        .info {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .info p {
            margin: 10px 0;
            color: #333;
            line-height: 1.6;
        }
        
        .success {
            background: #d4edda;
            border-left-color: #28a745;
            color: #155724;
        }
        
        .warning {
            background: #fff3cd;
            border-left-color: #ffc107;
            color: #856404;
        }
        
        .error {
            background: #f8d7da;
            border-left-color: #dc3545;
            color: #721c24;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        button {
            padding: 15px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn-play {
            background: #28a745;
            color: white;
        }
        
        .btn-pause {
            background: #ffc107;
            color: #333;
        }
        
        .btn-stop {
            background: #dc3545;
            color: white;
        }
        
        .btn-check {
            background: #17a2b8;
            color: white;
        }
        
        .status {
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            font-size: 1.1em;
            text-align: center;
        }
        
        .config-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .config-table th,
        .config-table td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid #ddd;
        }
        
        .config-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }
        
        .config-table tr:hover {
            background: #f8f9fa;
        }
        
        .check-icon {
            color: #28a745;
            font-size: 1.3em;
        }
        
        .cross-icon {
            color: #dc3545;
            font-size: 1.3em;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745 0%, #20c997 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸµ Ø§Ø®ØªØ¨Ø§Ø± Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„ØµÙŠØ§Ù†Ø© - Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ…Ø±</h1>
        
        <div class="info">
            <p><strong>Ø§Ù„Ù‡Ø¯Ù Ù…Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</strong></p>
            <p>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰:</p>
            <ul style="margin-right: 20px; margin-top: 10px;">
                <li>âœ… ØªØ¨Ø¯Ø£ Ø§Ù„ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</li>
                <li>âœ… ØªØ³ØªÙ…Ø± ÙÙŠ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¨Ø´ÙƒÙ„ Ù…ØªÙƒØ±Ø± (loop)</li>
                <li>âœ… Ù„Ø§ ØªØªÙˆÙ‚Ù Ø£Ø¨Ø¯Ø§Ù‹ (duration = 0)</li>
                <li>âœ… ØªØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª</li>
            </ul>
        </div>
        
        <div class="controls">
            <button class="btn-play" onclick="playMusic()">â–¶ï¸ ØªØ´ØºÙŠÙ„</button>
            <button class="btn-pause" onclick="pauseMusic()">â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª</button>
            <button class="btn-stop" onclick="stopMusic()">â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù</button>
            <button class="btn-check" onclick="checkStatus()">ğŸ” ÙØ­Øµ Ø§Ù„Ø­Ø§Ù„Ø©</button>
        </div>
        
        <div id="status" class="status" style="display: none;"></div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar" style="width: 0%;">0%</div>
        </div>
        
        <h2 style="color: #667eea; margin-top: 30px;">ğŸ“Š Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
        <table class="config-table">
            <thead>
                <tr>
                    <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
                    <th>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯</th>
                </tr>
            </thead>
            <tbody id="configBody">
            </tbody>
        </table>
        
        <div class="info warning">
            <p><strong>âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø©:</strong></p>
            <ul style="margin-right: 20px; margin-top: 10px;">
                <li>Ø¥Ø°Ø§ Ù„Ù… ÙŠØ¨Ø¯Ø£ Ø§Ù„ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŒ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„</li>
                <li>Ø¨Ø¹Ø¶ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª ØªÙ…Ù†Ø¹ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø­ØªÙ‰ ÙŠØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¹ Ø§Ù„ØµÙØ­Ø©</li>
                <li>Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ ÙŠØ¬Ø¨ Ø£Ù† ØªØ¹ÙˆØ¯ Ù„Ù„Ø¨Ø¯Ø§ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ (loop)</li>
                <li>Ø´Ø§Ù‡Ø¯ Console Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªÙØµÙŠÙ„ÙŠØ©</li>
            </ul>
        </div>
    </div>
    
    <!-- Audio Element with Loop -->
    <audio id="maintenanceAudio" preload="metadata" playsinline webkit-playsinline style="display:none;" loop crossorigin="anonymous">
        <source src="music.mp3" type="audio/mpeg">
        <source src="music.mp3" type="audio/mp3">
        Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØµÙˆØªÙŠØ©.
    </audio>
    
    <script>
        const audio = document.getElementById('maintenanceAudio');
        const statusDiv = document.getElementById('status');
        const configBody = document.getElementById('configBody');
        const progressBar = document.getElementById('progressBar');
        
        // Maintenance configuration (same as index.html)
        let maintenanceConfig = {
            checkInterval: 10000,
            musicEnabled: true,
            musicDuration: 0, // 0 = unlimited
            musicVolume: 0.15
        };
        
        let maintenanceMusicTimer = null;
        
        // Display configuration
        function displayConfig() {
            configBody.innerHTML = `
                <tr>
                    <td><span class="${audio.loop ? 'check-icon' : 'cross-icon'}">${audio.loop ? 'âœ… Ù…ÙØ¹Ù‘Ù„' : 'âŒ Ù…Ø¹Ø·Ù‘Ù„'}</span></td>
                    <td>Ø§Ù„ØªÙƒØ±Ø§Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (Loop)</td>
                </tr>
                <tr>
                    <td><span class="check-icon">âœ… ${Math.round(maintenanceConfig.musicVolume * 100)}%</span></td>
                    <td>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª</td>
                </tr>
                <tr>
                    <td><span class="check-icon">âœ… ${maintenanceConfig.musicDuration === 0 ? 'ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯' : maintenanceConfig.musicDuration/1000 + ' Ø«Ø§Ù†ÙŠØ©'}</span></td>
                    <td>Ù…Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„</td>
                </tr>
                <tr>
                    <td><span class="${maintenanceConfig.musicEnabled ? 'check-icon' : 'cross-icon'}">${maintenanceConfig.musicEnabled ? 'âœ… Ù…ÙØ¹Ù‘Ù„' : 'âŒ Ù…Ø¹Ø·Ù‘Ù„'}</span></td>
                    <td>Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰</td>
                </tr>
                <tr>
                    <td>${audio.readyState >= 2 ? 'âœ… Ø¬Ø§Ù‡Ø²' : 'â³ ÙŠØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„...'}</td>
                    <td>Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„</td>
                </tr>
            `;
        }
        
        // Show status message
        function showStatus(message, type = 'success') {
            statusDiv.style.display = 'block';
            statusDiv.className = `status info ${type}`;
            statusDiv.innerHTML = message;
        }
        
        // Update progress bar
        function updateProgress() {
            if (!audio.paused && audio.duration) {
                const percent = (audio.currentTime / audio.duration) * 100;
                progressBar.style.width = percent + '%';
                progressBar.textContent = Math.round(percent) + '%';
            }
        }
        
        // Play music function (same as index.html)
        function playMusic() {
            console.log('ğŸµ Starting maintenance music...');
            
            if (!maintenanceConfig.musicEnabled) {
                showStatus('âš ï¸ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ù…Ø¹Ø·Ù„Ø© ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', 'warning');
                return;
            }
            
            // Safari-specific: Load audio data first
            if (audio.readyState < 2) {
                audio.load();
            }
            
            // Enable loop for continuous playback
            audio.loop = true;
            
            // Reset audio to start from beginning
            audio.currentTime = 0;
            audio.volume = maintenanceConfig.musicVolume;
            
            // Clear any existing timer
            if (maintenanceMusicTimer) {
                clearTimeout(maintenanceMusicTimer);
                maintenanceMusicTimer = null;
            }
            
            const duration = maintenanceConfig.musicDuration;
            
            // Level 1: Try direct play
            const playPromise = audio.play();
            
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    console.log(`âœ… Music started (Level 1: Direct play) - Volume: ${Math.round(maintenanceConfig.musicVolume * 100)}%`);
                    showStatus(`âœ… Ø¨Ø¯Ø£ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø¨Ù†Ø¬Ø§Ø­<br>Ø§Ù„ØªÙƒØ±Ø§Ø±: ${audio.loop ? 'Ù…ÙØ¹Ù‘Ù„' : 'Ù…Ø¹Ø·Ù‘Ù„'}<br>Ø§Ù„Ù…Ø¯Ø©: ${duration === 0 ? 'ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯Ø©' : duration/1000 + ' Ø«Ø§Ù†ÙŠØ©'}`, 'success');
                    
                    if (duration > 0) {
                        maintenanceMusicTimer = setTimeout(() => {
                            audio.pause();
                            audio.currentTime = 0;
                            console.log(`ğŸµ Music stopped after ${duration}ms`);
                            showStatus('â¹ï¸ ØªÙˆÙ‚ÙØª Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©', 'warning');
                        }, duration);
                    } else {
                        console.log('ğŸµ Music set to play continuously (unlimited duration with loop)');
                    }
                    
                    displayConfig();
                }).catch(err => {
                    console.log('âš ï¸ Level 1 failed, trying Level 2: Muted start');
                    
                    // Level 2: Start muted then unmute
                    audio.muted = true;
                    const mutedPromise = audio.play();
                    
                    if (mutedPromise !== undefined) {
                        mutedPromise.then(() => {
                            setTimeout(() => {
                                audio.muted = false;
                                audio.volume = maintenanceConfig.musicVolume;
                                console.log(`âœ… Music started (Level 2: Unmuted after start)`);
                                showStatus('âœ… Ø¨Ø¯Ø£ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ (Level 2: Ø¨Ø¹Ø¯ Ø¥Ø²Ø§Ù„Ø© ÙƒØªÙ… Ø§Ù„ØµÙˆØª)', 'success');
                                displayConfig();
                            }, 100);
                        }).catch(err2 => {
                            console.log('âŒ Level 2 failed:', err2);
                            showStatus('âŒ ÙØ´Ù„ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„ØµÙØ­Ø©', 'error');
                            setupUserInteractionPlayback();
                        });
                    }
                });
            }
        }
        
        // Setup user interaction playback
        function setupUserInteractionPlayback() {
            const playOnInteraction = () => {
                audio.loop = true;
                audio.muted = false;
                audio.volume = maintenanceConfig.musicVolume;
                audio.currentTime = 0;
                audio.play().then(() => {
                    console.log('âœ… Music started after user interaction');
                    showStatus('âœ… Ø¨Ø¯Ø£ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„ØµÙØ­Ø©', 'success');
                    displayConfig();
                }).catch(err => {
                    console.error('âŒ Failed to play:', err);
                    showStatus('âŒ ÙØ´Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰: ' + err.message, 'error');
                });
                
                document.removeEventListener('click', playOnInteraction);
                document.removeEventListener('touchstart', playOnInteraction);
            };
            
            document.addEventListener('click', playOnInteraction);
            document.addEventListener('touchstart', playOnInteraction);
        }
        
        // Pause music
        function pauseMusic() {
            audio.pause();
            showStatus('â¸ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ù…Ø¤Ù‚ØªØ§Ù‹', 'warning');
            console.log('â¸ï¸ Music paused');
        }
        
        // Stop music
        function stopMusic() {
            audio.pause();
            audio.currentTime = 0;
            if (maintenanceMusicTimer) {
                clearTimeout(maintenanceMusicTimer);
                maintenanceMusicTimer = null;
            }
            showStatus('â¹ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰', 'warning');
            console.log('â¹ï¸ Music stopped');
        }
        
        // Check status
        function checkStatus() {
            const isPaused = audio.paused;
            const currentTime = audio.currentTime.toFixed(2);
            const duration = audio.duration.toFixed(2);
            
            let statusMsg = `
                <strong>Ø­Ø§Ù„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„:</strong> ${isPaused ? 'Ù…ØªÙˆÙ‚Ù â¸ï¸' : 'ÙŠØ¹Ù…Ù„ â–¶ï¸'}<br>
                <strong>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ:</strong> ${currentTime} Ø«Ø§Ù†ÙŠØ©<br>
                <strong>Ù…Ø¯Ø© Ø§Ù„Ù…Ù„Ù:</strong> ${duration} Ø«Ø§Ù†ÙŠØ©<br>
                <strong>Ø§Ù„ØªÙƒØ±Ø§Ø± (Loop):</strong> ${audio.loop ? 'Ù…ÙØ¹Ù‘Ù„ âœ…' : 'Ù…Ø¹Ø·Ù‘Ù„ âŒ'}<br>
                <strong>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª:</strong> ${Math.round(audio.volume * 100)}%
            `;
            
            showStatus(statusMsg, isPaused ? 'warning' : 'success');
            displayConfig();
            
            console.log('ğŸ” Status check:', {
                paused: isPaused,
                currentTime: currentTime,
                duration: duration,
                loop: audio.loop,
                volume: audio.volume
            });
        }
        
        // Audio event listeners
        audio.addEventListener('play', () => {
            console.log('ğŸµ Audio play event');
        });
        
        audio.addEventListener('pause', () => {
            console.log('â¸ï¸ Audio pause event');
        });
        
        audio.addEventListener('ended', () => {
            console.log('ğŸ”š Audio ended event (should not happen with loop!)');
            if (audio.loop) {
                console.error('âš ï¸ Audio ended despite loop being enabled!');
                showStatus('âš ï¸ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ù…Ù„Ù Ø§Ù„ØµÙˆØªÙŠ Ø±ØºÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙƒØ±Ø§Ø±!', 'error');
            }
        });
        
        audio.addEventListener('error', (e) => {
            console.error('âŒ Audio error:', e);
            showStatus('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„ØµÙˆØªÙŠ', 'error');
        });
        
        audio.addEventListener('loadedmetadata', () => {
            console.log('âœ… Audio metadata loaded');
            displayConfig();
        });
        
        // Update progress bar continuously
        setInterval(updateProgress, 100);
        
        // Initial display
        displayConfig();
        
        // Try to play automatically after a short delay
        setTimeout(() => {
            console.log('ğŸ¬ Attempting automatic playback...');
            playMusic();
        }, 1000);
    </script>
</body>
</html>
