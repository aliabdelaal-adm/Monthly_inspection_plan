<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Areas Management Features</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #007bff;
            color: white;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>ðŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ù…ÙŠØ²Ø§Øª Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</h1>
    
    <div class="test-section">
        <h2>1. Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h2>
        <button onclick="testBasicFunctions()">ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
        <div id="basic-results"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Ø§Ø®ØªØ¨Ø§Ø± Ø¯Ù…Ø¬ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</h2>
        <button onclick="testMergeAreas()">ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
        <div id="merge-results"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Ø§Ø®ØªØ¨Ø§Ø± ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø­Ù„Ø§Øª</h2>
        <button onclick="testAssignShops()">ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
        <div id="assign-results"></div>
    </div>
    
    <div class="test-section">
        <h2>4. Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ</h2>
        <button onclick="testBulkEdit()">ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
        <div id="bulk-results"></div>
    </div>

    <script>
        // Mock plan data for testing
        let planData = {
            areas: [
                { id: 'area1', name: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø§Ù„Ø¯ÙŠØ©' },
                { id: 'area2', name: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø§Ù…Ø®Ø©' },
                { id: 'area3', name: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ø§Ù‡ÙŠØ©' }
            ],
            shops: [
                { id: 'shop1', name: 'Ù…Ø­Ù„ Ø§Ù„Ø·ÙŠÙˆØ±', areaId: 'area1' },
                { id: 'shop2', name: 'Ù…Ø­Ù„ Ø§Ù„Ø£Ø³Ù…Ø§Ùƒ', areaId: 'area1' },
                { id: 'shop3', name: 'Ù…Ø­Ù„ Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª', areaId: 'area2' },
                { id: 'shop4', name: 'Ø¹ÙŠØ§Ø¯Ø© Ø¨ÙŠØ·Ø±ÙŠØ©', areaId: 'area3' }
            ],
            inspectionData: [
                { inspector: 'Ø¯. Ø£Ø­Ù…Ø¯', area: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø§Ù„Ø¯ÙŠØ©', shops: ['Ù…Ø­Ù„ Ø§Ù„Ø·ÙŠÙˆØ±'] },
                { inspector: 'Ø¯. Ù…Ø­Ù…Ø¯', area: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø§Ù…Ø®Ø©', shops: ['Ù…Ø­Ù„ Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª'] }
            ]
        };

        function showResult(containerId, message, isSuccess) {
            const container = document.getElementById(containerId);
            const resultDiv = document.createElement('div');
            resultDiv.className = 'test-result ' + (isSuccess ? 'success' : 'error');
            resultDiv.textContent = message;
            container.appendChild(resultDiv);
        }

        function testBasicFunctions() {
            const container = document.getElementById('basic-results');
            container.innerHTML = '';
            
            // Test 1: Data structure
            try {
                if (planData && planData.areas && planData.shops) {
                    showResult('basic-results', 'âœ… Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­', true);
                } else {
                    showResult('basic-results', 'âŒ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­', false);
                }
            } catch (e) {
                showResult('basic-results', 'âŒ Ø®Ø·Ø£ ÙÙŠ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + e.message, false);
            }
            
            // Test 2: Areas count
            try {
                const areasCount = planData.areas.length;
                showResult('basic-results', `âœ… Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚: ${areasCount}`, true);
            } catch (e) {
                showResult('basic-results', 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚: ' + e.message, false);
            }
            
            // Test 3: Shops count
            try {
                const shopsCount = planData.shops.length;
                showResult('basic-results', `âœ… Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ù„Ø§Øª: ${shopsCount}`, true);
            } catch (e) {
                showResult('basic-results', 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø­Ù„Ø§Øª: ' + e.message, false);
            }
        }

        function testMergeAreas() {
            const container = document.getElementById('merge-results');
            container.innerHTML = '';
            
            try {
                // Simulate merge: area2 and area3 into area1
                const targetAreaId = 'area1';
                const sourceAreaIds = ['area2', 'area3'];
                
                // Move shops
                let movedCount = 0;
                planData.shops.forEach(shop => {
                    if (sourceAreaIds.includes(shop.areaId)) {
                        shop.areaId = targetAreaId;
                        movedCount++;
                    }
                });
                
                showResult('merge-results', `âœ… ØªÙ… Ù†Ù‚Ù„ ${movedCount} Ù…Ø­Ù„`, true);
                
                // Update inspections
                const targetArea = planData.areas.find(a => a.id === targetAreaId);
                let updatedInspections = 0;
                planData.inspectionData.forEach(inspection => {
                    if (inspection.area === 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø§Ù…Ø®Ø©' || inspection.area === 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ø§Ù‡ÙŠØ©') {
                        inspection.area = targetArea.name;
                        updatedInspections++;
                    }
                });
                
                showResult('merge-results', `âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ${updatedInspections} ØªÙØªÙŠØ´`, true);
                
                // Remove merged areas
                const beforeCount = planData.areas.length;
                planData.areas = planData.areas.filter(a => !sourceAreaIds.includes(a.id));
                const afterCount = planData.areas.length;
                
                showResult('merge-results', `âœ… ØªÙ… Ø­Ø°Ù ${beforeCount - afterCount} Ù…Ù†Ø·Ù‚Ø©`, true);
                showResult('merge-results', 'âœ… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯Ù…Ø¬ Ù†Ø¬Ø­Øª Ø¨Ø§Ù„ÙƒØ§Ù…Ù„', true);
                
            } catch (e) {
                showResult('merge-results', 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯Ù…Ø¬: ' + e.message, false);
            }
        }

        function testAssignShops() {
            const container = document.getElementById('assign-results');
            container.innerHTML = '';
            
            try {
                // Restore test data
                planData.areas = [
                    { id: 'area1', name: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø§Ù„Ø¯ÙŠØ©' },
                    { id: 'area2', name: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø§Ù…Ø®Ø©' }
                ];
                planData.shops = [
                    { id: 'shop1', name: 'Ù…Ø­Ù„ Ø§Ù„Ø·ÙŠÙˆØ±', areaId: 'area1' },
                    { id: 'shop2', name: 'Ù…Ø­Ù„ Ø§Ù„Ø£Ø³Ù…Ø§Ùƒ', areaId: 'area1' }
                ];
                
                // Simulate assign: move shop1 to area2
                const shopId = 'shop1';
                const targetAreaId = 'area2';
                
                const shop = planData.shops.find(s => s.id === shopId);
                if (shop) {
                    const oldAreaId = shop.areaId;
                    shop.areaId = targetAreaId;
                    showResult('assign-results', `âœ… ØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ù…Ø­Ù„ Ù…Ù† ${oldAreaId} Ø¥Ù„Ù‰ ${targetAreaId}`, true);
                } else {
                    showResult('assign-results', 'âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­Ù„', false);
                }
                
                // Verify the change
                const updatedShop = planData.shops.find(s => s.id === shopId);
                if (updatedShop && updatedShop.areaId === targetAreaId) {
                    showResult('assign-results', 'âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØºÙŠÙŠØ± Ø¨Ù†Ø¬Ø§Ø­', true);
                } else {
                    showResult('assign-results', 'âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØºÙŠÙŠØ±', false);
                }
                
            } catch (e) {
                showResult('assign-results', 'âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø­Ù„Ø§Øª: ' + e.message, false);
            }
        }

        function testBulkEdit() {
            const container = document.getElementById('bulk-results');
            container.innerHTML = '';
            
            try {
                // Restore test data
                planData.areas = [
                    { id: 'area1', name: 'Ø§Ù„Ø®Ø§Ù„Ø¯ÙŠØ©' },
                    { id: 'area2', name: 'Ø§Ù„Ø´Ø§Ù…Ø®Ø©' }
                ];
                
                // Test 1: Add prefix
                const prefix = 'Ù…Ù†Ø·Ù‚Ø©';
                planData.areas.forEach(area => {
                    area.name = prefix + ' ' + area.name;
                });
                showResult('bulk-results', `âœ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ø¯Ø¦Ø© "${prefix}" Ù†Ø¬Ø­Øª`, true);
                showResult('bulk-results', `Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: ${planData.areas.map(a => a.name).join('ØŒ ')}`, true);
                
                // Test 2: Replace text
                planData.areas.forEach(area => {
                    area.name = area.name.replace('Ù…Ù†Ø·Ù‚Ø©', 'Ø­ÙŠ');
                });
                showResult('bulk-results', 'âœ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù†Øµ Ù†Ø¬Ø­', true);
                showResult('bulk-results', `Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„: ${planData.areas.map(a => a.name).join('ØŒ ')}`, true);
                
                // Test 3: Add suffix
                const suffix = 'Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©';
                planData.areas.forEach(area => {
                    area.name = area.name + ' ' + suffix;
                });
                showResult('bulk-results', `âœ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„Ø§Ø­Ù‚Ø© "${suffix}" Ù†Ø¬Ø­Øª`, true);
                showResult('bulk-results', `Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: ${planData.areas.map(a => a.name).join('ØŒ ')}`, true);
                
            } catch (e) {
                showResult('bulk-results', 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ: ' + e.message, false);
            }
        }

        // Auto-run basic tests on page load
        window.onload = function() {
            console.log('Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©...');
            setTimeout(() => {
                testBasicFunctions();
            }, 500);
        };
    </script>
</body>
</html>
