<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اختبار أولوية المحلات من 15 الشهر</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #2d3561;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .test-section h2 {
            color: #2d3561;
            margin-bottom: 15px;
            font-size: 1.5em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .date-selector {
            margin-bottom: 20px;
        }

        .date-selector label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #2d3561;
        }

        .date-selector input {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            font-family: 'Cairo', Arial, sans-serif;
            width: 100%;
            max-width: 300px;
        }

        .shops-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .shop-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            position: relative;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .shop-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .shop-card.very-high-priority {
            border-left: 5px solid #8b0000;
            background: linear-gradient(135deg, #fff5f5 0%, #ffe0e0 100%);
        }

        .shop-card.high-priority {
            border-left: 5px solid #dc3545;
        }

        .shop-card.medium-priority {
            border-left: 5px solid #ffc107;
        }

        .shop-card.low-priority {
            border-left: 5px solid #28a745;
        }

        .priority-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .priority-badge.very-high {
            background: #8b0000;
            color: white;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .priority-badge.high {
            background: #dc3545;
            color: white;
        }

        .priority-badge.medium {
            background: #ffc107;
            color: #212529;
        }

        .priority-badge.low {
            background: #28a745;
            color: white;
        }

        .shop-name {
            font-weight: 600;
            color: #2d3561;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .shop-info {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .info-box h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .info-box ul {
            list-style-position: inside;
            color: #555;
        }

        .info-box li {
            margin-bottom: 5px;
        }

        .legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 5px;
        }

        .legend-color.very-high {
            background: #8b0000;
        }

        .legend-color.high {
            background: #dc3545;
        }

        .legend-color.medium {
            background: #ffc107;
        }

        .legend-color.low {
            background: #28a745;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎯 اختبار نظام الأولويات من 15 الشهر</h1>
        <p class="subtitle">نظام ذكي يعطي أولوية عالية جداً للمحلات من 15 كل شهر</p>

        <div class="info-box">
            <h3>📋 كيف يعمل النظام:</h3>
            <ul>
                <li>من <strong>1-14 من الشهر</strong>: النظام المرن العادي (عالي، متوسط، منخفض)</li>
                <li>من <strong>15-نهاية الشهر</strong>: يتم تعزيز المحلات ذات الأولوية العالية إلى <strong>"أولوية عالية جداً"</strong></li>
                <li>المحلات التي لم يتم تفتيشها أبداً تحصل على أولوية عالية جداً من 15 الشهر</li>
                <li>المحلات التي مر على آخر تفتيش لها أكثر من 30 يوم تحصل على أولوية عالية جداً من 15 الشهر</li>
                <li>في بداية الشهر الجديد، تعود الدورة الذكية من جديد</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>🔍 اختبر التاريخ</h2>
            <div class="date-selector">
                <label for="testDate">اختر تاريخ للاختبار:</label>
                <input type="date" id="testDate" onchange="updateShops()">
            </div>
            <div id="dateInfo" style="color: #666; margin-top: 10px; font-weight: 600;"></div>
        </div>

        <div class="test-section">
            <h2>📊 أمثلة على المحلات</h2>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color very-high"></div>
                    <span>أولوية عالية جداً</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color high"></div>
                    <span>أولوية عالية</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color medium"></div>
                    <span>أولوية متوسطة</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color low"></div>
                    <span>أولوية منخفضة</span>
                </div>
            </div>
            <div class="shops-grid" id="shopsContainer"></div>
        </div>
    </div>

    <script>
        // Sample shops data
        const testShops = [
            { name: 'محل لم يتم تفتيشه', lastInspection: null, hasSpecialActivity: false },
            { name: 'محل آخر تفتيش 35 يوم', lastInspection: -35, hasSpecialActivity: false },
            { name: 'محل آخر تفتيش 25 يوم', lastInspection: -25, hasSpecialActivity: false },
            { name: 'محل آخر تفتيش 18 يوم', lastInspection: -18, hasSpecialActivity: false },
            { name: 'محل آخر تفتيش 10 أيام', lastInspection: -10, hasSpecialActivity: false },
            { name: 'محل خاص (يجب تسجيله) - لم يتم تفتيشه', lastInspection: null, hasSpecialActivity: true },
        ];

        function calculateShopPriority(shop, date) {
            let score = 0;
            let reasons = [];

            if (shop.lastInspection === null) {
                score += 100;
                reasons.push('لم يتم تفتيشه من قبل');
            } else {
                const daysSince = Math.abs(shop.lastInspection);
                
                if (daysSince > 30) {
                    score += 80;
                    reasons.push(`آخر تفتيش قبل ${daysSince} يوم`);
                } else if (daysSince > 21) {
                    score += 60;
                    reasons.push(`آخر تفتيش قبل ${daysSince} يوم`);
                } else if (daysSince > 14) {
                    score += 40;
                    reasons.push(`آخر تفتيش قبل ${daysSince} يوم`);
                } else {
                    score += 20;
                    reasons.push(`آخر تفتيش قبل ${daysSince} يوم`);
                }
            }

            if (shop.hasSpecialActivity) {
                score += 30;
                reasons.push('نشاط يتطلب التسجيل');
            }

            // Check if we're in the second half of the month (from 15th onwards)
            const dayOfMonth = date.getDate();
            if (dayOfMonth >= 15) {
                if (score >= 80) {
                    score += 50;
                    reasons.push('أولوية النصف الثاني من الشهر');
                } else if (score >= 50) {
                    score += 20;
                }
            }

            // Determine priority level
            let level = 'low';
            if (score >= 130) level = 'very-high';
            else if (score >= 80) level = 'high';
            else if (score >= 50) level = 'medium';

            return { level, score, reason: reasons.join(' - ') };
        }

        function updateShops() {
            const dateInput = document.getElementById('testDate');
            const selectedDate = dateInput.value ? new Date(dateInput.value) : new Date();
            
            // Update date info
            const dayOfMonth = selectedDate.getDate();
            const dateInfo = document.getElementById('dateInfo');
            
            if (dayOfMonth >= 15) {
                dateInfo.innerHTML = `📅 التاريخ: ${selectedDate.toLocaleDateString('ar-EG')} - 
                    <span style="color: #8b0000; font-weight: bold;">النصف الثاني من الشهر (تفعيل الأولوية العالية جداً)</span>`;
            } else {
                dateInfo.innerHTML = `📅 التاريخ: ${selectedDate.toLocaleDateString('ar-EG')} - 
                    <span style="color: #2196f3;">النصف الأول من الشهر (النظام المرن العادي)</span>`;
            }

            // Update shops
            const container = document.getElementById('shopsContainer');
            container.innerHTML = '';

            testShops.forEach(shop => {
                const priority = calculateShopPriority(shop, selectedDate);
                
                const shopCard = document.createElement('div');
                shopCard.className = `shop-card ${priority.level}-priority`;
                
                const priorityText = priority.level === 'very-high' ? 'أولوية عالية جداً' :
                                   priority.level === 'high' ? 'أولوية عالية' :
                                   priority.level === 'medium' ? 'أولوية متوسطة' : 'أولوية منخفضة';
                
                shopCard.innerHTML = `
                    <div class="priority-badge ${priority.level}">${priorityText}</div>
                    <div class="shop-name">${shop.name}</div>
                    <div class="shop-info">📊 النقاط: <strong>${priority.score}</strong></div>
                    <div class="shop-info">📝 ${priority.reason}</div>
                `;
                
                container.appendChild(shopCard);
            });
        }

        // Initialize with today's date
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            document.getElementById('testDate').valueAsDate = today;
            updateShops();
        });
    </script>
</body>
</html>
