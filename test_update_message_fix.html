<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اختبار إصلاح رسالة "جاري التحديث"</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            direction: rtl;
            text-align: right;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
        }
        
        .section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #667eea;
        }
        
        .section h2 {
            color: #667eea;
            margin-top: 0;
            font-size: 1.4em;
        }
        
        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            margin: 10px 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .test-button.success {
            background: #28a745;
        }
        
        .test-button.warning {
            background: #ffc107;
            color: #000;
        }
        
        .test-button.danger {
            background: #dc3545;
        }
        
        .log-container {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #667eea;
            padding-left: 10px;
        }
        
        .log-entry.success {
            border-left-color: #28a745;
            color: #4dff88;
        }
        
        .log-entry.error {
            border-left-color: #dc3545;
            color: #ff6b6b;
        }
        
        .log-entry.warning {
            border-left-color: #ffc107;
            color: #ffd93d;
        }
        
        .log-entry.info {
            border-left-color: #17a2b8;
            color: #6bcfff;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 10px;
        }
        
        .status-indicator.active {
            background: #28a745;
            box-shadow: 0 0 10px #28a745;
        }
        
        .status-indicator.inactive {
            background: #dc3545;
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
        }
        
        .feature-list li {
            padding: 10px;
            margin: 8px 0;
            background: white;
            border-radius: 6px;
            border-right: 4px solid #28a745;
        }
        
        .feature-list li:before {
            content: "✅ ";
            font-size: 1.2em;
            margin-left: 10px;
        }
        
        @keyframes slideDown {
            from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateX(-50%) translateY(0); opacity: 1; }
            to { transform: translateX(-50%) translateY(-100%); opacity: 0; }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .maintenance-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 0.8s linear infinite;
            flex-shrink: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔧 اختبار إصلاح رسالة "جاري التحديث"</h1>
        
        <div class="section">
            <h2>📋 ملخص الإصلاح</h2>
            <ul class="feature-list">
                <li>إضافة رسالة "جاري التحديث" فورية لجميع المستخدمين</li>
                <li>الرسالة تظهر قبل شاشة الصيانة الكاملة</li>
                <li>مدة العرض: 2.5 ثانية</li>
                <li>تظهر تلقائياً عند تفعيل الصيانة من GitHub</li>
                <li>تستخدم sessionStorage لتتبع العرض</li>
                <li>زيادة سرعة الفحص إلى 60 ثانية (بدلاً من 30)</li>
                <li>الفحص كل 5 ثوانٍ في أول دقيقة</li>
            </ul>
        </div>
        
        <div class="section">
            <h2>🧪 اختبارات تفاعلية</h2>
            <p>استخدم الأزرار أدناه لاختبار وظيفة رسالة "جاري التحديث":</p>
            
            <button class="test-button warning" onclick="testShowUpdateMessage()">
                🔄 اختبار رسالة "جاري التحديث"
            </button>
            
            <button class="test-button success" onclick="testMaintenanceActivation()">
                🔐 محاكاة تفعيل الصيانة
            </button>
            
            <button class="test-button danger" onclick="testMaintenanceDeactivation()">
                🔓 محاكاة إلغاء الصيانة
            </button>
            
            <button class="test-button" onclick="testSessionStorage()">
                💾 اختبار SessionStorage
            </button>
            
            <button class="test-button" onclick="clearLogs()">
                🗑️ مسح السجل
            </button>
        </div>
        
        <div class="section">
            <h2>📊 حالة النظام</h2>
            <p>
                <strong>حالة الصيانة:</strong>
                <span id="maintenanceStatus">غير نشط</span>
                <span class="status-indicator inactive" id="statusIndicator"></span>
            </p>
            <p>
                <strong>تم عرض الإشعار:</strong>
                <span id="notificationShown">لا</span>
            </p>
            <p>
                <strong>عدد الفحوصات:</strong>
                <span id="checkCount">0</span>
            </p>
        </div>
        
        <div class="section">
            <h2>📝 سجل الأحداث</h2>
            <div class="log-container" id="logContainer">
                <div class="log-entry info">⏳ في انتظار الاختبارات...</div>
            </div>
        </div>
        
        <div class="section">
            <h2>✅ معايير النجاح</h2>
            <ul class="feature-list">
                <li>رسالة "جاري التحديث" تظهر لجميع المستخدمين (ليس فقط المطورين)</li>
                <li>الرسالة تظهر قبل شاشة الصيانة الكاملة بـ 2.5 ثانية</li>
                <li>الرسالة لا تظهر مرتين لنفس جلسة المستخدم</li>
                <li>الرسالة تختفي تلقائياً بعد العرض</li>
                <li>النظام يفحص الحالة كل 5 ثوانٍ لأول 60 ثانية</li>
                <li>بعد 60 ثانية، يفحص كل 10 ثوانٍ</li>
            </ul>
        </div>
    </div>
    
    <script>
        let checkCount = 0;
        
        function log(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString('ar-EG');
            entry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        function clearLogs() {
            const logContainer = document.getElementById('logContainer');
            logContainer.innerHTML = '<div class="log-entry info">⏳ تم مسح السجل...</div>';
            log('🗑️ تم مسح سجل الأحداث', 'info');
        }
        
        function updateStatus() {
            const maintenanceActive = localStorage.getItem('systemMaintenanceMode') === 'true';
            const notificationShown = sessionStorage.getItem('maintenanceNotificationShown') === 'true';
            
            document.getElementById('maintenanceStatus').textContent = maintenanceActive ? 'نشط' : 'غير نشط';
            document.getElementById('statusIndicator').className = 
                'status-indicator ' + (maintenanceActive ? 'active' : 'inactive');
            document.getElementById('notificationShown').textContent = notificationShown ? 'نعم' : 'لا';
            document.getElementById('checkCount').textContent = checkCount;
        }
        
        function showMaintenanceProgress(message, type = 'loading') {
            // Remove existing message
            const existing = document.getElementById('maintenanceProgressMsg');
            if (existing) {
                existing.remove();
            }
            
            // Create new message
            const messageDiv = document.createElement('div');
            messageDiv.id = 'maintenanceProgressMsg';
            
            // Choose color
            let bgColor = '#ffc107';
            if (type === 'success') bgColor = '#28a745';
            if (type === 'error') bgColor = '#dc3545';
            if (type === 'info') bgColor = '#17a2b8';
            if (type === 'warning') bgColor = '#ff9800';
            
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${bgColor};
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                z-index: 10000;
                font-size: 16px;
                font-weight: bold;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                text-align: center;
                min-width: 300px;
                max-width: 600px;
                white-space: pre-line;
                animation: slideDown 0.3s ease-out;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
            `;
            
            if (type === 'loading') {
                const spinner = document.createElement('div');
                spinner.className = 'maintenance-spinner';
                messageDiv.appendChild(spinner);
            }
            
            const textSpan = document.createElement('span');
            textSpan.textContent = message;
            messageDiv.appendChild(textSpan);
            
            document.body.appendChild(messageDiv);
            
            log(`📢 عرض رسالة: ${message}`, type);
        }
        
        function hideMaintenanceProgress() {
            const existing = document.getElementById('maintenanceProgressMsg');
            if (existing) {
                existing.style.animation = 'slideUp 0.3s ease-in';
                setTimeout(() => existing.remove(), 300);
                log('✅ إخفاء رسالة التقدم', 'success');
            }
        }
        
        function testShowUpdateMessage() {
            log('🧪 بدء اختبار رسالة "جاري التحديث"...', 'info');
            showMaintenanceProgress('🔄 جاري التحديث...\n⏳ يرجى الانتظار', 'warning');
            
            setTimeout(() => {
                hideMaintenanceProgress();
                log('✅ اكتمل الاختبار - الرسالة ظهرت واختفت بنجاح', 'success');
            }, 2500);
        }
        
        async function testMaintenanceActivation() {
            log('🔐 محاكاة تفعيل وضع الصيانة...', 'info');
            
            // Clear the notification flag
            sessionStorage.removeItem('maintenanceNotificationShown');
            log('🗑️ تم مسح علامة الإشعار من sessionStorage', 'info');
            
            // Simulate not being active before
            localStorage.removeItem('systemMaintenanceMode');
            
            // Show update message
            showMaintenanceProgress('🔄 جاري التحديث...\n⏳ يرجى الانتظار', 'warning');
            sessionStorage.setItem('maintenanceNotificationShown', 'true');
            log('📢 عرض رسالة "جاري التحديث" للمستخدم', 'warning');
            
            await new Promise(resolve => setTimeout(resolve, 2500));
            hideMaintenanceProgress();
            
            // Activate maintenance
            localStorage.setItem('systemMaintenanceMode', 'true');
            log('✅ تم تفعيل وضع الصيانة', 'success');
            
            updateStatus();
            checkCount++;
        }
        
        function testMaintenanceDeactivation() {
            log('🔓 محاكاة إلغاء وضع الصيانة...', 'info');
            
            localStorage.removeItem('systemMaintenanceMode');
            sessionStorage.removeItem('maintenanceNotificationShown');
            
            log('✅ تم إلغاء وضع الصيانة', 'success');
            log('🗑️ تم مسح علامة الإشعار', 'info');
            
            updateStatus();
        }
        
        function testSessionStorage() {
            log('💾 اختبار SessionStorage...', 'info');
            
            const notificationShown = sessionStorage.getItem('maintenanceNotificationShown');
            
            if (notificationShown === 'true') {
                log('✅ علامة الإشعار موجودة في SessionStorage', 'success');
                log('ℹ️ الرسالة لن تظهر مرة أخرى في هذه الجلسة', 'info');
            } else {
                log('⚠️ علامة الإشعار غير موجودة في SessionStorage', 'warning');
                log('ℹ️ الرسالة ستظهر في المرة القادمة', 'info');
            }
            
            updateStatus();
        }
        
        // Initialize
        log('🚀 تهيئة صفحة الاختبار...', 'info');
        log('✅ جاهز للاختبار!', 'success');
        updateStatus();
    </script>
</body>
</html>
