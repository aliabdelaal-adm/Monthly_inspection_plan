<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø¥ØµÙ„Ø§Ø­ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ù„Ø§Øª</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .pass {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        h1 {
            color: #333;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø¥ØµÙ„Ø§Ø­ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ù„Ø§Øª ÙÙŠ Smart Planner</h1>
    
    <div class="test-section">
        <h2>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</h2>
        <div id="results"></div>
    </div>

    <script>
        // Simulate planData structure
        const planData = {
            areas: [
                { id: 'area_1', name: 'Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø£' },
                { id: 'area_2', name: 'Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø¨' },
                { id: 'area_3', name: 'Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø¬' }
            ],
            shops: [
                { id: 'shop_1', name: 'Ù…Ø­Ù„ 1', areaId: 'area_1' },
                { id: 'shop_2', name: 'Ù…Ø­Ù„ 2', areaId: 'area_1' },
                { id: 'shop_3', name: 'Ù…Ø­Ù„ 3', areaId: 'area_1' },
                { id: 'shop_4', name: 'Ù…Ø­Ù„ 4', areaId: 'area_2' },
                { id: 'shop_5', name: 'Ù…Ø­Ù„ 5', areaId: 'area_2' },
                { id: 'shop_6', name: 'Ù…Ø­Ù„ 6', areaId: 'area_3' }
            ],
            inspectionData: [
                {
                    inspector: 'Ù…ÙØªØ´ 1',
                    day: '2025-10-10',
                    area: 'Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø£',
                    shops: ['Ù…Ø­Ù„ 1'] // Only one shop was inspected
                }
            ]
        };

        // The fixed function
        function getAllShopsInArea(area) {
            const shops = [];
            
            if (!planData) return shops;
            
            // First, try to get shops from the planData.shops array (primary source)
            if (planData.shops && planData.areas) {
                // Find the area ID for the given area name
                const areaObj = planData.areas.find(a => a.name === area);
                
                if (areaObj) {
                    // Get all shops that belong to this area
                    const shopsInArea = planData.shops
                        .filter(shop => shop.areaId === areaObj.id)
                        .map(shop => shop.name);
                    
                    if (shopsInArea.length > 0) {
                        return shopsInArea;
                    }
                }
            }
            
            // Fallback: Collect all unique shops from inspection history
            // This ensures backward compatibility if shops array is not available
            if (planData.inspectionData) {
                const shopSet = new Set();
                planData.inspectionData.forEach(inspection => {
                    if (inspection.area === area && inspection.shops) {
                        inspection.shops.forEach(shop => shopSet.add(shop));
                    }
                });
                
                return Array.from(shopSet);
            }
            
            return shops;
        }

        // Run tests
        function runTests() {
            const resultsDiv = document.getElementById('results');
            let allPassed = true;

            // Test 1: Should return all shops in area from shops array
            const test1Result = getAllShopsInArea('Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø£');
            const test1Pass = test1Result.length === 3 && 
                             test1Result.includes('Ù…Ø­Ù„ 1') && 
                             test1Result.includes('Ù…Ø­Ù„ 2') && 
                             test1Result.includes('Ù…Ø­Ù„ 3');
            
            resultsDiv.innerHTML += `
                <div class="test-result ${test1Pass ? 'pass' : 'fail'}">
                    <strong>Ø§Ø®ØªØ¨Ø§Ø± 1:</strong> Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ù„Ø§Øª ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø£ Ù…Ù† shops array<br>
                    Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${test1Result.length} Ù…Ø­Ù„Ø§Øª<br>
                    Ø§Ù„Ù…Ø­Ù„Ø§Øª: ${test1Result.join(', ')}<br>
                    ${test1Pass ? 'âœ… Ù†Ø¬Ø­' : 'âŒ ÙØ´Ù„ - Ù…ØªÙˆÙ‚Ø¹ 3 Ù…Ø­Ù„Ø§Øª'}
                </div>
            `;
            allPassed = allPassed && test1Pass;

            // Test 2: Should return all shops in area B
            const test2Result = getAllShopsInArea('Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø¨');
            const test2Pass = test2Result.length === 2 && 
                             test2Result.includes('Ù…Ø­Ù„ 4') && 
                             test2Result.includes('Ù…Ø­Ù„ 5');
            
            resultsDiv.innerHTML += `
                <div class="test-result ${test2Pass ? 'pass' : 'fail'}">
                    <strong>Ø§Ø®ØªØ¨Ø§Ø± 2:</strong> Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ù„Ø§Øª ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø¨<br>
                    Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${test2Result.length} Ù…Ø­Ù„Ø§Øª<br>
                    Ø§Ù„Ù…Ø­Ù„Ø§Øª: ${test2Result.join(', ')}<br>
                    ${test2Pass ? 'âœ… Ù†Ø¬Ø­' : 'âŒ ÙØ´Ù„ - Ù…ØªÙˆÙ‚Ø¹ 2 Ù…Ø­Ù„Ø§Øª'}
                </div>
            `;
            allPassed = allPassed && test2Pass;

            // Test 3: Should return shops from area C (not in inspection history)
            const test3Result = getAllShopsInArea('Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø¬');
            const test3Pass = test3Result.length === 1 && test3Result.includes('Ù…Ø­Ù„ 6');
            
            resultsDiv.innerHTML += `
                <div class="test-result ${test3Pass ? 'pass' : 'fail'}">
                    <strong>Ø§Ø®ØªØ¨Ø§Ø± 3:</strong> Ø¬Ù„Ø¨ Ù…Ø­Ù„Ø§Øª Ù…Ù† Ù…Ù†Ø·Ù‚Ø© Ù„Ù… ÙŠØªÙ… ØªÙØªÙŠØ´Ù‡Ø§ Ù…Ù† Ù‚Ø¨Ù„<br>
                    Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${test3Result.length} Ù…Ø­Ù„Ø§Øª<br>
                    Ø§Ù„Ù…Ø­Ù„Ø§Øª: ${test3Result.join(', ')}<br>
                    ${test3Pass ? 'âœ… Ù†Ø¬Ø­ - Ø§Ù„Ø¥ØµÙ„Ø§Ø­ ÙŠØ¹Ù…Ù„!' : 'âŒ ÙØ´Ù„'}
                </div>
            `;
            allPassed = allPassed && test3Pass;

            // Test 4: Old behavior (fallback) - without shops array
            const planDataBackup = { ...planData };
            delete planData.shops;
            const test4Result = getAllShopsInArea('Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø£');
            const test4Pass = test4Result.length === 1 && test4Result.includes('Ù…Ø­Ù„ 1');
            planData.shops = planDataBackup.shops;
            
            resultsDiv.innerHTML += `
                <div class="test-result ${test4Pass ? 'pass' : 'fail'}">
                    <strong>Ø§Ø®ØªØ¨Ø§Ø± 4:</strong> Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ù‚Ø¯ÙŠÙ… (fallback) - Ø¨Ø¯ÙˆÙ† shops array<br>
                    Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${test4Result.length} Ù…Ø­Ù„Ø§Øª (ÙÙ‚Ø· Ø§Ù„Ù…ÙØªØ´Ø© Ø³Ø§Ø¨Ù‚Ø§Ù‹)<br>
                    ${test4Pass ? 'âœ… Ù†Ø¬Ø­ - Ø§Ù„ØªÙˆØ§ÙÙ‚ Ø§Ù„Ø¹ÙƒØ³ÙŠ ÙŠØ¹Ù…Ù„' : 'âŒ ÙØ´Ù„'}
                </div>
            `;
            allPassed = allPassed && test4Pass;

            // Summary
            resultsDiv.innerHTML += `
                <div class="test-result info">
                    <h3>ğŸ“Š Ø§Ù„Ù…Ù„Ø®Øµ</h3>
                    ${allPassed ? 
                        '<strong>âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù†Ø¬Ø­Øª!</strong><br>Ø§Ù„Ø¥ØµÙ„Ø§Ø­ ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.' : 
                        '<strong>âŒ Ø¨Ø¹Ø¶ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙØ´Ù„Øª</strong><br>ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙƒÙˆØ¯.'}
                </div>
            `;
        }

        // Run tests on page load
        window.onload = runTests;
    </script>
</body>
</html>
