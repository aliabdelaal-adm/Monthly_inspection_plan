<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Cache Control Meta Tags - Prevent browser caching for instant updates -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  
  <!-- SEO Prevention Meta Tags - Hide from Search Engines -->
  <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, noimageindex, notranslate">
  <meta name="googlebot" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
  <meta name="bingbot" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta property="og:title" content="">
  <meta property="og:description" content="">
  <meta name="twitter:card" content="">
  <meta name="twitter:title" content="">
  <meta name="twitter:description" content="">
  <style>
    body {font-family:Arial; background:#f7f7ff; margin:0; padding:0;}
    .box {max-width:600px; background:#fff; margin:50px auto; padding:30px 22px; border-radius:12px; box-shadow:0 0 16px #bbb;}
    textarea {width:100%; font-size:1.1em; padding:8px; border-radius:6px; border:1px solid #ccc; box-sizing:border-box;}
    button {background:#2336a0; color:#fff; border:none; border-radius:6px; padding:10px 28px; font-size:1.08em; cursor:pointer;}
    button:disabled {background:#999;}
    .status {margin:14px 0 0 0;}
    label {font-weight:bold; color:#2336a0;}
    input[type="password"] {font-size:1.1em; padding:7px; border-radius:6px; border:1px solid #bbb; box-sizing:border-box;}
    .token-popup-bg {
      position:fixed;top:0;left:0;right:0;bottom:0;
      background:rgba(0,0,0,0.17);z-index:1000;
      display:flex;align-items:center;justify-content:center;
    }
    .token-popup-box {
      background:#fff;padding:26px 22px;border-radius:12px;box-shadow:0 0 22px #aaa;min-width:320px;text-align:center;position:relative;
    }
    .token-popup-box label {color:#2336a0;}
    .token-popup-close {
      position:absolute;right:8px;top:8px;border:none;background:#dc3545;color:#fff;border-radius:50%;
      font-size:1.3em;width:32px;height:32px;cursor:pointer;box-shadow:0 2px 8px rgba(220,53,69,0.3);
      transition:all 0.2s ease;display:flex;align-items:center;justify-content:center;font-weight:bold;z-index:10;
    }
    .token-popup-close:hover {
      background:#c82333;transform:scale(1.05);box-shadow:0 4px 12px rgba(220,53,69,0.4);
    }
    
    @media (max-width:600px) {
      .box {
        margin:20px auto;
        padding:20px 15px;
        max-width:95vw;
        border-radius:8px;
      }
      textarea {
        font-size:1em;
        padding:6px;
        rows:12;
      }
      button {
        padding:8px 20px;
        font-size:1em;
        width:100%;
        margin-bottom:8px;
      }
      .token-popup-box {
        padding:20px 15px;
        min-width:280px;
        max-width:90vw;
        margin:0 20px;
      }
      input[type="password"] {
        font-size:1em;
        padding:6px;
        width:100%;
        margin:10px 0;
      }
      h2 {
        font-size:1.3em;
        margin-bottom:15px;
      }
    }
    
    @media (max-width:400px) {
      .box {
        margin:10px auto;
        padding:15px 10px;
        max-width:98vw;
      }
      textarea {
        font-size:0.9em;
        padding:5px;
      }
      button {
        padding:6px 16px;
        font-size:0.95em;
      }
      .token-popup-box {
        padding:15px 10px;
        min-width:260px;
      }
      h2 {
        font-size:1.2em;
      }
    }
  </style>
</head>
<body>
  <div class="token-popup-bg" id="tokenPopup" style="display:none;">
    <div class="token-popup-box">
      <button class="token-popup-close" onclick="hideTokenPopup()" title="Ø¥ØºÙ„Ø§Ù‚">Ã—</button>
      <h3>Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ø³Ø±ÙŠ</h3>
      <p style="font-size:0.9em;color:#666;margin:10px 0;">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ GitHub Personal Access Token Ù„Ù„Ù…Ø³ØªÙˆØ¯Ø¹</p>
      
      <!-- Instructions for creating token -->
      <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 6px; padding: 10px; margin: 10px 0; text-align: right; font-size: 0.85em;">
        <strong>ÙƒÙŠÙÙŠØ© Ø¥Ù†Ø´Ø§Ø¡ ØªÙˆÙƒÙ† Ø¬Ø¯ÙŠØ¯:</strong>
        <ol style="margin: 8px 0; padding-right: 20px; line-height: 1.5;">
          <li>Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰: <a href="https://github.com/settings/tokens" target="_blank" style="color: #0066cc;">GitHub Settings â†’ Tokens</a></li>
          <li>Ø§Ù†Ù‚Ø± "Generate new token (classic)"</li>
          <li>Ø§Ø®ØªØ± ØµÙ„Ø§Ø­ÙŠØ© <strong>repo</strong></li>
          <li></li>
        </ol>
      </div>
      
      <input id="tokenInput" type="password" placeholder="ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" style="width: 100%; box-sizing: border-box;"><br><br>
      <button onclick="saveToken()">Ø­ÙØ¸</button>
      <button onclick="useDefaultToken()" style="background:#666;margin-left:10px;">Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</button>
      <div style="color:#c00;font-size:1em;margin-top:10px;" id="tokenError"></div>
    </div>
  </div>
  <!-- New Dashboard Banner -->
  <div class="box" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-align: center; padding: 30px;">
    <h2 style="color: white; margin-bottom: 15px;">ğŸ›ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø§Ù…Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©!</h2>
    <p style="font-size: 1.1em; margin-bottom: 20px;">ØªØ¬Ø±Ø¨Ø© Ø¥Ø¯Ø§Ø±Ø© Ù…Ø­Ø³Ù‘Ù†Ø© Ù…Ø¹ Ù…ÙŠØ²Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© ÙˆÙˆØ§Ø¬Ù‡Ø© Ø¹ØµØ±ÙŠØ©</p>
    <button onclick="window.location.href='admin-dashboard.html'" style="background: white; color: #667eea; font-size: 1.2em; padding: 15px 40px; font-weight: bold;">
      ğŸš€ Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
    </button>
    <p style="margin-top: 15px; font-size: 0.9em; opacity: 0.9;">âœ¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙÙˆØ±ÙŠØ© â€¢ Ø±Ø³ÙˆÙ… Ø¨ÙŠØ§Ù†ÙŠØ© â€¢ Ø¥Ø¯Ø§Ø±Ø© Ø´Ø§Ù…Ù„Ø© â€¢ ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨</p>
  </div>

  <div class="box">
    <h2 style="text-align:center; color:#2336a0;">ØªØ¹Ø¯ÙŠÙ„ Ù…Ù„Ù Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´ (plan-data.json)</h2>
    <button onclick="changeToken()" style="float:left;margin-bottom:10px;">ØªØºÙŠÙŠØ± Ø§Ù„ØªÙˆÙƒÙ†</button>
    <label>Ø¨ÙŠØ§Ù†Ø§Øª JSON (ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§):</label>
    <textarea id="json" rows="18"></textarea><br>
    <button onclick="updatePlan()" id="saveBtn">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
    <div class="status" id="status"></div>
  </div>

  <div class="box">
    <h2 style="text-align:center; color:#2336a0;">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„ÙØ§Øª</h2>
    
    <!-- Token Setup Instructions -->
    <div style="background: #e3f2fd; border: 2px solid #1976d2; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
      <h4 style="margin: 0 0 10px 0; color: #1976d2;">ğŸ“Œ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙˆÙƒÙ† Ù„Ù„Ù…Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰:</h4>
      <ol style="margin: 5px 0; padding-right: 20px; font-size: 0.95em; line-height: 1.6;">
        <li>Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ GitHub â†’ Settings â†’ Developer settings â†’ <a href="https://github.com/settings/tokens" target="_blank" style="color: #1976d2;">Personal access tokens</a></li>
        <li>Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ "Generate new token (classic)"</li>
        <li>Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ù„Ù„ØªÙˆÙƒÙ† (Ù…Ø«Ù„: "Monthly Inspection Plan")</li>
        <li><strong>Ù…Ù‡Ù…:</strong> Ø§Ø®ØªØ± ØµÙ„Ø§Ø­ÙŠØ© <code style="background: #f5f5f5; padding: 2px 6px; border-radius: 3px;">repo</code></li>
        <li>Ø§Ù†Ø³Ø® Ø§Ù„ØªÙˆÙƒÙ† ÙˆØ§Ù†Ù‚Ø± Ø¹Ù„Ù‰ "ØªØºÙŠÙŠØ± Ø§Ù„ØªÙˆÙƒÙ†" Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø¥Ø¯Ø®Ø§Ù„Ù‡</li>
      </ol>
      <p style="margin: 10px 0 0 0; font-size: 0.9em; color: #d32f2f;">âš ï¸ <strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ø¨Ø¯ÙˆÙ† ØªÙˆÙƒÙ† ØµØ­ÙŠØ­ØŒ Ù„Ù† ØªØªÙ…ÙƒÙ† Ù…Ù† Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª!</p>
    </div>
    
    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 10px;">Ø±ÙØ¹ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯:</label>
      <input type="file" id="fileUpload" accept=".pdf,.xlsx,.xls,.docx,.doc,.pptx,.ppt,.csv,.txt,.jpg,.jpeg,.png,.gif" style="margin-bottom: 10px;">
      <br>
      <label style="display: block; margin-bottom: 5px;">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ:</label>
      <select id="fileCategory" style="padding: 8px; border-radius: 6px; border: 1px solid #ccc; margin-bottom: 10px;">
        <option value="documents">Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ - Documents</option>
        <option value="reports">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± - Reports</option>
        <option value="schedules">Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ - Schedules</option>
        <option value="resources">Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ - Resources</option>
      </select>
      <br>
      <label style="display: block; margin-bottom: 5px;">ÙˆØµÙ Ø§Ù„Ù…Ù„Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
      <input type="text" id="fileDescription" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„Ù…Ù„Ù" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ccc; margin-bottom: 10px; box-sizing: border-box;">
      <br>
      <button onclick="uploadFile()" id="uploadBtn" style="background: #28a745;">Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù</button>
    </div>
    
    <div style="border-top: 1px solid #ddd; padding-top: 20px;">
      <h3 style="color: #2336a0;">Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©:</h3>
      <button onclick="loadFilesList()" style="background: #17a2b8; margin-bottom: 10px;">ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª</button>
      <div id="filesList" style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; border-radius: 6px; background: #f9f9f9;">
        <p style="text-align: center; color: #666;">Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ "ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª" Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©</p>
      </div>
    </div>
    
    <div class="status" id="fileStatus" style="margin-top: 10px;"></div>
  </div>
  <script>
    const repo = "aliabdelaal-adm/Monthly_inspection_plan";
    const path = "plan-data.json";
    let sha = "";

    // ---- Token Management ----
    function getToken() {
      return localStorage.getItem("devToken") || "";
    }
    function setToken(token) {
      localStorage.setItem("devToken", token);
    }
    function removeToken() {
      localStorage.removeItem("devToken");
    }
    function showTokenPopup() {
      document.getElementById("tokenPopup").style.display = "flex";
      document.getElementById("tokenInput").value = "";
      document.getElementById("tokenInput").focus();
      document.getElementById("tokenError").textContent = "";
    }
    function hideTokenPopup() {
      document.getElementById("tokenPopup").style.display = "none";
    }
    function saveToken() {
      const token = document.getElementById("tokenInput").value.trim();
      if (!token) {
        document.getElementById("tokenError").textContent = "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ø³Ø±ÙŠ!";
        return;
      }
      setToken(token);
      hideTokenPopup();
      loadPlan();
    }
    function useDefaultToken() {
      // Use the repository's default token
      const defaultToken = "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";
      setToken(defaultToken);
      hideTokenPopup();
      loadPlan();
    }
    function changeToken() {
      removeToken();
      showTokenPopup();
    }

    // ---- Plan Data Logic ----
    async function loadPlan() {
      const token = getToken();
      if (!token) { showTokenPopup(); return; }
      
      try {
        document.getElementById("status").textContent = "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";
        const res = await fetch(`https://api.github.com/repos/${repo}/contents/${path}`, {
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          }
        });
        
        if (!res.ok) {
          throw new Error(`HTTP ${res.status}: ${res.statusText}`);
        }
        
        const file = await res.json();
        document.getElementById("json").value = decodeURIComponent(escape(atob(file.content)));
        sha = file.sha;
        document.getElementById("status").textContent = "ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¢Ù†.";
      } catch (error) {
        document.getElementById("status").textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: " + error.message;
        if (error.message.includes("401") || error.message.includes("403")) {
          removeToken();
          setTimeout(showTokenPopup, 500);
        }
      }
    }

    async function updatePlan() {
      const token = getToken();
      if (!token) { showTokenPopup(); return; }
      let jsonData;
      try {
        jsonData = JSON.parse(document.getElementById("json").value);
      } catch(e) {
        alert("Ø®Ø·Ø£ ÙÙŠ ØªÙ†Ø³ÙŠÙ‚ JSON! Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø£Ù‚ÙˆØ§Ø³ ÙˆØ§Ù„ÙÙˆØ§ØµÙ„.");
        return;
      }
      
      try {
        document.getElementById("saveBtn").disabled = true;
        document.getElementById("status").textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";
        const content = btoa(unescape(encodeURIComponent(JSON.stringify(jsonData, null, 2))));
        const res = await fetch(`https://api.github.com/repos/${repo}/contents/${path}`, {
          method: "PUT",
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: "ØªØ­Ø¯ÙŠØ« Ø®Ø·Ø© Ø§Ù„ØªÙØªÙŠØ´ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø·ÙˆØ±",
            content: content,
            sha: sha
          })
        });
        
        if (res.status === 200 || res.status === 201) {
          document.getElementById("status").textContent = "âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!";
          loadPlan(); // reload sha
        } else {
          const err = await res.json().catch(() => ({ message: `HTTP ${res.status}: ${res.statusText}` }));
          document.getElementById("status").textContent = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: " + (err.message || "ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙƒÙ† Ø£Ùˆ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª.");
          if (res.status === 401 || res.status === 403) {
            removeToken();
            setTimeout(showTokenPopup, 500);
          }
        }
      } catch (error) {
        document.getElementById("status").textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: " + error.message;
      } finally {
        document.getElementById("saveBtn").disabled = false;
      }
    }

    // ---- File Management Functions ----
    let filesSha = "";
    
    async function uploadFile() {
      const token = getToken();
      if (!token) { 
        document.getElementById("fileStatus").textContent = "âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ GitHub Token Ø£ÙˆÙ„Ø§Ù‹. Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ 'ØªØºÙŠÙŠØ± Ø§Ù„ØªÙˆÙƒÙ†' Ø£Ø¹Ù„Ø§Ù‡.";
        showTokenPopup(); 
        return; 
      }
      
      const fileInput = document.getElementById("fileUpload");
      const categorySelect = document.getElementById("fileCategory");
      const descriptionInput = document.getElementById("fileDescription");
      
      if (!fileInput.files[0]) {
        document.getElementById("fileStatus").textContent = "âŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹";
        return;
      }
      
      const file = fileInput.files[0];
      const category = categorySelect.value;
      const description = descriptionInput.value || file.name;
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 25 MB Ù„Ù„Ù€ GitHub)
      const maxSize = 25 * 1024 * 1024; // 25 MB
      if (file.size > maxSize) {
        document.getElementById("fileStatus").textContent = "âŒ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹! ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† 25 MB";
        return;
      }
      
      try {
        document.getElementById("uploadBtn").disabled = true;
        document.getElementById("fileStatus").textContent = "â³ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù...";
        
        // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù ÙƒÙ€ base64
        const reader = new FileReader();
        reader.onload = async function(e) {
          const content = e.target.result.split(',')[1]; // Ø¥Ø²Ø§Ù„Ø© data:type/format;base64,
          const fileName = file.name;
          const filePath = `files/${category}/${fileName}`;
          
          try {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙƒÙ† Ø£ÙˆÙ„Ø§Ù‹
            const testRes = await fetch(`https://api.github.com/repos/${repo}`, {
              headers: {
                "Authorization": `Bearer ${token}`,
                "Content-Type": "application/json"
              }
            });
            
            if (!testRes.ok) {
              if (testRes.status === 401) {
                document.getElementById("fileStatus").innerHTML = "âŒ <strong>Ø§Ù„ØªÙˆÙƒÙ† ØºÙŠØ± ØµØ§Ù„Ø­ Ø£Ùˆ Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©!</strong><br>Ø§Ù„Ø­Ù„:<br>1. Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ 'ØªØºÙŠÙŠØ± Ø§Ù„ØªÙˆÙƒÙ†' Ø£Ø¹Ù„Ø§Ù‡<br>2. Ø£Ù†Ø´Ø¦ ØªÙˆÙƒÙ† Ø¬Ø¯ÙŠØ¯ Ù…Ù† GitHub: Settings â†’ Developer settings â†’ Personal access tokens<br>3. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¶Ø§ÙØ© ØµÙ„Ø§Ø­ÙŠØ© 'repo' Ù„Ù„ØªÙˆÙƒÙ†";
                removeToken();
                document.getElementById("uploadBtn").disabled = false;
                return;
              } else if (testRes.status === 403) {
                document.getElementById("fileStatus").innerHTML = "âŒ <strong>Ø§Ù„ØªÙˆÙƒÙ† Ù„ÙŠØ³ Ù„Ø¯ÙŠÙ‡ ØµÙ„Ø§Ø­ÙŠØ§Øª ÙƒØ§ÙÙŠØ©!</strong><br>Ø§Ù„Ø­Ù„:<br>1. Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ GitHub: Settings â†’ Developer settings â†’ Personal access tokens<br>2. Ø£Ù†Ø´Ø¦ ØªÙˆÙƒÙ† Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ ØµÙ„Ø§Ø­ÙŠØ© 'repo'<br>3. Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ 'ØªØºÙŠÙŠØ± Ø§Ù„ØªÙˆÙƒÙ†' Ø£Ø¹Ù„Ø§Ù‡ ÙˆØ£Ø¯Ø®Ù„ Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯";
                document.getElementById("uploadBtn").disabled = false;
                return;
              }
            }
            
            // Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ GitHub
            const uploadRes = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`, {
              method: "PUT",
              headers: {
                "Authorization": `Bearer ${token}`,
                "Content-Type": "application/json"
              },
              body: JSON.stringify({
                message: `Ø±ÙØ¹ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯: ${fileName}`,
                content: content
              })
            });
            
            if (uploadRes.status === 201) {
              // ØªØ­Ø¯ÙŠØ« Ù…Ù„Ù files.json
              await updateFilesRegistry(fileName, filePath, category, file.size, description, token);
              document.getElementById("fileStatus").innerHTML = `âœ… <strong>ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­!</strong><br>Ø§Ù„Ù…Ù„Ù: ${fileName}<br>Ø§Ù„ØªØµÙ†ÙŠÙ: ${category}<br>Ø§Ù„Ø¢Ù† Ù…ØªØ§Ø­ ÙÙŠ Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…Ù„ÙØ§Øª`;
              // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
              fileInput.value = '';
              descriptionInput.value = '';
              // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª
              setTimeout(() => loadFilesList(), 1000);
            } else if (uploadRes.status === 422) {
              document.getElementById("fileStatus").innerHTML = `âŒ <strong>Ù…Ù„Ù Ø¨Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹!</strong><br>Ø§Ù„Ø­Ù„ÙˆÙ„:<br>1. Ø£Ø¹Ø¯ ØªØ³Ù…ÙŠØ© Ø§Ù„Ù…Ù„Ù<br>2. Ø£Ùˆ Ø§Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø£ÙˆÙ„Ø§Ù‹`;
            } else if (uploadRes.status === 401 || uploadRes.status === 403) {
              document.getElementById("fileStatus").innerHTML = "âŒ <strong>Ø®Ø·Ø£ ÙÙŠ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ØªÙˆÙƒÙ†!</strong><br>ÙŠØ±Ø¬Ù‰:<br>1. Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ØªÙˆÙƒÙ†<br>2. ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙˆÙƒÙ† Ù…Ù† 'ØªØºÙŠÙŠØ± Ø§Ù„ØªÙˆÙƒÙ†'<br>3. Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„ØªÙˆÙƒÙ† Ù„Ø¯ÙŠÙ‡ ØµÙ„Ø§Ø­ÙŠØ© 'repo'";
              removeToken();
            } else {
              const err = await uploadRes.json().catch(() => ({ message: `HTTP ${uploadRes.status}: ${uploadRes.statusText}` }));
              document.getElementById("fileStatus").innerHTML = `âŒ <strong>Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù!</strong><br>Ø§Ù„ØªÙØ§ØµÙŠÙ„: ${err.message || "ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙƒÙ† Ø£Ùˆ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª"}<br>Ø§Ù„Ø±Ù…Ø²: ${uploadRes.status}`;
            }
          } catch (error) {
            if (error.message.includes("NetworkError") || error.message.includes("Failed to fetch")) {
              document.getElementById("fileStatus").innerHTML = "âŒ <strong>Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª!</strong><br>ÙŠØ±Ø¬Ù‰:<br>1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª<br>2. Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰";
            } else {
              document.getElementById("fileStatus").innerHTML = `âŒ <strong>Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù!</strong><br>Ø§Ù„ØªÙØ§ØµÙŠÙ„: ${error.message}`;
            }
          } finally {
            document.getElementById("uploadBtn").disabled = false;
          }
        };
        
        reader.onerror = function(error) {
          document.getElementById("fileStatus").textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù: " + error;
          document.getElementById("uploadBtn").disabled = false;
        };
        
        reader.readAsDataURL(file);
        
      } catch (error) {
        document.getElementById("fileStatus").textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù: " + error.message;
        document.getElementById("uploadBtn").disabled = false;
      }
    }
    
    async function updateFilesRegistry(fileName, filePath, category, fileSize, description, token) {
      try {
        // ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù files.json Ø§Ù„Ø­Ø§Ù„ÙŠ
        const res = await fetch(`https://api.github.com/repos/${repo}/contents/files.json`, {
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          }
        });
        
        let filesData = { files: [], categories: [], lastUpdate: new Date().toISOString() };
        let currentSha = "";
        
        if (res.ok) {
          const file = await res.json();
          filesData = JSON.parse(decodeURIComponent(escape(atob(file.content))));
          currentSha = file.sha;
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯
        const newFile = {
          id: Date.now().toString(),
          name: fileName,
          path: filePath,
          category: category,
          type: fileName.split('.').pop().toLowerCase(),
          size: fileSize,
          uploadDate: new Date().toISOString(),
          description: description,
          uploader: "Ø¯. Ø¹Ù„ÙŠ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø§Ù„",
          visible: true
        };
        
        filesData.files.push(newFile);
        filesData.lastUpdate = new Date().toISOString();
        
        // Ø­ÙØ¸ Ù…Ù„Ù files.json Ø§Ù„Ù…Ø­Ø¯Ø«
        const content = btoa(unescape(encodeURIComponent(JSON.stringify(filesData, null, 2))));
        const updateRes = await fetch(`https://api.github.com/repos/${repo}/contents/files.json`, {
          method: "PUT",
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: `ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª - Ø¥Ø¶Ø§ÙØ© ${fileName}`,
            content: content,
            sha: currentSha
          })
        });
        
        if (!updateRes.ok) {
          console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª");
        }
        
      } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª:", error);
      }
    }
    
    async function loadFilesList() {
      const token = getToken();
      if (!token) { showTokenPopup(); return; }
      
      try {
        document.getElementById("fileStatus").textContent = "â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª...";
        
        const res = await fetch(`https://api.github.com/repos/${repo}/contents/files.json`, {
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          }
        });
        
        if (res.ok) {
          const file = await res.json();
          const filesData = JSON.parse(decodeURIComponent(escape(atob(file.content))));
          displayFilesList(filesData.files);
          document.getElementById("fileStatus").textContent = "âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª";
        } else {
          document.getElementById("fileStatus").textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª";
        }
      } catch (error) {
        document.getElementById("fileStatus").textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª: " + error.message;
      }
    }
    
    function escapeQuotes(str) {
      return str.replace(/'/g, "\\'").replace(/"/g, '\\"');
    }
    
    function displayFilesList(files) {
      const container = document.getElementById("filesList");
      
      if (!files || files.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ù…Ø±ÙÙˆØ¹Ø©</p>';
        return;
      }
      
      const visibleFiles = files.filter(f => f.visible !== false);
      
      if (visibleFiles.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ù…Ø±Ø¦ÙŠØ©</p>';
        return;
      }
      
      let html = '';
      const categories = {
        documents: 'Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚',
        reports: 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±', 
        schedules: 'Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„',
        resources: 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯'
      };
      
      // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø­Ø³Ø¨ Ø§Ù„ØªØµÙ†ÙŠÙ
      const filesByCategory = {};
      visibleFiles.forEach(file => {
        if (!filesByCategory[file.category]) {
          filesByCategory[file.category] = [];
        }
        filesByCategory[file.category].push(file);
      });
      
      // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª Ø­Ø³Ø¨ Ø§Ù„ØªØµÙ†ÙŠÙ
      Object.keys(filesByCategory).forEach(category => {
        html += `<div style="margin-bottom: 15px;">`;
        html += `<h4 style="color: #2336a0; margin-bottom: 8px;">${categories[category] || category}</h4>`;
        
        filesByCategory[category].forEach(file => {
          const fileSize = formatFileSize(file.size);
          const uploadDate = new Date(file.uploadDate).toLocaleDateString('ar-EG');
          
          html += `
            <div style="padding: 8px; margin-bottom: 8px; border: 1px solid #ddd; border-radius: 4px; background: white;">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <strong>${file.name}</strong>
                  <br>
                  <small style="color: #666;">${file.description}</small>
                  <br>
                  <small style="color: #999;">Ø§Ù„Ø­Ø¬Ù…: ${fileSize} | Ø§Ù„ØªØ§Ø±ÙŠØ®: ${uploadDate}</small>
                </div>
                <div>
                  <button onclick="downloadFile('${file.path}')" style="background: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin-left: 5px;">ØªØ­Ù…ÙŠÙ„</button>
                  <button onclick="editFile('${file.id}', '${escapeQuotes(file.name)}', '${escapeQuotes(file.description)}', '${file.category}')" style="background: #ffc107; color: #333; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin-left: 5px;">ØªØ¹Ø¯ÙŠÙ„</button>
                  <button onclick="deleteFile('${file.id}', '${file.path}', '${escapeQuotes(file.name)}')" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">Ø­Ø°Ù</button>
                </div>
              </div>
            </div>
          `;
        });
        
        html += `</div>`;
      });
      
      container.innerHTML = html;
    }
    
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    async function downloadFile(filePath) {
      const token = getToken();
      if (!token) { showTokenPopup(); return; }
      
      try {
        const res = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`, {
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          }
        });
        
        if (res.ok) {
          const file = await res.json();
          const content = atob(file.content);
          const blob = new Blob([content], { type: 'application/octet-stream' });
          const url = URL.createObjectURL(blob);
          
          const a = document.createElement('a');
          a.href = url;
          a.download = file.name;
          a.style.display = 'none';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
          
          document.getElementById("fileStatus").textContent = "âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù";
        } else {
          document.getElementById("fileStatus").textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù";
        }
      } catch (error) {
        document.getElementById("fileStatus").textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù: " + error.message;
      }
    }
    
    async function deleteFile(fileId, filePath, fileName) {
      if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù "${fileName}"ØŸ`)) {
        return;
      }
      
      const token = getToken();
      if (!token) { showTokenPopup(); return; }
      
      try {
        document.getElementById("fileStatus").textContent = "â³ Ø¬Ø§Ø±ÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù...";
        
        // Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù Ù…Ù† GitHub
        const fileRes = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`, {
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          }
        });
        
        if (fileRes.ok) {
          const file = await fileRes.json();
          const deleteRes = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`, {
            method: "DELETE",
            headers: {
              "Authorization": `Bearer ${token}`,
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              message: `Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù: ${fileName}`,
              sha: file.sha
            })
          });
          
          if (deleteRes.ok) {
            // ØªØ­Ø¯ÙŠØ« Ù…Ù„Ù files.json
            await removeFromFilesRegistry(fileId, token);
            document.getElementById("fileStatus").textContent = "âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­";
            loadFilesList();
          } else {
            document.getElementById("fileStatus").textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù";
          }
        } else {
          document.getElementById("fileStatus").textContent = "âŒ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯";
        }
      } catch (error) {
        document.getElementById("fileStatus").textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù: " + error.message;
      }
    }
    
    async function editFile(fileId, fileName, currentDescription, category) {
      const newDescription = prompt('ØªØ­Ø±ÙŠØ± ÙˆØµÙ Ø§Ù„Ù…Ù„Ù:\n\nØ§Ø³Ù… Ø§Ù„Ù…Ù„Ù: ' + fileName, currentDescription);
      
      if (newDescription === null) {
        return; // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ù„ØºÙ‰
      }
      
      const token = getToken();
      if (!token) { 
        document.getElementById("fileStatus").textContent = "âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ GitHub Token Ø£ÙˆÙ„Ø§Ù‹";
        showTokenPopup(); 
        return; 
      }
      
      try {
        document.getElementById("fileStatus").textContent = "â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù...";
        
        // ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù files.json Ø§Ù„Ø­Ø§Ù„ÙŠ
        const res = await fetch(`https://api.github.com/repos/${repo}/contents/files.json`, {
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          }
        });
        
        if (res.ok) {
          const file = await res.json();
          const filesData = JSON.parse(decodeURIComponent(escape(atob(file.content))));
          
          // ØªØ­Ø¯ÙŠØ« ÙˆØµÙ Ø§Ù„Ù…Ù„Ù
          const fileIndex = filesData.files.findIndex(f => f.id === fileId);
          if (fileIndex !== -1) {
            filesData.files[fileIndex].description = newDescription;
            filesData.lastUpdate = new Date().toISOString();
            
            // Ø­ÙØ¸ Ù…Ù„Ù files.json Ø§Ù„Ù…Ø­Ø¯Ø«
            const content = btoa(unescape(encodeURIComponent(JSON.stringify(filesData, null, 2))));
            const updateRes = await fetch(`https://api.github.com/repos/${repo}/contents/files.json`, {
              method: "PUT",
              headers: {
                "Authorization": `Bearer ${token}`,
                "Content-Type": "application/json"
              },
              body: JSON.stringify({
                message: `ØªØ­Ø¯ÙŠØ« ÙˆØµÙ Ø§Ù„Ù…Ù„Ù: ${fileName}`,
                content: content,
                sha: file.sha
              })
            });
            
            if (updateRes.ok) {
              document.getElementById("fileStatus").textContent = "âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­";
              // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª
              setTimeout(() => loadFilesList(), 1000);
            } else {
              document.getElementById("fileStatus").textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù";
            }
          } else {
            document.getElementById("fileStatus").textContent = "âŒ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯";
          }
        } else {
          document.getElementById("fileStatus").textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ù";
        }
      } catch (error) {
        document.getElementById("fileStatus").textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù: " + error.message;
      }
    }
    
    async function removeFromFilesRegistry(fileId, token) {
      try {
        // ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù files.json Ø§Ù„Ø­Ø§Ù„ÙŠ
        const res = await fetch(`https://api.github.com/repos/${repo}/contents/files.json`, {
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          }
        });
        
        if (res.ok) {
          const file = await res.json();
          const filesData = JSON.parse(decodeURIComponent(escape(atob(file.content))));
          
          // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ù„Ù Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
          filesData.files = filesData.files.filter(f => f.id !== fileId);
          filesData.lastUpdate = new Date().toISOString();
          
          // Ø­ÙØ¸ Ù…Ù„Ù files.json Ø§Ù„Ù…Ø­Ø¯Ø«
          const content = btoa(unescape(encodeURIComponent(JSON.stringify(filesData, null, 2))));
          const updateRes = await fetch(`https://api.github.com/repos/${repo}/contents/files.json`, {
            method: "PUT",
            headers: {
              "Authorization": `Bearer ${token}`,
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              message: `ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª - Ø­Ø°Ù Ù…Ù„Ù`,
              content: content,
              sha: file.sha
            })
          });
          
          if (!updateRes.ok) {
            console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª");
          }
        }
      } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª:", error);
      }
    }

    // ---- On Load ----
    window.onload = function() {
      if (!getToken()) {
        showTokenPopup();
      } else {
        loadPlan();
      }
    };
  </script>
</body>
</html>
