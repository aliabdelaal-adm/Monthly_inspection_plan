# استكشاف أخطاء رفع الملفات وإصلاحها
# File Upload Troubleshooting Guide

## 🔴 المشكلة - The Problem

**الوصف بالعربية:**
لا يمكن رفع الملفات من المصادر الخارجية أو من الجهاز المحلي إلى مجلد الملفات في المستودع.

**English Description:**
Cannot upload files from external sources or local computer to the files folder in the repository.

---

## 🔍 الأسباب الشائعة - Common Causes

### 1. التوكن منتهي الصلاحية أو غير صالح
**المشكلة:** GitHub Personal Access Token المستخدم قد يكون:
- منتهي الصلاحية
- محذوف أو ملغي
- غير موجود

**الأعراض:**
```
❌ التوكن غير صالح أو منتهي الصلاحية!
❌ خطأ في صلاحيات التوكن
```

**الحل:** [راجع قسم "إنشاء توكن جديد" أدناه](#إنشاء-توكن-github-جديد)

---

### 2. التوكن بدون صلاحيات كافية
**المشكلة:** التوكن موجود لكن لا يملك صلاحية `repo`

**الأعراض:**
```
❌ التوكن ليس لديه صلاحيات كافية!
❌ خطأ في صلاحيات التوكن (403)
```

**الحل:** أنشئ توكن جديد مع صلاحية `repo` الكاملة

---

### 3. ملف بنفس الاسم موجود مسبقاً
**المشكلة:** تحاول رفع ملف باسم موجود فعلاً

**الأعراض:**
```
❌ ملف بنفس الاسم موجود مسبقاً! (422)
```

**الحل:**
1. أعد تسمية الملف قبل رفعه
2. أو احذف الملف القديم من لوحة المطور أولاً

---

### 4. حجم الملف كبير جداً
**المشكلة:** حجم الملف أكبر من 25 MB

**الأعراض:**
```
❌ حجم الملف كبير جداً! يجب أن يكون أقل من 25 MB
```

**الحل:**
1. ضغط الملف باستخدام برنامج ضغط
2. تقسيم الملف إلى عدة ملفات أصغر
3. إزالة المحتوى غير الضروري من الملف

---

### 5. مشاكل في الاتصال بالإنترنت
**المشكلة:** انقطاع أو ضعف في الاتصال بالإنترنت

**الأعراض:**
```
❌ خطأ في الاتصال بالإنترنت!
Failed to fetch
NetworkError
```

**الحل:**
1. تحقق من اتصال الإنترنت
2. أعد تحميل الصفحة وحاول مرة أخرى
3. تحقق من جدار الحماية أو برامج الحماية

---

## ✅ الحل الشامل - Complete Solution

### إنشاء توكن GitHub جديد

#### الخطوة 1: الذهاب إلى إعدادات GitHub
1. افتح [GitHub](https://github.com) وسجل الدخول
2. انقر على صورة ملفك الشخصي في الزاوية العلوية اليمنى
3. اختر **Settings**

#### الخطوة 2: الوصول إلى Developer Settings
1. في القائمة الجانبية، انزل إلى الأسفل
2. انقر على **Developer settings**

#### الخطوة 3: إنشاء Personal Access Token
1. انقر على **Personal access tokens**
2. اختر **Tokens (classic)**
3. انقر على **Generate new token (classic)**

#### الخطوة 4: تكوين التوكن
```
الاسم: Monthly Inspection Plan File Upload
Note: أدخل وصف يساعدك على تذكر الغرض من التوكن

مدة الصلاحية: 
- 30 days (للاستخدام قصير المدى)
- 90 days (موصى به)
- Custom (لتحديد مدة معينة)
- No expiration (غير موصى به لأسباب أمنية)

الصلاحيات المطلوبة:
✅ repo (Full control of private repositories)
   ✅ repo:status
   ✅ repo_deployment
   ✅ public_repo
   ✅ repo:invite
   ✅ security_events
```

⚠️ **مهم جداً:** يجب اختيار صلاحية `repo` الكاملة!

#### الخطوة 5: حفظ التوكن
1. انقر على **Generate token** في الأسفل
2. **احفظ التوكن فوراً!** لن تتمكن من رؤيته مرة أخرى
3. انسخ التوكن إلى مكان آمن (يبدأ بـ `ghp_`)

#### الخطوة 6: إدخال التوكن في النظام
1. افتح لوحة المطور: `admin.html`
2. انقر على زر **"تغيير التوكن"** في الأعلى
3. ألصق التوكن في الحقل المخصص
4. انقر على **"حفظ"**

---

## 🧪 اختبار رفع الملفات - Testing File Upload

### من لوحة المطور (admin.html):

1. **افتح admin.html**
   ```
   https://aliabdelaal-adm.github.io/Monthly_inspection_plan/admin.html
   ```

2. **تأكد من إدخال التوكن**
   - إذا لم يكن موجود، سيظهر لك نافذة منبثقة
   - أدخل التوكن واحفظه

3. **اختر ملف للاختبار**
   - انقر على "رفع ملف جديد"
   - اختر ملف صغير (أقل من 1 MB) للاختبار
   - اختر التصنيف المناسب
   - (اختياري) أدخل وصف للملف

4. **ارفع الملف**
   - انقر على "رفع الملف"
   - يجب أن ترى: "⏳ جاري رفع الملف..."
   - بعد قليل: "✅ تم رفع الملف بنجاح!"

5. **تحقق من النجاح**
   - انقر على "تحديث قائمة الملفات"
   - يجب أن ترى الملف في القائمة

### من الصفحة الرئيسية (index.html):

1. **سجل الدخول كمطور**
   - افتح `index.html`
   - أدخل كلمة مرور المطور

2. **اذهب إلى قسم إدارة الخدمات**
   - جدول المناوبات، أو
   - تتبع الإجازات، أو
   - قائمة المحلات

3. **انقر على "📁 رفع ملف"**
   - اختر ملف
   - سيتم رفعه تلقائياً

4. **تحقق من رسالة النجاح**
   ```
   ✅ تم رفع ملف [القسم] بنجاح!
   
   الملف: example.xlsx
   الآن متاح للجميع في مكتبة الملفات
   ```

---

## 📋 قائمة التحقق - Checklist

قبل رفع أي ملف، تأكد من:

- [ ] تسجيل الدخول كمطور
- [ ] إدخال GitHub Personal Access Token صحيح
- [ ] التوكن لديه صلاحية `repo`
- [ ] التوكن لم تنتهي صلاحيته
- [ ] حجم الملف أقل من 25 MB
- [ ] اسم الملف غير موجود مسبقاً
- [ ] اتصال الإنترنت يعمل بشكل صحيح

---

## 🆘 إذا استمرت المشكلة - If Problem Persists

### جرب هذه الخطوات:

1. **امسح ذاكرة التخزين المؤقت**
   ```javascript
   // افتح Console في المتصفح واكتب:
   localStorage.clear()
   // ثم أعد تحميل الصفحة
   ```

2. **جرب متصفح آخر**
   - Chrome
   - Firefox
   - Edge

3. **تحقق من Console للأخطاء**
   - اضغط F12
   - اذهب إلى تبويب Console
   - ابحث عن رسائل الخطأ باللون الأحمر

4. **تأكد من صلاحيات GitHub**
   - اذهب إلى Repository Settings
   - تحقق من أنك تملك صلاحيات الكتابة

---

## 🔧 التحسينات المضافة - Added Improvements

### في هذا الإصلاح، تم إضافة:

✅ **فحص التوكن قبل الرفع**
- يتم التحقق من صلاحية التوكن قبل محاولة رفع الملف
- يوفر الوقت ويعطي رسائل خطأ واضحة

✅ **رسائل خطأ تفصيلية**
- كل خطأ له رسالة واضحة
- خطوات الحل مضمنة في كل رسالة خطأ

✅ **إرشادات في الواجهة**
- صندوق معلومات في admin.html يشرح كيفية إنشاء التوكن
- روابط مباشرة إلى صفحة إنشاء التوكن في GitHub

✅ **معالجة أخطاء الشبكة**
- رسائل واضحة لمشاكل الاتصال
- إرشادات لإعادة المحاولة

✅ **معالجة الملفات المكررة**
- رسالة واضحة عند محاولة رفع ملف موجود
- اقتراحات للحل

---

## 📞 الدعم - Support

للحصول على مساعدة إضافية:
- **المطور:** د. علي عبدالعال
- **GitHub:** [@aliabdelaal-adm](https://github.com/aliabdelaal-adm)
- **Repository:** [Monthly_inspection_plan](https://github.com/aliabdelaal-adm/Monthly_inspection_plan)

---

## 📚 مراجع إضافية - Additional References

- [GitHub Personal Access Tokens Documentation](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token)
- [GitHub API - Creating a file](https://docs.github.com/en/rest/repos/contents#create-or-update-file-contents)
- [FILE_UPLOAD_GUIDE.md](./FILE_UPLOAD_GUIDE.md) - دليل رفع الملفات الكامل

---

## 📊 إحصائيات - Statistics

**التحسينات في هذا الإصلاح:**
- عدد رسائل الخطأ الجديدة: 7
- عدد الفحوصات المضافة: 3
- عدد الإرشادات المضافة: 2
- الملفات المحدثة: 3 (admin.html, index.html, FILE_UPLOAD_GUIDE.md)

---

*آخر تحديث: 2025-10-01*
*Last Updated: 2025-10-01*
