# 📍 دليل نظام تتبع زيارات المفتشين للمحلات

## نظرة عامة

نظام متكامل وذكي لتتبع زيارات المفتشين للمحلات بطريقة مشروعة وآمنة، يوفر إمكانيات تتبع الموقع الجغرافي GPS ومراقبة فتح روابط خرائط جوجل مع إشعارات فورية للمطور.

---

## 🎯 الميزات الرئيسية

### 1. تتبع الموقع الجغرافي (GPS)
- **تتبع تلقائي**: يتم تتبع موقع المفتش تلقائياً عند تفعيل الخاصية
- **كشف القرب**: تسجيل تلقائي للزيارة عند الاقتراب من المحل (ضمن 100 متر)
- **دقة عالية**: استخدام High Accuracy GPS لأفضل النتائج
- **حساب المسافة**: قياس المسافة الدقيقة بين المفتش والمحل

### 2. تتبع روابط خرائط جوجل
- **رصد النقرات**: تسجيل تلقائي عند فتح رابط خرائط جوجل لأي محل
- **تحديد المحل**: ربط الزيارة بالمحل الصحيح من خلال data attributes
- **سهولة الاستخدام**: لا يتطلب أي إجراءات إضافية من المفتش

### 3. نظام الإشعارات
- **إشعارات للمفتش**: تأكيد فوري بتسجيل الزيارة
- **إشعارات للمطور**: إشعارات مميزة مع تفاصيل كاملة عن الزيارة
- **إشعارات متعددة النوافذ**: مزامنة تلقائية عبر جميع النوافذ المفتوحة
- **إشعار صوتي**: تنبيه صوتي خفيف للمطور عند حدوث زيارة جديدة

### 4. لوحة التحكم والتقارير
- **سجل شامل**: عرض جميع الزيارات مع التفاصيل الكاملة
- **إحصائيات متقدمة**:
  - إجمالي الزيارات
  - زيارات GPS
  - فتح الخرائط
  - عدد المحلات المختلفة
  - عدد المفتشين النشطين
- **فلترة ذكية**: عرض السجلات حسب المفتش (للمفتشين) أو الجميع (للمطور)
- **تصدير CSV**: إمكانية تصدير جميع السجلات لتحليلها

---

## 🚀 كيفية الاستخدام

### للمفتشين:

#### 1. تفعيل تتبع الموقع
```
1. افتح النظام (index.html)
2. اختر اسمك من قائمة المفتشين
3. انقر على أيقونة "إدارة خدمات النظام" (⚙️)
4. اختر "تتبع الزيارات" (📍)
5. انقر على "تفعيل تتبع الموقع"
6. اسمح بالوصول للموقع في المتصفح
```

#### 2. تسجيل الزيارات تلقائياً
- **عند الزيارة الميدانية**: عندما تقترب من المحل (أقل من 100 متر)، سيتم تسجيل الزيارة تلقائياً
- **عند فتح الخرائط**: عند النقر على رابط "فتح في خرائط جوجل" لأي محل، سيتم تسجيل الزيارة

#### 3. مراجعة زياراتك
- افتح نافذة "تتبع الزيارات" لرؤية جميع زياراتك
- راجع التفاصيل: التاريخ، الوقت، المسافة، نوع الزيارة

### للمطور:

#### 1. مراقبة الزيارات
- ستصلك إشعارات فورية عند زيارة أي مفتش لأي محل
- الإشعارات تظهر على يسار الشاشة مع تفاصيل كاملة
- يتم تشغيل صوت خفيف للتنبيه

#### 2. عرض جميع السجلات
- افتح نافذة "تتبع الزيارات"
- ستجد جميع الزيارات لجميع المفتشين
- احصائيات شاملة ومفصلة

#### 3. تصدير السجلات
- انقر على "تصدير السجلات" في نافذة التتبع
- سيتم تنزيل ملف CSV يحتوي على جميع البيانات
- يمكن فتح الملف في Excel للتحليل

#### 4. إدارة البيانات
- "مسح السجلات القديمة": حذف السجلات الأقدم من 30 يوم
- تلقائي: جميع السجلات محفوظة في localStorage

---

## 📊 البيانات المسجلة

لكل زيارة، يتم حفظ:
- **المفتش**: اسم المفتش
- **المحل**: اسم المحل
- **المنطقة**: منطقة المحل
- **العنوان**: عنوان المحل
- **نوع الزيارة**: زيارة GPS أو فتح الخرائط
- **المسافة**: المسافة بالأمتار (في حالة GPS)
- **التاريخ**: تاريخ الزيارة
- **الوقت**: وقت الزيارة بالساعة والدقيقة
- **الإحداثيات**: خط العرض والطول (GPS)
- **الدقة**: دقة القياس بالأمتار

---

## 🔒 الخصوصية والأمان

### مبادئ الخصوصية:
1. **صلاحيات واضحة**: يتم طلب صلاحية الموقع بشكل صريح
2. **تخزين محلي**: جميع البيانات محفوظة في جهاز المستخدم
3. **استخدام مشروع**: الموقع يُستخدم فقط لأغراض التفتيش
4. **إمكانية الإيقاف**: يمكن إيقاف التتبع في أي وقت
5. **شفافية كاملة**: المفتش يرى جميع البيانات المسجلة

### الأمان:
- البيانات محفوظة في localStorage (مشفرة بواسطة المتصفح)
- لا يتم إرسال البيانات لأي خادم خارجي
- التحقق من صلاحيات المطور قبل الوصول لجميع السجلات
- حماية ضد التلاعب بالبيانات

---

## 💡 نصائح للحصول على أفضل النتائج

### للحصول على دقة GPS عالية:
1. ✅ فعّل خدمات الموقع في جهازك
2. ✅ استخدم النظام في مكان مفتوح (ليس داخل مبنى مغلق)
3. ✅ تأكد من اتصالك بالإنترنت
4. ✅ امنح التطبيق وقتاً كافياً لتحديد الموقع (10-30 ثانية)
5. ✅ استخدم HTTPS أو localhost

### مستويات الدقة:
- **ممتازة 🌟**: أقل من 10 أمتار
- **جيدة جداً ✅**: 10-30 متر
- **جيدة ✔️**: 30-50 متر
- **متوسطة ⚠️**: أكثر من 50 متر

### لتجنب المشاكل:
- ❌ لا تستخدم VPN قد يؤثر على دقة الموقع
- ❌ لا تغلق نافذة المتصفح أثناء التتبع
- ❌ لا تحظر صلاحيات الموقع في إعدادات المتصفح

---

## 🔧 المتطلبات التقنية

### المتصفحات المدعومة:
- ✅ Chrome 50+ (موصى به)
- ✅ Firefox 55+
- ✅ Safari 11+
- ✅ Edge 79+
- ✅ Opera 37+

### متطلبات الجهاز:
- GPS أو خدمات الموقع الشبكية
- اتصال بالإنترنت (3G أو أفضل)
- مساحة تخزين: 1MB على الأقل في localStorage

### متطلبات الأمان:
- يجب استخدام HTTPS (أو localhost للتطوير)
- صلاحيات الموقع في الجهاز والمتصفح

---

## 📱 التوافق مع الأجهزة المحمولة

النظام مُحسَّن بالكامل للعمل على الهواتف والأجهزة اللوحية:

### المزايا على الأجهزة المحمولة:
- 📍 دقة GPS أعلى (باستخدام GPS المدمج)
- 🔋 إدارة ذكية للبطارية
- 📲 إشعارات متوافقة مع الشاشات الصغيرة
- 👆 واجهة تعمل باللمس

### نصائح للهواتف:
1. فعّل GPS من إعدادات الجهاز
2. امنح المتصفح صلاحية الوصول للموقع
3. أبقِ التطبيق مفتوحاً في الخلفية أثناء التفتيش
4. تأكد من شحن البطارية كافٍ

---

## 🎓 أمثلة وحالات الاستخدام

### مثال 1: زيارة ميدانية بالـ GPS
```
السيناريو:
- المفتش "د. علي عبدالعال" يزور "محل جرين لندز"
- المحل موجود في سوق الميناء

الخطوات:
1. المفتش يفعّل تتبع الموقع في بداية يومه
2. عند الوصول للمحل والاقتراب منه (50 متر)
3. يتم تسجيل الزيارة تلقائياً
4. يظهر إشعار للمفتش: "✅ تم تسجيل الزيارة!"
5. يتلقى المطور إشعاراً فورياً

النتيجة:
- سجل في قاعدة البيانات يحتوي على:
  * اسم المفتش والمحل
  * المسافة الدقيقة (مثلاً: 47 متر)
  * الوقت والتاريخ
  * الإحداثيات
```

### مثال 2: تسجيل عبر خرائط جوجل
```
السيناريو:
- المفتشة "د. آيه سلامة" تريد مراجعة موقع محل قبل الزيارة

الخطوات:
1. تفتح النظام وتبحث عن المحل
2. تنقر على زر "فتح في خرائط جوجل"
3. يتم تسجيل الزيارة تلقائياً
4. تُفتح خرائط جوجل في نافذة جديدة

النتيجة:
- سجل في قاعدة البيانات يحتوي على:
  * اسم المفتشة والمحل
  * نوع الزيارة: "فتح الخرائط"
  * الوقت والتاريخ
```

### مثال 3: تقرير المطور
```
السيناريو:
- المطور يريد مراجعة زيارات اليوم

الخطوات:
1. يفتح نافذة "تتبع الزيارات"
2. يرى جدول شامل بجميع الزيارات
3. يراجع الإحصائيات:
   * 45 زيارة اليوم
   * 30 زيارة GPS
   * 15 فتح خرائط
4. يصدّر التقرير بصيغة CSV

النتيجة:
- ملف Excel جاهز للتحليل
- إحصائيات دقيقة عن أداء المفتشين
```

---

## 🐛 حل المشاكل الشائعة

### المشكلة: لا يعمل تتبع الموقع
**الحلول:**
1. ✅ تحقق من صلاحيات الموقع في المتصفح
2. ✅ تأكد من تفعيل GPS في الجهاز
3. ✅ استخدم HTTPS أو localhost
4. ✅ أعد تحميل الصفحة وحاول مرة أخرى
5. ✅ جرب متصفح آخر

### المشكلة: الدقة منخفضة (أكثر من 50 متر)
**الحلول:**
1. ✅ اخرج إلى مكان مفتوح
2. ✅ انتظر 30 ثانية ليستقر الموقع
3. ✅ تأكد من اتصالك بالإنترنت جيد
4. ✅ أعد تشغيل GPS في الجهاز

### المشكلة: لا تظهر الإشعارات
**الحلول:**
1. ✅ تحقق من أنك مسجل دخول كمفتش أو مطور
2. ✅ تأكد من أن المتصفح لا يحجب الإشعارات
3. ✅ أعد تحميل الصفحة
4. ✅ افحص console في المتصفح للأخطاء

### المشكلة: لا يتم حفظ الزيارات
**الحلول:**
1. ✅ تحقق من مساحة localStorage
2. ✅ لا تستخدم وضع التصفح الخاص
3. ✅ تأكد من عدم حظر cookies
4. ✅ جرب مسح cache المتصفح

---

## 📞 الدعم والمساعدة

### للحصول على المساعدة:
- 📧 البريد الإلكتروني: [أضف البريد]
- 💬 التواصل مع المطور
- 📖 مراجعة هذا الدليل

### الإبلاغ عن المشاكل:
يرجى تضمين:
1. نوع ونسخة المتصفح
2. نوع الجهاز (حاسوب/هاتف)
3. وصف المشكلة
4. خطوات إعادة إنتاج المشكلة
5. لقطة شاشة إن أمكن

---

## 🔄 التحديثات المستقبلية

### قيد التطوير:
- [ ] إضافة خرائط تفاعلية في النظام
- [ ] تتبع المسار الكامل للمفتش
- [ ] إشعارات push على الهاتف
- [ ] تقارير أكثر تفصيلاً
- [ ] تكامل مع أنظمة GPS خارجية
- [ ] إمكانية إضافة ملاحظات على الزيارات
- [ ] تقييم جودة الزيارة

---

## 📄 الترخيص والمسؤولية

### الاستخدام المشروع:
- ✅ هذا النظام مصمم للاستخدام المشروع في التفتيش
- ✅ يجب الحصول على موافقة المفتشين
- ✅ يجب احترام خصوصية المستخدمين
- ✅ استخدام البيانات لأغراض العمل فقط

### إخلاء المسؤولية:
- المطور غير مسؤول عن سوء الاستخدام
- يجب الالتزام بقوانين الخصوصية المحلية
- البيانات هي مسؤولية المؤسسة المستخدمة

---

## ✨ الخلاصة

نظام تتبع الزيارات هو أداة قوية ومتقدمة توفر:
- 📍 تتبع دقيق لموقع المفتشين
- 🔔 إشعارات فورية للمطور
- 📊 تقارير شاملة وتحليلات
- 🔒 خصوصية وأمان محترمين
- 📱 توافق كامل مع الأجهزة المحمولة

تم تطويره بعناية ليكون **سهل الاستخدام، موثوق، وفعّال**.

---

**تم التطوير بواسطة:** د. علي عبدالعال  
**تاريخ آخر تحديث:** 2025-10-22  
**الإصدار:** 1.0.0
